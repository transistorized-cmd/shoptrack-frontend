import{d as e,r as t,v as a,x as l,c as s,o as n,e as r,f as i,F as o,b as u,t as c,I as d,k as g,G as v,H as p}from"./chunk-D50-beEz.js";import{a as m}from"./chunk-C1DHrtJO.js";const x={class:"space-y-6"},y={class:"flex justify-between items-center"},f={class:"flex items-center space-x-3"},b=["value"],h=["value"],w={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg"},k={class:"flex flex-wrap gap-2"},D={class:"capitalize"},C=["onClick"],I={key:1,class:"flex","aria-label":"Breadcrumb"},S={class:"inline-flex items-center space-x-1 md:space-x-3"},$=["onClick"],j={key:1,class:"text-sm font-medium text-gray-500"},A={key:2,class:"w-6 h-6 text-gray-400 ml-1",fill:"currentColor",viewBox:"0 0 20 20"},T={key:2,class:"text-center py-12"},z={key:3},F={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},L={class:"bg-white p-4 rounded-lg border"},N={class:"text-2xl font-bold text-gray-900"},P={class:"bg-white p-4 rounded-lg border"},q={class:"text-2xl font-bold text-gray-900"},M={class:"bg-white p-4 rounded-lg border"},U={class:"text-2xl font-bold text-gray-900"},R={class:"bg-white p-4 rounded-lg border"},B={class:"text-2xl font-bold text-gray-900"},E={class:"space-y-3"},H=["onClick"],O=["onClick"],_={class:"flex items-center justify-between mb-3"},G={class:"text-lg font-semibold text-gray-900 capitalize"},Q={class:"text-right"},V={class:"text-lg font-bold text-blue-600"},J={class:"text-sm text-gray-500"},K={class:"w-full bg-gray-200 rounded-full h-2 mb-3"},W={class:"flex items-center justify-between text-sm text-gray-600"},X={key:4},Y={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},Z={class:"bg-white p-4 rounded-lg border"},ee={class:"text-sm font-medium text-gray-500"},te={class:"text-2xl font-bold text-gray-900"},ae={class:"bg-white p-4 rounded-lg border"},le={class:"text-2xl font-bold text-gray-900"},se={class:"bg-white p-4 rounded-lg border"},ne={class:"text-2xl font-bold text-gray-900"},re={class:"bg-white p-4 rounded-lg border"},ie={class:"text-2xl font-bold text-gray-900"},oe={class:"space-y-3"},ue=["onClick"],ce={class:"flex items-center justify-between mb-3"},de={class:"text-lg font-semibold text-gray-900 capitalize"},ge={class:"text-right"},ve={class:"text-lg font-bold text-green-600"},pe={class:"text-sm text-gray-500"},me={class:"w-full bg-gray-200 rounded-full h-2 mb-3"},xe={class:"flex items-center justify-between text-sm text-gray-600"},ye={key:5},fe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},be={class:"bg-white p-4 rounded-lg border"},he={class:"text-sm font-medium text-gray-500"},we={class:"text-2xl font-bold text-gray-900"},ke={class:"bg-white p-4 rounded-lg border"},De={class:"text-2xl font-bold text-gray-900"},Ce={class:"bg-white p-4 rounded-lg border"},Ie={class:"text-2xl font-bold text-gray-900"},Se={class:"bg-white p-4 rounded-lg border"},$e={class:"text-2xl font-bold text-gray-900"},je={class:"space-y-3"},Ae=["onClick"],Te={class:"flex items-center justify-between mb-3"},ze={class:"text-lg font-semibold text-gray-900"},Fe={class:"text-sm text-gray-500"},Le={class:"text-right"},Ne={class:"text-lg font-bold text-purple-600"},Pe={class:"text-sm text-gray-500"},qe={class:"flex items-center justify-between text-sm text-gray-600"},Me={key:0},Ue={key:6,class:"text-center py-12"},Re=e({__name:"CategoryAnalytics",setup(e){const Re=g(),Be=d();function Ee(e){const t=Be.query[e];return"string"==typeof t&&t.match(/^\d{4}-\d{2}-\d{2}$/)?t:null}function He(){const e=Be.query.category;return"string"==typeof e&&e.trim()?e:null}function Oe(){const e=Be.query.categoryId;if("string"==typeof e&&e.trim()){const t=parseInt(e,10);return isNaN(t)?null:t}return null}function _e(){const e=Be.query.itemId;if("string"==typeof e&&e.trim()){const t=parseInt(e,10);return isNaN(t)?null:t}return null}const Ge=t(!1),Qe=t(function(){const e=He(),t=Oe(),a=_e();return(e||t)&&a?"receipts":e||t?"items":"categories"}()),Ve=t(Oe()),Je=t(He()||""),Ke=t(_e()),We=t(""),Xe=t(function(){const e=Be.query.excluded;return"string"==typeof e&&e.trim()?new Set(e.split(",").filter(e=>e.trim())):new Set}()),Ye=t([]),Ze=t([]),et=t([]),tt=t({startDate:Ee("startDate")||function(){const e=new Date;return e.setMonth(e.getMonth()-3),e.toISOString().split("T")[0]}(),endDate:Ee("endDate")||(new Date).toISOString().split("T")[0]}),at=a(()=>{const e=[{label:"Categories",path:"categories"}];return Je.value&&e.push({label:Je.value,path:"items"}),We.value&&e.push({label:We.value,path:"receipts"}),e}),lt=a(()=>Ye.value.filter(e=>!Xe.value.has(e.category))),st=a(()=>lt.value.reduce((e,t)=>e+t.totalAmount,0)),nt=a(()=>lt.value.reduce((e,t)=>e+t.totalItems,0)),rt=a(()=>lt.value.reduce((e,t)=>e+t.transactionCount,0)),it=a(()=>Ze.value.reduce((e,t)=>e+t.totalAmount,0)),ot=a(()=>Ze.value.reduce((e,t)=>e+t.totalItems,0)),ut=a(()=>Ze.value.reduce((e,t)=>e+t.transactionCount,0)),ct=a(()=>et.value.reduce((e,t)=>e+t.totalPrice,0)),dt=a(()=>et.value.reduce((e,t)=>e+(t.quantity||1),0)),gt=a(()=>0===et.value.length?0:ct.value/et.value.length);async function vt(){Ge.value=!0;try{const e=new URLSearchParams;tt.value.startDate&&e.append("startDate",tt.value.startDate),tt.value.endDate&&e.append("endDate",tt.value.endDate);const t=await m.get(`/api/analytics/categories?${e}`);Ye.value=t.data}catch(e){}finally{Ge.value=!1}}async function pt(e,t){Ge.value=!0;try{const a=new URLSearchParams;e&&a.append("categoryId",e.toString()),t&&a.append("category",t),tt.value.startDate&&a.append("startDate",tt.value.startDate),tt.value.endDate&&a.append("endDate",tt.value.endDate);const l=await m.get(`/api/analytics/categories/items?${a}`);Ze.value=l.data}catch(a){}finally{Ge.value=!1}}async function mt(e,t,a){Ge.value=!0;try{const l=new URLSearchParams;e&&l.append("categoryId",e.toString()),a&&l.append("category",a),l.append("itemId",t.toString()),tt.value.startDate&&l.append("startDate",tt.value.startDate),tt.value.endDate&&l.append("endDate",tt.value.endDate);const s=await m.get(`/api/analytics/categories/items/receipts?${l}`);et.value=s.data}catch(l){}finally{Ge.value=!1}}function xt(e){const t=e.target;tt.value.startDate=t.value,ft(),bt()}function yt(e){const t=e.target;tt.value.endDate=t.value,ft(),bt()}function ft(){const e=new URLSearchParams;tt.value.startDate&&e.set("startDate",tt.value.startDate),tt.value.endDate&&e.set("endDate",tt.value.endDate),Ve.value&&e.set("categoryId",Ve.value.toString()),Ke.value&&e.set("itemId",Ke.value.toString()),Xe.value.size>0&&e.set("excluded",Array.from(Xe.value).join(","));const t=e.toString(),a="/analytics/categories"+(t?`?${t}`:"");Re.replace(a)}async function bt(){"categories"===Qe.value?await vt():"items"===Qe.value&&Ve.value?await pt(Ve.value,Je.value):"receipts"===Qe.value&&Ve.value&&Ke.value&&await mt(Ve.value,Ke.value,Je.value)}return l(()=>{!function(){const e=He(),t=Oe(),a=_e();(e||t)&&a?(Je.value=e||"",Ve.value=t,Ke.value=a,Qe.value="receipts",t&&mt(t,a,e)):e||t?(Je.value=e||"",Ve.value=t,Qe.value="items",t&&pt(t,e)):(Qe.value="categories",vt())}(),ft()}),(e,t)=>(n(),s("div",x,[r("div",y,[t[0]||(t[0]=r("div",null,[r("h1",{class:"text-2xl font-bold text-gray-900"},"Category Analytics"),r("p",{class:"text-gray-600 mt-1"}," Analyze spending patterns by category with drill-down insights ")],-1)),r("div",f,[r("input",{type:"date",value:tt.value.startDate,class:"input text-sm",placeholder:"Start Date",onInput:xt},null,40,b),r("input",{type:"date",value:tt.value.endDate,class:"input text-sm",placeholder:"End Date",onInput:yt},null,40,h)])]),Xe.value.size>0?(n(),s("div",w,[t[2]||(t[2]=r("h3",{class:"text-sm font-medium text-gray-700 mb-2"}," Excluded Categories: ",-1)),r("div",k,[(n(!0),s(o,null,u(Array.from(Xe.value),e=>(n(),s("div",{key:`excluded-${e}`,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800"},[r("span",D,c(e),1),r("button",{class:"ml-2 inline-flex items-center justify-center w-4 h-4 rounded-full hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-red-500",onClick:t=>function(e){Xe.value.delete(e),ft()}(e)},[...t[1]||(t[1]=[r("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,C)]))),128))])])):i("",!0),at.value.length>1?(n(),s("nav",I,[r("ol",S,[(n(!0),s(o,null,u(at.value,(e,a)=>(n(),s("li",{key:a,class:"inline-flex items-center"},[a<at.value.length-1?(n(),s("button",{key:0,class:"inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600",onClick:t=>{var a;"categories"===(a=e.path)?(Qe.value="categories",Ve.value=null,Je.value="",Ke.value=null,We.value="",ft()):"items"===a&&(Qe.value="items",Ke.value=null,We.value="",ft())}},c(e.label),9,$)):(n(),s("span",j,c(e.label),1)),a<at.value.length-1?(n(),s("svg",A,[...t[3]||(t[3]=[r("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"},null,-1)])])):i("",!0)]))),128))])])):i("",!0),Ge.value?(n(),s("div",T,[...t[4]||(t[4]=[r("div",{class:"inline-flex items-center space-x-2 text-sm text-gray-500"},[r("svg",{class:"animate-spin h-4 w-4",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),r("span",null,"Loading analytics data...")],-1)])])):"categories"===Qe.value?(n(),s("div",z,[r("div",F,[r("div",L,[t[5]||(t[5]=r("p",{class:"text-sm font-medium text-gray-500"},"Total Categories",-1)),r("p",N,c(Ye.value.length),1)]),r("div",P,[t[6]||(t[6]=r("p",{class:"text-sm font-medium text-gray-500"},"Total Spending",-1)),r("p",q," $"+c(st.value.toFixed(2)),1)]),r("div",M,[t[7]||(t[7]=r("p",{class:"text-sm font-medium text-gray-500"},"Total Items",-1)),r("p",U,c(nt.value),1)]),r("div",R,[t[8]||(t[8]=r("p",{class:"text-sm font-medium text-gray-500"},"Transactions",-1)),r("p",B,c(rt.value),1)])]),r("div",E,[(n(!0),s(o,null,u(lt.value,e=>(n(),s("div",{key:e.category,class:"relative bg-white p-6 rounded-lg border hover:border-blue-300 hover:shadow-md transition-all duration-200 group"},[r("button",{class:"absolute top-2 right-2 w-6 h-6 bg-red-100 hover:bg-red-200 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-red-500",title:"Exclude category from analysis",onClick:v(t=>function(e){Xe.value.add(e),ft()}(e.category),["stop"])},[...t[9]||(t[9]=[r("svg",{class:"w-3 h-3 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,H),r("div",{class:"cursor-pointer",onClick:t=>async function(e,t){Ve.value=e,Je.value=t,Qe.value="items",ft(),await pt(e,t)}(e.categoryId,e.category)},[r("div",_,[r("h3",G,c(e.category),1),r("div",Q,[r("p",V," $"+c(e.totalAmount.toFixed(2)),1),r("p",J,c(e.percentage)+"%",1)])]),r("div",K,[r("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:p({width:`${e.percentage}%`})},null,4)]),r("div",W,[r("span",null,c(e.totalItems)+" items",1),r("span",null,c(e.transactionCount)+" transactions",1)])],8,O)]))),128))])])):"items"===Qe.value?(n(),s("div",X,[r("div",Y,[r("div",Z,[r("p",ee," Items in "+c(Je.value),1),r("p",te,c(Ze.value.length),1)]),r("div",ae,[t[10]||(t[10]=r("p",{class:"text-sm font-medium text-gray-500"},"Category Spending",-1)),r("p",le," $"+c(it.value.toFixed(2)),1)]),r("div",se,[t[11]||(t[11]=r("p",{class:"text-sm font-medium text-gray-500"},"Total Items",-1)),r("p",ne,c(ot.value),1)]),r("div",re,[t[12]||(t[12]=r("p",{class:"text-sm font-medium text-gray-500"},"Transactions",-1)),r("p",ie,c(ut.value),1)])]),r("div",oe,[(n(!0),s(o,null,u(Ze.value,e=>(n(),s("div",{key:e.itemId,class:"cursor-pointer bg-white p-6 rounded-lg border hover:border-green-300 hover:shadow-md transition-all duration-200",onClick:t=>async function(e,t){Ke.value=e,We.value=t,Qe.value="receipts",ft(),await mt(Ve.value,e,Je.value)}(e.itemId,e.itemName)},[r("div",ce,[r("h3",de,c(e.itemName),1),r("div",ge,[r("p",ve," $"+c(e.totalAmount.toFixed(2)),1),r("p",pe,c(e.percentage)+"%",1)])]),r("div",me,[r("div",{class:"bg-green-600 h-2 rounded-full transition-all duration-300",style:p({width:`${e.percentage}%`})},null,4)]),r("div",xe,[r("span",null,c(e.totalItems)+" items",1),r("span",null,c(e.transactionCount)+" transactions",1)])],8,ue))),128))])])):"receipts"===Qe.value?(n(),s("div",ye,[r("div",fe,[r("div",be,[r("p",he," Receipts for "+c(We.value),1),r("p",we,c(et.value.length),1)]),r("div",ke,[t[13]||(t[13]=r("p",{class:"text-sm font-medium text-gray-500"},"Item Spending",-1)),r("p",De," $"+c(ct.value.toFixed(2)),1)]),r("div",Ce,[t[14]||(t[14]=r("p",{class:"text-sm font-medium text-gray-500"},"Total Quantity",-1)),r("p",Ie,c(dt.value),1)]),r("div",Se,[t[15]||(t[15]=r("p",{class:"text-sm font-medium text-gray-500"},"Avg Price",-1)),r("p",$e," $"+c(gt.value.toFixed(2)),1)])]),r("div",je,[(n(!0),s(o,null,u(et.value,e=>{return n(),s("div",{key:`${e.receiptId}-${e.itemName}`,class:"cursor-pointer bg-white p-6 rounded-lg border hover:border-purple-300 hover:shadow-md transition-all duration-200",onClick:t=>{return a=e.receiptId,void Re.push(`/receipts/${a}`);var a}},[r("div",Te,[r("div",null,[r("h3",ze,c(e.storeName),1),r("p",Fe,c((t=e.receiptDate,new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))),1)]),r("div",Le,[r("p",Ne," $"+c(e.totalPrice.toFixed(2)),1),r("p",Pe,c(e.quantity||1)+" "+c(e.unit||"item")+c((e.quantity||1)>1?"s":""),1)])]),r("div",qe,[r("span",null,"Receipt #"+c(e.receiptId),1),e.pricePerUnit?(n(),s("span",Me,"$"+c(e.pricePerUnit.toFixed(2))+" per "+c(e.unit||"item"),1)):i("",!0)])],8,Ae);var t}),128))])])):i("",!0),Ge.value||"categories"!==Qe.value||0!==Ye.value.length?i("",!0):(n(),s("div",Ue,[...t[16]||(t[16]=[r("div",{class:"text-gray-500 mb-4"},"No category data available",-1),r("p",{class:"text-sm text-gray-400"}," Try adjusting your date range or upload some receipts ",-1)])]))]))}});export{Re as default};
