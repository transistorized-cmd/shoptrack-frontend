import{d as e,r as t,v as a,I as l,k as r,x as i,c as n,o as s,e as o,f as u,t as d,n as c,p as v,i as m,C as p,E as g,F as y,b as x}from"./chunk-D50-beEz.js";import{u as b,b as f,T as h,r as w}from"./index-BUkE986E.js";import"./chunk-C1DHrtJO.js";function k(e,t={}){if(Array.isArray(e))return{isValid:!1,error:"ID parameter cannot be an array"};if(!e)return{isValid:!1,error:"ID parameter is required"};const a=e.toString().trim();if(""===a)return{isValid:!1,error:"ID parameter cannot be empty"};if(D(a))return{isValid:!1,error:"ID parameter contains invalid characters"};const l=Number(a);if(isNaN(l))return{isValid:!1,error:"ID parameter must be a valid number"};if(!Number.isInteger(l))return{isValid:!1,error:"ID parameter must be an integer"};if(!t.allowNegative&&l<0)return{isValid:!1,error:"ID parameter cannot be negative"};const r=t.min??1;if(l<r)return{isValid:!1,error:`ID parameter must be at least ${r}`};const i=t.max??Number.MAX_SAFE_INTEGER;return l>i?{isValid:!1,error:`ID parameter cannot exceed ${i}`}:{isValid:!0,value:l}}function I(e,t={}){if(Array.isArray(e))return{isValid:!1,error:"String parameter cannot be an array"};if(!e)return{isValid:!1,error:"String parameter is required"};const a=e.toString().trim();if(""===a)return{isValid:!1,error:"String parameter cannot be empty"};if(D(a))return{isValid:!1,error:"String parameter contains invalid characters"};const l=t.minLength??1,r=t.maxLength??100;if(a.length<l)return{isValid:!1,error:`String parameter must be at least ${l} characters long`};if(a.length>r)return{isValid:!1,error:`String parameter cannot exceed ${r} characters`};if(t.allowedPattern&&!t.allowedPattern.test(a))return{isValid:!1,error:"String parameter format is invalid"};if(t.allowedValues&&t.allowedValues.length>0){const e=!1===t.caseSensitive?t.allowedValues.map(e=>e.toLowerCase()):t.allowedValues,l=!1===t.caseSensitive?a.toLowerCase():a;if(!e.includes(l))return{isValid:!1,error:`String parameter must be one of: ${t.allowedValues.join(", ")}`}}return{isValid:!0,value:a}}function D(e){return[/<script[^>]*>/i,/javascript:/i,/on\w+\s*=/i,/(\bunion\b|\bselect\b|\binsert\b|\bupdate\b|\bdelete\b|\bdrop\b)/i,/[';].*(--)/,/\.\./,/[\\\/]/,/%[0-9a-f]{2}/i,/[\x00-\x1F\x7F]/,/[<>"']/,/[|&`;$()]/].some(t=>t.test(e))}function V(e){return e.replace(/[<>"']/g,"").replace(/[|&`;$()]/g,"").replace(/\.\./g,"").replace(/[\\\/]/g,"").replace(/[\x00-\x1F\x7F]/g,"").replace(/%[0-9a-f]{2}/gi,"").trim()}function N(e){return k(e,{min:1,max:Number.MAX_SAFE_INTEGER,allowNegative:!1})}function C(e){return I(e,{minLength:1,maxLength:50,allowedPattern:/^[a-zA-Z0-9\-_]+$/,allowedValues:["category-analytics","price-trends","generic-receipts","amazon-receipts","generic-receipt","amazon"],caseSensitive:!1})}function S(e){return I(e,{minLength:2,maxLength:10,allowedPattern:/^[a-zA-Z0-9]+$/,allowedValues:["csv","json","xlsx","pdf"],caseSensitive:!1})}function M(e){if(Array.isArray(e))return{isValid:!1,error:"Date parameter cannot be an array"};if(!e)return{isValid:!1,error:"Date parameter is required"};const t=e.toString().trim();if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return{isValid:!1,error:"Date parameter must be in YYYY-MM-DD format"};const a=new Date(t);if(isNaN(a.getTime()))return{isValid:!1,error:"Date parameter is not a valid date"};const l=new Date("2000-01-01"),r=new Date;return r.setFullYear(r.getFullYear()+1),a<l||a>r?{isValid:!1,error:"Date parameter is outside acceptable range"}:{isValid:!0,value:t}}function U(e,t,a="/"){if(!e.isValid)throw t.replace(a),new Error("Invalid route parameter detected")}const A={class:"min-h-screen bg-gray-50"},L={class:"bg-white shadow"},j={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},P={class:"flex items-center justify-between"},E={class:"flex items-center space-x-4"},F={key:0,class:"text-sm text-gray-500"},R={key:0,class:"flex items-center space-x-3"},$={key:0,class:"flex justify-center items-center py-12"},B={key:1,class:"text-center py-12"},z={class:"text-red-600 mb-4"},T={key:2,class:"text-center py-12"},H={key:3,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},O={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},K={class:"bg-white rounded-lg shadow p-6"},_={class:"bg-gray-100 rounded-lg overflow-hidden"},q=["src","alt"],Y={key:1,class:"flex items-center justify-center h-64 text-gray-500"},Q={class:"text-center"},J={key:0,class:"text-xs text-gray-400 mt-1"},G={class:"space-y-6"},W={class:"bg-white rounded-lg shadow p-6"},X={class:"space-y-4"},Z={class:"grid grid-cols-2 gap-4"},ee={key:0,class:"flex items-center group"},te={class:"text-gray-900"},ae={key:1,class:"flex items-center space-x-2"},le={key:0},re={class:"text-gray-900"},ie={class:"grid grid-cols-1 gap-4"},ne={key:0,class:"flex items-center group"},se={class:"text-gray-900 font-medium"},oe={key:1,class:"flex items-center space-x-2 relative"},ue={class:"flex-1 relative"},de={key:0,class:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-10 max-h-40 overflow-y-auto"},ce=["onMousedown"],ve={class:"grid grid-cols-2 gap-4"},me={class:"text-gray-900"},pe={class:"text-gray-900"},ge={key:0},ye={class:"text-gray-900"},xe={class:"text-gray-900"},be={key:0,class:"bg-white rounded-lg shadow p-6"},fe={class:"flex justify-between items-center mb-4"},he={class:"text-xl font-semibold text-gray-900"},we={class:"text-lg font-bold text-gray-900"},ke={class:"space-y-3"},Ie={key:0,class:"group"},De={class:"flex justify-between items-start mb-2"},Ve={class:"font-medium text-gray-900"},Ne={class:"flex items-center space-x-2"},Ce={class:"font-semibold text-gray-900"},Se=["onClick"],Me={class:"flex justify-between items-center text-sm text-gray-500"},Ue={class:"flex space-x-4"},Ae={key:0},Le={key:0,class:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs"},je={key:0,class:"text-xs text-gray-400 mt-1"},Pe={key:1,class:"space-y-3"},Ee={class:"relative"},Fe=["onUpdate:modelValue","onInput","onKeydown","onBlur"],Re={key:0,class:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-20 max-h-32 overflow-y-auto"},$e=["onMousedown"],Be={class:"relative"},ze=["onUpdate:modelValue","onInput","onKeydown","onBlur"],Te={key:0,class:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-20 max-h-32 overflow-y-auto"},He=["onMousedown"],Oe={class:"grid grid-cols-2 md:grid-cols-4 gap-2"},Ke=["onUpdate:modelValue","onInput"],_e=["onUpdate:modelValue","onInput"],qe=["onUpdate:modelValue"],Ye={class:"relative"},Qe=["onUpdate:modelValue","onInput","onKeydown","onBlur"],Je={key:0,class:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-20 max-h-32 overflow-y-auto"},Ge=["onMousedown"],We=["onUpdate:modelValue"],Xe={class:"bg-gray-50 rounded px-3 py-2"},Ze={class:"font-semibold text-gray-900"},et={class:"flex justify-end space-x-2 pt-2"},tt=["onClick"],at=["onClick"],lt={key:1,class:"bg-white rounded-lg shadow p-6"},rt={class:"bg-gray-100 p-4 rounded text-xs overflow-x-auto text-gray-700"},it={class:"mt-8 text-center"},nt=e({__name:"ReceiptDetail",setup(e){const D=l(),nt=r(),st=b(),ot=t(null),ut=t(!0),dt=t(null),ct=t(!1),vt=t(null),mt=t(!1),pt=t("");t({show:!1,options:[],selectedIndex:-1});const gt=t(!1),yt=t(""),xt=t({}),bt=t({}),ft=t({});t([]),t(-1),t(null);const ht=t(!1),wt=t([]),kt=t(-1),It=t(null),{success:Dt,error:Vt}=f(),{validateReceiptId:Nt,handleValidationError:Ct,sanitizeStringParam:St}={validateReceiptId:N,validatePluginKey:C,validateFormat:S,validateDateParam:M,validateNumericId:k,validateStringParam:I,sanitizeStringParam:V,handleValidationError:U},Mt=a(()=>{const e=Nt(D.params.id);return e.isValid?e.value:(Ct(e,nt),null)}),Ut=a(()=>ot.value?.id?`http://localhost:5298/api/receipts/${ot.value.id}/image`:null),At=async()=>{if(!Mt.value)return dt.value="Invalid receipt ID",void(ut.value=!1);ut.value=!0,dt.value=null;try{const e=await st.getReceiptDetails(Mt.value);e.items,ot.value=e}catch(e){dt.value=e instanceof Error?e.message:"Failed to fetch receipt"}finally{ut.value=!1}},Lt=async()=>{if(ot.value)try{await st.reprocessReceipt(ot.value.id),await At()}catch(e){}},jt=async()=>{if(ot.value&&confirm(`Are you sure you want to delete this receipt?\n\nFilename: ${ot.value.filename}\nDate: ${ot.value.receiptDate?_t(ot.value.receiptDate):"N/A"}\n\nThis action cannot be undone.`))try{await st.deleteReceipt(ot.value.id),nt.push("/receipts")}catch(e){alert("Failed to delete receipt. Please try again.")}},Pt=()=>{pt.value=ot.value?.storeName||"",mt.value=!0},Et=async()=>{if(!ot.value||!pt.value.trim())return;const e=St(pt.value.trim());if(e)try{await st.updateReceipt(ot.value.id,{storeName:e,receiptDate:ot.value.receiptDate}),ot.value.storeName=e,pt.value=e,mt.value=!1,ht.value=!1,Dt("Store name updated successfully")}catch(t){Vt("Update failed","Failed to update the store name. Please try again.")}else Vt("Invalid store name","Store name contains invalid characters.")},Ft=()=>{mt.value=!1,pt.value="",ht.value=!1,wt.value=[]},Rt=()=>{It.value&&clearTimeout(It.value),It.value=window.setTimeout(()=>{(async e=>{if(e.trim().length<1)return ht.value=!1,void(wt.value=[]);try{const t=await w.getStoreNames(e);t.length>0&&e.trim().length>0?(wt.value=t,ht.value=!0,kt.value=-1):(ht.value=!1,wt.value=[])}catch(t){ht.value=!1,wt.value=[]}})(pt.value)},300)},$t=e=>{if(ht.value&&0!==wt.value.length)switch(e.key){case"ArrowDown":e.preventDefault(),kt.value=Math.min(kt.value+1,wt.value.length-1);break;case"ArrowUp":e.preventDefault(),kt.value=Math.max(kt.value-1,-1);break;case"Enter":e.preventDefault(),kt.value>=0&&zt(wt.value[kt.value]);break;case"Escape":ht.value=!1,kt.value=-1}},Bt=()=>{setTimeout(()=>{ht.value=!1,kt.value=-1},h.DEBOUNCE_AUTOCOMPLETE)},zt=e=>{pt.value=e,ht.value=!1,kt.value=-1},Tt=()=>{if(ot.value?.receiptDate){const e=new Date(ot.value.receiptDate);yt.value=e.toISOString().split("T")[0]}else yt.value="";gt.value=!0},Ht=async()=>{if(!ot.value||!yt.value)return;const e=new Date(yt.value).toISOString().split("T")[0];try{await st.updateReceipt(ot.value.id,{storeName:ot.value.storeName,receiptDate:e}),ot.value.receiptDate=e,gt.value=!1,Dt("Date updated successfully")}catch(t){Vt("Failed to update the receipt date")}},Ot=()=>{gt.value=!1,yt.value=""},Kt=e=>{const t=e.target;vt.value=`Failed to load image: ${t.src}`},_t=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),qt=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},Yt=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,Qt=e=>{const t=bt.value[e];t&&(t.totalPrice=(t.quantity||1)*(t.pricePerUnit||0))},Jt=(e,t)=>{setTimeout(()=>{ft.value[e]?.[t]&&(ft.value[e][t].show=!1)},200)},Gt=(e,t,a)=>{const l=bt.value[e];l&&ft.value[e]?.[t]&&(l[t]=a,ft.value[e][t].show=!1)},Wt=(e,t,a)=>{const l=ft.value[t]?.[a];if(l&&l.show&&0!==l.options.length)switch(e.key){case"ArrowDown":e.preventDefault(),l.selectedIndex=Math.min(l.selectedIndex+1,l.options.length-1);break;case"ArrowUp":e.preventDefault(),l.selectedIndex=Math.max(l.selectedIndex-1,-1);break;case"Enter":e.preventDefault(),l.selectedIndex>=0&&Gt(t,a,l.options[l.selectedIndex]);break;case"Escape":e.preventDefault(),Jt(t,a)}};return i(()=>{At()}),(e,t)=>{return s(),n("div",A,[o("div",L,[o("div",j,[o("div",P,[o("div",E,[o("button",{class:"text-gray-400 hover:text-gray-600",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},[...t[4]||(t[4]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),o("div",null,[t[5]||(t[5]=o("h1",{class:"text-2xl font-bold text-gray-900"},"Receipt Details",-1)),ot.value?(s(),n("p",F,d(ot.value.filename),1)):u("",!0)])]),ot.value?(s(),n("div",R,[o("span",{class:c(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",qt(ot.value.processingStatus)])},d(ot.value.processingStatus),3),o("button",{class:"btn btn-secondary",onClick:Lt}," 🔄 Reprocess "),o("button",{class:"inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",onClick:jt},[...t[6]||(t[6]=[o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),v(" Delete Receipt ",-1)])])])):u("",!0)])])]),ut.value?(s(),n("div",$,[...t[7]||(t[7]=[m('<div class="inline-flex items-center space-x-2"><svg class="animate-spin h-5 w-5 text-shoptrack-600" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-gray-500">Loading receipt...</span></div>',1)])])):dt.value?(s(),n("div",B,[o("div",z,d(dt.value),1),o("button",{class:"btn btn-secondary",onClick:At},"Try Again")])):ot.value?(s(),n("div",H,[o("div",O,[o("div",K,[t[10]||(t[10]=o("h2",{class:"text-xl font-semibold text-gray-900 mb-6"}," Receipt Image ",-1)),o("div",_,[Ut.value&&!vt.value?(s(),n("img",{key:0,src:Ut.value,alt:ot.value.filename,class:"w-full h-auto object-contain max-h-[600px]",onError:Kt},null,40,q)):(s(),n("div",Y,[o("div",Q,[t[9]||(t[9]=o("svg",{class:"w-12 h-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),o("p",null,d(vt.value?"Failed to load image":"Image not available"),1),vt.value?(s(),n("p",J,d(vt.value),1)):u("",!0)])]))])]),o("div",G,[o("div",W,[t[24]||(t[24]=o("h2",{class:"text-xl font-semibold text-gray-900 mb-4"}," Receipt Information ",-1)),o("div",X,[o("div",Z,[o("div",null,[t[14]||(t[14]=o("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Date",-1)),gt.value?(s(),n("div",ae,[p(o("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>yt.value=e),type:"date",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[g,yt.value]]),o("button",{class:"text-green-600 hover:text-green-700",onClick:Ht},[...t[12]||(t[12]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])]),o("button",{class:"text-gray-400 hover:text-gray-600",onClick:Ot},[...t[13]||(t[13]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):(s(),n("div",ee,[o("span",te,d(ot.value.receiptDate?_t(ot.value.receiptDate):"N/A"),1),o("button",{class:"ml-2 opacity-0 group-hover:opacity-100 text-gray-400 hover:text-gray-600 transition-opacity",onClick:Tt},[...t[11]||(t[11]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])])]))]),ot.value.receiptNumber?(s(),n("div",le,[t[15]||(t[15]=o("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Receipt #",-1)),o("div",re,d(ot.value.receiptNumber),1)])):u("",!0)]),o("div",ie,[o("div",null,[t[19]||(t[19]=o("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Store Name",-1)),mt.value?u("",!0):(s(),n("div",ne,[o("span",se,d(ot.value.storeName||"Not specified"),1),o("button",{class:"ml-2 opacity-0 group-hover:opacity-100 text-gray-400 hover:text-gray-600 transition-opacity",onClick:Pt},[...t[16]||(t[16]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])])])),mt.value?(s(),n("div",oe,[o("div",ue,[p(o("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>pt.value=e),type:"text",class:c(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-300":mt.value&&!pt.value.trim()}]),placeholder:"Enter store name",onInput:Rt,onKeydown:$t,onBlur:Bt},null,34),[[g,pt.value]]),ht.value&&wt.value.length>0?(s(),n("div",de,[(s(!0),n(y,null,x(wt.value,(e,t)=>(s(),n("div",{key:e,class:c(["px-3 py-2 hover:bg-gray-100 cursor-pointer",{"bg-blue-100":t===kt.value}]),onMousedown:t=>zt(e)},d(e),43,ce))),128))])):u("",!0)]),o("button",{class:"text-green-600 hover:text-green-700",onClick:Et},[...t[17]||(t[17]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])]),o("button",{class:"text-gray-400 hover:text-gray-600",onClick:Ft},[...t[18]||(t[18]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):u("",!0)])]),o("div",ve,[o("div",null,[t[20]||(t[20]=o("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Items Detected",-1)),o("div",me,d(ot.value.totalItemsDetected),1)]),o("div",null,[t[21]||(t[21]=o("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Successfully Parsed",-1)),o("div",pe,d(ot.value.successfullyParsed),1)])]),ot.value.imageQualityAssessment?(s(),n("div",ge,[t[22]||(t[22]=o("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Image Quality",-1)),o("div",ye,d(ot.value.imageQualityAssessment),1)])):u("",!0),o("div",null,[t[23]||(t[23]=o("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Created",-1)),o("div",xe,d((a=ot.value.createdAt,new Date(a).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))),1)])])]),ot.value.items&&ot.value.items.length>0?(s(),n("div",be,[o("div",fe,[o("h2",he," Items ("+d(ot.value.items.length)+") ",1),o("div",we," Total: $"+d(ot.value.items.reduce((e,t)=>e+t.totalPrice,0).toFixed(2)),1)]),o("div",ke,[(s(!0),n(y,null,x(ot.value.items,e=>(s(),n("div",{key:e.id,class:"border rounded-lg p-4 hover:bg-gray-50"},[xt.value[e.id]?(s(),n("div",Pe,[o("div",Ee,[t[26]||(t[26]=o("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Item Name",-1)),p(o("input",{"onUpdate:modelValue":t=>bt.value[e.id].itemName=t,type:"text",class:"w-full border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter item name",onInput:t=>(async e=>{const t=bt.value[e];if(t)if(t.itemName&&t.itemName.length>0)try{const a=await w.getItemNames(t.itemName);ft.value[e]?.itemName&&(ft.value[e].itemName.options=a,ft.value[e].itemName.show=a.length>0,ft.value[e].itemName.selectedIndex=-1)}catch(a){}else Jt(e,"itemName")})(e.id),onKeydown:t=>Wt(t,e.id,"itemName"),onBlur:t=>Jt(e.id,"itemName")},null,40,Fe),[[g,bt.value[e.id].itemName]]),ft.value[e.id]?.itemName?.show&&(ft.value[e.id]?.itemName?.options?.length??0)>0?(s(),n("div",Re,[(s(!0),n(y,null,x(ft.value[e.id]?.itemName?.options??[],(t,a)=>(s(),n("div",{key:t,class:c(["px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-sm",{"bg-blue-100":a===(ft.value[e.id]?.itemName?.selectedIndex??-1)}]),onMousedown:a=>Gt(e.id,"itemName",t)},d(t),43,$e))),128))])):u("",!0)]),o("div",Be,[t[27]||(t[27]=o("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Category",-1)),p(o("input",{"onUpdate:modelValue":t=>bt.value[e.id].category=t,type:"text",class:"w-full border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter category",onInput:t=>(async e=>{const t=bt.value[e];if(t)if(t.category&&t.category.length>0)try{const a=await w.getCategories(t.category);ft.value[e]?.category&&(ft.value[e].category.options=a,ft.value[e].category.show=a.length>0,ft.value[e].category.selectedIndex=-1)}catch(a){}else Jt(e,"category")})(e.id),onKeydown:t=>Wt(t,e.id,"category"),onBlur:t=>Jt(e.id,"category")},null,40,ze),[[g,bt.value[e.id].category]]),ft.value[e.id]?.category?.show&&(ft.value[e.id]?.category?.options?.length??0)>0?(s(),n("div",Te,[(s(!0),n(y,null,x(ft.value[e.id]?.category?.options??[],(t,a)=>(s(),n("div",{key:t,class:c(["px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-sm",{"bg-blue-100":a===(ft.value[e.id]?.category?.selectedIndex??-1)}]),onMousedown:a=>Gt(e.id,"category",t)},d(t),43,He))),128))])):u("",!0)]),o("div",Oe,[o("div",null,[t[28]||(t[28]=o("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Quantity",-1)),p(o("input",{"onUpdate:modelValue":t=>bt.value[e.id].quantity=t,type:"number",step:"0.01",min:"0",class:"w-full border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:t=>Qt(e.id)},null,40,Ke),[[g,bt.value[e.id].quantity,void 0,{number:!0}]])]),o("div",null,[t[29]||(t[29]=o("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Price/Unit",-1)),p(o("input",{"onUpdate:modelValue":t=>bt.value[e.id].pricePerUnit=t,type:"number",step:"0.01",min:"0",class:"w-full border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:t=>Qt(e.id)},null,40,_e),[[g,bt.value[e.id].pricePerUnit,void 0,{number:!0}]])]),o("div",null,[t[30]||(t[30]=o("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Weight",-1)),p(o("input",{"onUpdate:modelValue":t=>bt.value[e.id].weightOriginal=t,type:"number",step:"0.01",min:"0",class:"w-full border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,qe),[[g,bt.value[e.id].weightOriginal,void 0,{number:!0}]])]),o("div",Ye,[t[31]||(t[31]=o("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Unit",-1)),p(o("input",{"onUpdate:modelValue":t=>bt.value[e.id].unit=t,type:"text",class:"w-full border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"kg, lb, etc.",onInput:t=>(async e=>{const t=bt.value[e];if(t)if(t.unit&&t.unit.length>0)try{const a=await w.getUnits(t.unit);ft.value[e]?.unit&&(ft.value[e].unit.options=a,ft.value[e].unit.show=a.length>0,ft.value[e].unit.selectedIndex=-1)}catch(a){}else Jt(e,"unit")})(e.id),onKeydown:t=>Wt(t,e.id,"unit"),onBlur:t=>Jt(e.id,"unit")},null,40,Qe),[[g,bt.value[e.id].unit]]),ft.value[e.id]?.unit?.show&&(ft.value[e.id]?.unit?.options?.length??0)>0?(s(),n("div",Je,[(s(!0),n(y,null,x(ft.value[e.id]?.unit?.options??[],(t,a)=>(s(),n("div",{key:t,class:c(["px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-sm",{"bg-blue-100":a===(ft.value[e.id]?.unit?.selectedIndex??-1)}]),onMousedown:a=>Gt(e.id,"unit",t)},d(t),43,Ge))),128))])):u("",!0)])]),o("div",null,[t[32]||(t[32]=o("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Notes",-1)),p(o("textarea",{"onUpdate:modelValue":t=>bt.value[e.id].notes=t,rows:"2",class:"w-full border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Additional notes..."},null,8,We),[[g,bt.value[e.id].notes]])]),o("div",Xe,[t[33]||(t[33]=o("span",{class:"text-sm font-medium text-gray-700"},"Total Price: ",-1)),o("span",Ze,"$"+d((bt.value[e.id].totalPrice||0).toFixed(2)),1)]),o("div",et,[o("button",{class:"px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-medium",onClick:t=>(async e=>{try{const t=bt.value[e];if(!t)return;const a=St(t.itemName||""),l=St(t.category||""),r=St(t.unit||""),i=St(t.notes||"");if(!a)return void Vt("Invalid item name","Item name contains invalid characters.");const n={...t,itemName:a.toLowerCase(),category:l.toLowerCase(),unit:r.toLowerCase(),notes:i},s=await w.updateReceiptItem(e,n);if(ot.value?.items){const t=ot.value.items.findIndex(t=>t.id===e);-1!==t&&(ot.value.items[t]=s)}xt.value[e]=!1,delete bt.value[e],delete ft.value[e],Dt("Item updated successfully")}catch(t){Vt("Failed to update item")}})(e.id)}," Save ",8,tt),o("button",{class:"px-3 py-1 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 text-sm font-medium",onClick:t=>{return a=e.id,xt.value[a]=!1,delete bt.value[a],void delete ft.value[a];var a}}," Cancel ",8,at)])])):(s(),n("div",Ie,[o("div",De,[o("h3",Ve,d(Yt(e.itemName)),1),o("div",Ne,[o("span",Ce,"$"+d(e.totalPrice.toFixed(2)),1),o("button",{class:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-gray-600 transition-opacity",onClick:t=>(e=>{xt.value[e.id]=!0,bt.value[e.id]={...e},ft.value[e.id]={itemName:{show:!1,options:[],selectedIndex:-1},category:{show:!1,options:[],selectedIndex:-1},unit:{show:!1,options:[],selectedIndex:-1}}})(e)},[...t[25]||(t[25]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Se)])]),o("div",Me,[o("div",Ue,[o("span",null,"Qty: "+d(e.quantity||1),1),o("span",null,"Unit: $"+d((e.pricePerUnit||0).toFixed(2)),1),e.weightOriginal?(s(),n("span",Ae,"Weight: "+d(e.weightOriginal)+d(e.unit?` ${Yt(e.unit)}`:""),1)):u("",!0)]),e.category?(s(),n("span",Le,d(Yt(e.category)),1)):u("",!0)]),e.notes?(s(),n("div",je,d(e.notes),1)):u("",!0)]))]))),128))])])):u("",!0),ot.value.claudeResponseJson&&ct.value?(s(),n("div",lt,[t[34]||(t[34]=o("h2",{class:"text-xl font-semibold text-gray-900 mb-4"}," Claude AI Response ",-1)),o("pre",rt,d(JSON.stringify(ot.value.claudeResponseJson,null,2)),1)])):u("",!0)])]),o("div",it,[o("button",{class:"text-sm text-gray-500 hover:text-gray-700",onClick:t[3]||(t[3]=e=>ct.value=!ct.value)},d(ct.value?"Hide":"Show")+" Debug Info ",1)])])):(s(),n("div",T,[...t[8]||(t[8]=[o("div",{class:"text-gray-500"},"Receipt not found",-1)])]))]);var a}}});export{nt as default};
