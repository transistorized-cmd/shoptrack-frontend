import{d as e,c as t,o as a,e as s,f as i,t as l,n as c,F as n,b as r,a as o,w as p,p as d,u as g,R as u,r as x,x as m,C as y,D as b,i as v,E as f,l as h}from"./chunk-D50-beEz.js";import{u as w,T as k}from"./index-BUkE986E.js";import{u as D}from"./chunk-C1DHrtJO.js";const C={class:"card p-6 hover:shadow-lg transition-shadow"},S={class:"flex items-start justify-between mb-4"},R={class:"flex-1 min-w-0"},P={class:"text-sm font-medium text-gray-900 truncate"},j={class:"text-xs text-gray-500 mt-1"},z={class:"ml-2 flex-shrink-0"},U={key:0,class:"mb-3"},V={class:"text-xs text-gray-500"},_={class:"grid grid-cols-2 gap-4 mb-4"},N={class:"text-center p-3 bg-gray-50 rounded-lg"},A={class:"text-lg font-semibold text-gray-900"},E={class:"text-center p-3 bg-gray-50 rounded-lg"},F={class:"text-lg font-semibold text-gray-900"},I={key:1,class:"mb-4"},B={class:"space-y-1"},H={class:"text-gray-600 truncate"},M={class:"text-gray-900 font-medium"},O={key:0,class:"text-xs text-gray-500 text-center pt-1"},$={class:"flex items-center justify-between pt-4 border-t border-gray-200"},L={class:"flex space-x-2"},T=["disabled"],Y={key:2,class:"mt-3"},q=e({__name:"ReceiptCard",props:{receipt:{}},emits:["delete","reprocess","view"],setup(e){const x=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(e,m)=>{return a(),t("div",C,[s("div",S,[s("div",R,[s("h3",P,l(e.receipt.filename),1),s("p",j,l(e.receipt.receiptDate?(y=e.receipt.receiptDate,new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})):"No date"),1)]),s("div",z,[s("span",{class:c(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",x(e.receipt.processingStatus)])},l(e.receipt.processingStatus),3)])]),e.receipt.receiptNumber?(a(),t("div",U,[s("p",V,"Receipt #"+l(e.receipt.receiptNumber),1)])):i("",!0),s("div",_,[s("div",N,[s("p",A,l(e.receipt.totalItemsDetected),1),m[2]||(m[2]=s("p",{class:"text-xs text-gray-500"},"Items Detected",-1))]),s("div",E,[s("p",F,l(e.receipt.successfullyParsed),1),m[3]||(m[3]=s("p",{class:"text-xs text-gray-500"},"Successfully Parsed",-1))])]),e.receipt.items&&e.receipt.items.length>0?(a(),t("div",I,[m[4]||(m[4]=s("h4",{class:"text-xs font-medium text-gray-700 mb-2"},"Items",-1)),s("div",B,[(a(!0),t(n,null,r(e.receipt.items.slice(0,3),e=>(a(),t("div",{key:e.id,class:"flex justify-between text-xs"},[s("span",H,l(e.itemName),1),s("span",M,"$"+l(e.totalPrice.toFixed(2)),1)]))),128)),e.receipt.items.length>3?(a(),t("div",O," +"+l(e.receipt.items.length-3)+" more items ",1)):i("",!0)])])):i("",!0),s("div",$,[s("div",L,[s("button",{disabled:"processing"===e.receipt.processingStatus,class:"text-xs btn btn-secondary",title:"Reprocess receipt",onClick:m[0]||(m[0]=t=>e.$emit("reprocess",e.receipt.id))}," 🔄 Reprocess ",8,T),o(g(u),{to:{name:"receipt-detail",params:{id:e.receipt.id}},class:"text-xs btn btn-secondary",title:"View details"},{default:p(()=>[...m[5]||(m[5]=[d(" 👁️ View ",-1)])]),_:1},8,["to"])]),s("button",{class:"text-xs text-red-600 hover:text-red-800",title:"Delete receipt",onClick:m[1]||(m[1]=t=>e.$emit("delete",e.receipt.id))}," 🗑️ Delete ")]),"processing"===e.receipt.processingStatus?(a(),t("div",Y,[...m[6]||(m[6]=[s("div",{class:"flex items-center space-x-2 text-xs text-blue-600"},[s("svg",{class:"animate-spin h-3 w-3",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),s("span",null,"Processing...")],-1)])])):i("",!0)]);var y}}}),G={class:"space-y-6"},J={class:"flex items-center justify-between"},K={class:"card p-6"},Q={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},W={key:0,class:"text-center py-12"},X={key:1,class:"text-center py-12"},Z={class:"text-red-600"},ee={key:2,class:"text-center py-12"},te={key:3,class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3"},ae={key:4,class:"flex items-center justify-between"},se={class:"text-sm text-gray-700"},ie={class:"flex items-center space-x-2"},le=["disabled"],ce={class:"text-sm text-gray-700"},ne=["disabled"],re=e({__name:"Receipts",setup(e){const c=w(),C=x({processingStatus:"",startDate:"",endDate:"",search:""}),S=async()=>{const e={page:c.pagination.page,pageSize:c.pagination.pageSize,...Object.fromEntries(Object.entries(C.value).filter(([e,t])=>""!==t))};await c.fetchReceipts(e)},R=D(S,k.DEBOUNCE_SEARCH),P=async()=>{c.pagination.page<c.pagination.totalPages&&(c.pagination.page++,await S())},j=async()=>{c.pagination.page>1&&(c.pagination.page--,await S())},z=async e=>{if(confirm("Are you sure you want to delete this receipt?"))try{await c.deleteReceipt(e)}catch(t){}},U=async e=>{try{await c.reprocessReceipt(e)}catch(t){}};return m(()=>{S()}),(e,x)=>(a(),t("div",G,[s("div",J,[x[6]||(x[6]=s("h1",{class:"text-2xl font-bold text-gray-900"},"Receipts",-1)),o(g(u),{to:"/upload",class:"btn btn-primary"},{default:p(()=>[...x[5]||(x[5]=[d(" Upload Receipt ",-1)])]),_:1})]),s("div",K,[s("div",Q,[s("div",null,[x[8]||(x[8]=s("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),y(s("select",{id:"status","onUpdate:modelValue":x[0]||(x[0]=e=>C.value.processingStatus=e),class:"input",onChange:S},[...x[7]||(x[7]=[v('<option value="">All Statuses</option><option value="pending">Pending</option><option value="processing">Processing</option><option value="completed">Completed</option><option value="failed">Failed</option>',5)])],544),[[b,C.value.processingStatus]])]),s("div",null,[x[9]||(x[9]=s("label",{for:"startDate",class:"block text-sm font-medium text-gray-700 mb-1"},"Start Date",-1)),y(s("input",{id:"startDate","onUpdate:modelValue":x[1]||(x[1]=e=>C.value.startDate=e),type:"date",class:"input",onChange:S},null,544),[[f,C.value.startDate]])]),s("div",null,[x[10]||(x[10]=s("label",{for:"endDate",class:"block text-sm font-medium text-gray-700 mb-1"},"End Date",-1)),y(s("input",{id:"endDate","onUpdate:modelValue":x[2]||(x[2]=e=>C.value.endDate=e),type:"date",class:"input",onChange:S},null,544),[[f,C.value.endDate]])]),s("div",null,[x[11]||(x[11]=s("label",{for:"search",class:"block text-sm font-medium text-gray-700 mb-1"},"Search",-1)),y(s("input",{id:"search","onUpdate:modelValue":x[3]||(x[3]=e=>C.value.search=e),type:"text",placeholder:"Search receipts...",class:"input",onInput:x[4]||(x[4]=(...e)=>g(R)&&g(R)(...e))},null,544),[[f,C.value.search]])])])]),g(c).loading?(a(),t("div",W,[...x[12]||(x[12]=[v('<div class="inline-flex items-center space-x-2"><svg class="animate-spin h-5 w-5 text-shoptrack-600" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-gray-500">Loading receipts...</span></div>',1)])])):g(c).error?(a(),t("div",X,[s("div",Z,l(g(c).error),1),s("button",{class:"btn btn-secondary mt-4",onClick:S}," Try Again ")])):g(c).hasReceipts?(a(),t("div",te,[(a(!0),t(n,null,r(g(c).receipts,e=>(a(),h(q,{key:e.id,receipt:e,onDelete:z,onReprocess:U},null,8,["receipt"]))),128))])):(a(),t("div",ee,[x[14]||(x[14]=s("div",{class:"text-gray-500 mb-4"},"No receipts found",-1)),o(g(u),{to:"/upload",class:"btn btn-primary"},{default:p(()=>[...x[13]||(x[13]=[d("Upload Your First Receipt",-1)])]),_:1})])),g(c).pagination.totalPages>1?(a(),t("div",ae,[s("div",se," Showing "+l((g(c).pagination.page-1)*g(c).pagination.pageSize+1)+" to "+l(Math.min(g(c).pagination.page*g(c).pagination.pageSize,g(c).pagination.totalCount))+" of "+l(g(c).pagination.totalCount)+" results ",1),s("div",ie,[s("button",{disabled:g(c).pagination.page<=1,class:"btn btn-secondary disabled:opacity-50",onClick:j}," Previous ",8,le),s("span",ce," Page "+l(g(c).pagination.page)+" of "+l(g(c).pagination.totalPages),1),s("button",{disabled:g(c).pagination.page>=g(c).pagination.totalPages,class:"btn btn-secondary disabled:opacity-50",onClick:P}," Next ",8,ne)])])):i("",!0)]))}});export{re as default};
