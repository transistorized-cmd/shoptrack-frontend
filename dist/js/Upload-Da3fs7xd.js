import{d as e,r as s,x as l,c as t,o as a,e as r,f as i,p as n,G as o,n as u,t as c,F as p,b as d,H as g,l as m,w as y,u as v,R as f,v as x,a as h,k as b}from"./chunk-D50-beEz.js";import{F as w,p as k,a as F,u as M,_ as B}from"./index-BUkE986E.js";import"./chunk-C1DHrtJO.js";const C={".jpg":{signature:[255,216,255],mimeTypes:["image/jpeg","image/jpg"]},".jpeg":{signature:[255,216,255],mimeTypes:["image/jpeg","image/jpg"]},".png":{signature:[137,80,78,71,13,10,26,10],mimeTypes:["image/png"]},".gif":{signature:[71,73,70,56],mimeTypes:["image/gif"]},".pdf":{signature:[37,80,68,70],mimeTypes:["application/pdf"]},".webp":{signature:[82,73,70,70],mimeTypes:["image/webp"]},".bmp":{signature:[66,77],mimeTypes:["image/bmp"]}},P=new Set([".exe",".bat",".cmd",".com",".pif",".scr",".vbs",".js",".jar",".app",".deb",".pkg",".dmg",".sh",".bash",".ps1",".msi",".dll",".sys",".bin",".run",".action",".apk",".command",".cpl",".inf",".ins",".inx",".isu",".job",".jse",".lnk",".mst",".paf",".reg",".rgs",".sct",".shb",".shs",".u3p",".vb",".vbe",".vbscript",".ws",".wsf",".wsh"]),S=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".pdf"],T=["image/jpeg","image/jpg","image/png","image/gif","image/bmp","image/webp","application/pdf"],j=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"];async function z(e,s={}){const l=[],t=[],a=s.maxSizeBytes||w.DEFAULT_MAX_SIZE_BYTES,r=s.allowedExtensions||S,i=s.allowedMimeTypes||T,n=!1!==s.checkFileSignature,o=!1!==s.strictMode;if(!e)return l.push("No file provided"),L(!1,l,t,"",0,"unknown");if(0===e.size)return l.push("File is empty"),L(!1,l,t,e.name,0,"unknown");if(e.size>a){const s=Math.round(a/w.MB),t=Math.round(e.size/w.MB);l.push(`File size (${t}MB) exceeds maximum allowed size (${s}MB)`)}const u=function(e){const s=[],l=[];e.includes("\0")&&s.push("Filename contains null bytes"),(e.includes("..")||e.includes("./")||e.includes(".\\"))&&s.push("Filename contains path traversal sequences"),e.length>255&&s.push("Filename is too long (max 255 characters)"),e.startsWith(".")&&".htaccess"!==e&&l.push("Hidden file detected"),(e.match(/\./g)||[]).length>1&&l.push("Multiple file extensions detected");const t=e.split(".")[0].toUpperCase();return j.includes(t)&&s.push("Filename uses reserved system name"),/[<>:"|?*\\/\x00-\x1F]/g.test(e)&&s.push("Filename contains invalid characters"),{isValid:0===s.length,errors:s,warnings:l}}(e.name);u.isValid||l.push(...u.errors),t.push(...u.warnings);const c=E(e.name).toLowerCase();if(P.has(c)&&l.push(`Dangerous file type detected: ${c}`),r.includes(c)||l.push(`File type not allowed: ${c}. Allowed types: ${r.join(", ")}`),o&&e.type){i.includes(e.type.toLowerCase())||t.push(`MIME type mismatch: ${e.type} may not be allowed`);const s=C[c]?.mimeTypes||[];s.length>0&&!s.includes(e.type.toLowerCase())&&t.push(`MIME type (${e.type}) doesn't match file extension (${c})`)}if(n&&C[c]){const s=await async function(e,s){const l=C[s];if(!l)return!0;try{const s=await function(e,s){return new Promise((l,t)=>{const a=new FileReader,r=e.slice(0,s);a.onload=()=>{a.result instanceof ArrayBuffer?l(a.result):t(new Error("Failed to read file as ArrayBuffer"))},a.onerror=()=>{t(new Error("Error reading file"))},a.readAsArrayBuffer(r)})}(e,l.signature.length),t=new Uint8Array(s);for(let e=0;e<l.signature.length;e++)if(t[e]!==l.signature[e])return!1;return!0}catch(t){return!1}}(e,c);s||l.push("File content doesn't match file extension (possible file spoofing)")}const p=function(e){const s=[];/%[0-9a-fA-F]{2}/.test(e)&&s.push("Filename contains URL-encoded characters");const l=["â€®","â€­","â€¬","â¦","â§","â¨","â©"];for(const t of l)if(e.includes(t)){s.push("Filename contains Unicode direction override characters");break}return/[Ð°-ÑÐ-Ð¯]/.test(e)&&s.push("Filename contains Cyrillic characters (possible homograph attack)"),s}(e.name);p.length>0&&t.push(...p);const d=function(e){if(!e)return"unknown_file";if(!(e=(e=(e=(e=(e=(e=e.split("/").pop()||e).split("\\").pop()||e).replace(/[<>:"|?*\\/\x00-\x1F]/g,"_")).replace(/[\u202E\u202D\u202C\u2066\u2067\u2068\u2069]/g,"")).replace(/_+/g,"_")).replace(/^[_.]|[_.]$/g,""))||0===e.length)return`file_${Date.now()}`;if(e.length>100){const s=E(e),l=e.substring(0,100-s.length-1);e=l+s}return e}(e.name),g=function(e){return{".jpg":"JPEG Image",".jpeg":"JPEG Image",".png":"PNG Image",".gif":"GIF Image",".bmp":"BMP Image",".webp":"WebP Image",".pdf":"PDF Document",".csv":"CSV File",".html":"HTML Document",".htm":"HTML Document"}[e]||`Unknown (${e})`}(c,e.type);return L(0===l.length,l,t,d,e.size,g)}function E(e){const s=e.lastIndexOf(".");return-1===s?"":e.substring(s).toLowerCase()}function L(e,s,l,t,a,r){return{isValid:e,errors:s,warnings:l,sanitizedFileName:t,fileSize:a,detectedType:r}}const U={class:"bg-white rounded-lg shadow-md p-6 mb-8"},D={key:0},I={key:1,class:"space-y-2"},_={class:"text-lg font-medium text-gray-900"},A={class:"text-sm text-gray-500"},K={key:0,class:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg"},V={class:"flex items-start"},$={class:"flex-1"},O={class:"text-sm text-red-700 space-y-1"},R={key:1,class:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},G={class:"flex items-start"},H={class:"flex-1"},N={class:"text-sm text-yellow-700 space-y-1"},q={key:2,class:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},W={class:"flex items-center"},J={class:"font-medium text-blue-900"},X={class:"text-sm text-blue-700"},Z={class:"mt-6 text-center"},Q=["disabled"],Y={key:0,class:"flex items-center justify-center"},ee={key:1},se={key:0,class:"bg-white rounded-lg shadow-md p-6 mt-8"},le={class:"space-y-4"},te={class:"text-sm text-gray-600"},ae={key:0,class:"bg-gray-50 p-4 rounded-lg"},re={class:"grid grid-cols-2 gap-4 text-sm"},ie={class:"ml-1 text-gray-900"},ne={class:"ml-1 text-gray-900"},oe={class:"ml-1 text-gray-900"},ue={class:"ml-1 text-gray-900 capitalize"},ce={key:1},pe={class:"list-disc list-inside space-y-1 text-sm text-red-800"},de={class:"flex justify-end space-x-3"},ge=e({__name:"QuickUpload",setup(e){const x=s(null),h=s(),b=s(!1),F=s(!1),M=s(null),B=s(null),C=s([]),P=s(null),S=s(!1),T=async e=>{const s=e.target;s.files&&s.files.length>0&&await E(s.files[0])},j=async e=>{b.value=!1,e.dataTransfer?.files&&e.dataTransfer.files.length>0&&await E(e.dataTransfer.files[0])},E=async e=>{P.value=null,S.value=!1;const s=await z(e,{maxSizeBytes:w.DEFAULT_MAX_SIZE_BYTES,allowedExtensions:[".jpg",".jpeg",".png",".gif",".webp",".pdf",".csv"],checkFileSignature:!0,strictMode:!0});if(P.value=s,!s.isValid)return S.value=!0,x.value=null,void(h.value&&(h.value.value=""));x.value=e,await ge(e)},L=()=>{x.value=null,M.value=null,P.value=null,S.value=!1,h.value&&(h.value.value="")},ge=async e=>{try{const s=await k.detectPlugin(e,C.value);M.value=s.success?s:null}catch(s){M.value=null}},me=async()=>{if(x.value)if(P.value&&P.value.isValid){F.value=!0,B.value=null;try{const e=await k.uploadWithAutoDetection(x.value);B.value=e}catch(e){B.value={receipt:{},items:[],success:!1,message:"Upload failed due to an unexpected error",isDuplicate:!1,errors:[e instanceof Error?e.message:"Unknown error"]}}finally{F.value=!1}}else S.value=!0},ye=e=>{if(0===e)return"0 B";const s=w.KB,l=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,l)).toFixed(1))+" "+["B","KB","MB","GB"][l]},ve=()=>{B.value=null,L()};return l(async()=>{try{const e=await k.getAllPlugins();C.value=e.receiptPlugins}catch(e){}}),(e,s)=>(a(),t("div",U,[s[18]||(s[18]=r("h2",{class:"text-xl font-semibold text-gray-800 mb-4 flex items-center"},[r("svg",{class:"w-6 h-6 mr-2 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),n(" Quick Upload ")],-1)),s[19]||(s[19]=r("p",{class:"text-gray-600 mb-6"}," Drop your file here and we'll automatically detect the best processor for it. ",-1)),r("form",{onSubmit:o(me,["prevent"])},[r("div",{class:u(["border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",{"border-blue-500 bg-blue-50":b.value,"border-green-500 bg-green-50":x.value}]),onClick:s[0]||(s[0]=e=>h.value?.click()),onDragover:s[1]||(s[1]=o(e=>b.value=!0,["prevent"])),onDragenter:s[2]||(s[2]=o(e=>b.value=!0,["prevent"])),onDragleave:s[3]||(s[3]=o(e=>b.value=!1,["prevent"])),onDrop:o(j,["prevent"])},[r("input",{ref_key:"quickFileInput",ref:h,type:"file",accept:".jpg,.jpeg,.png,.gif,.webp,.pdf,.csv",class:"hidden",required:"",onChange:T},null,544),x.value?(a(),t("div",I,[s[5]||(s[5]=r("div",{class:"mx-auto h-12 w-12 text-green-500 mb-2"},"ðŸ“„",-1)),r("p",_,c(x.value.name),1),r("p",A," Size: "+c(ye(x.value.size)),1),r("button",{type:"button",class:"text-sm text-red-600 hover:text-red-800",onClick:o(L,["stop"])}," Remove ")])):(a(),t("div",D,[...s[4]||(s[4]=[r("svg",{class:"mx-auto h-16 w-16 text-gray-400 mb-4",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48"},[r("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),r("p",{class:"text-xl font-medium text-gray-900 mb-2"}," Drop your file here or click to browse ",-1),r("p",{class:"text-sm text-gray-500"}," Supported: JPG, JPEG, PNG, GIF, WEBP, PDF, CSV ",-1)])]))],34),S.value&&P.value&&!P.value.isValid?(a(),t("div",K,[r("div",V,[s[7]||(s[7]=r("svg",{class:"w-5 h-5 text-red-600 mt-0.5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),r("div",$,[s[6]||(s[6]=r("p",{class:"font-medium text-red-900 mb-1"},"File validation failed",-1)),r("ul",O,[(a(!0),t(p,null,d(P.value.errors,e=>(a(),t("li",{key:e}," â€¢ "+c(e),1))),128))])])])])):i("",!0),P.value&&P.value.warnings.length>0&&P.value.isValid?(a(),t("div",R,[r("div",G,[s[9]||(s[9]=r("svg",{class:"w-5 h-5 text-yellow-600 mt-0.5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),r("div",H,[s[8]||(s[8]=r("p",{class:"font-medium text-yellow-900 mb-1"},"Security warnings",-1)),r("ul",N,[(a(!0),t(p,null,d(P.value.warnings,e=>(a(),t("li",{key:e}," â€¢ "+c(e),1))),128))])])])])):i("",!0),M.value?(a(),t("div",q,[r("div",W,[r("div",{class:"w-3 h-3 rounded-full mr-3",style:g({backgroundColor:M.value.color})},null,4),r("div",null,[r("p",J," Will use: "+c(M.value.pluginName),1),r("p",X,c(M.value.pluginDescription),1)])])])):i("",!0),r("div",Z,[r("button",{type:"submit",disabled:!x.value||F.value,class:"px-8 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"},[F.value?(a(),t("span",Y,[...s[10]||(s[10]=[r("svg",{class:"animate-spin -mr-1 ml-3 h-5 w-5 text-white inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),n(" Processing... ",-1)])])):(a(),t("span",ee,"Process File"))],8,Q)])],32),B.value?(a(),t("div",se,[r("h3",{class:u(["text-lg font-medium mb-4",B.value.success?"text-green-900":"text-red-900"])},c(B.value.success?"Upload Successful!":"Upload Failed"),3),r("div",le,[r("p",te,c(B.value.message),1),B.value.success&&B.value.receipt?(a(),t("div",ae,[s[15]||(s[15]=r("h4",{class:"text-sm font-medium text-gray-900 mb-2"}," Receipt Details ",-1)),r("div",re,[r("div",null,[s[11]||(s[11]=r("span",{class:"text-gray-500"},"Filename:",-1)),r("span",ie,c(B.value.receipt.filename),1)]),r("div",null,[s[12]||(s[12]=r("span",{class:"text-gray-500"},"Items Found:",-1)),r("span",ne,c(B.value.receipt.totalItemsDetected),1)]),r("div",null,[s[13]||(s[13]=r("span",{class:"text-gray-500"},"Successfully Parsed:",-1)),r("span",oe,c(B.value.receipt.successfullyParsed),1)]),r("div",null,[s[14]||(s[14]=r("span",{class:"text-gray-500"},"Status:",-1)),r("span",ue,c(B.value.receipt.processingStatus),1)])])])):i("",!0),B.value.errors&&B.value.errors.length>0?(a(),t("div",ce,[s[16]||(s[16]=r("h4",{class:"text-sm font-medium text-red-900 mb-2"},"Errors:",-1)),r("ul",pe,[(a(!0),t(p,null,d(B.value.errors,e=>(a(),t("li",{key:e},c(e),1))),128))])])):i("",!0),r("div",de,[r("button",{class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:ve}," Upload Another "),B.value.success?(a(),m(v(f),{key:0,to:"/receipts",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},{default:y(()=>[...s[17]||(s[17]=[n(" View Receipts ",-1)])]),_:1})):i("",!0)])])])):i("",!0)]))}}),me={class:"max-w-6xl mx-auto py-8 px-4"},ye={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8"},ve={class:"flex items-center justify-between"},fe={class:"flex items-center"},xe={class:"text-2xl"},he={class:"text-xl font-semibold text-gray-900"},be={class:"text-sm text-gray-600"},we={class:"text-xs text-gray-500"},ke={class:"p-6"},Fe={class:"text-gray-700 mb-4"},Me={class:"flex flex-wrap gap-2 mb-4"},Be={key:0,class:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full"},Ce={key:1,class:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full"},Pe={key:2,class:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full"},Se={class:"space-y-3"},Te=["onSubmit"],je={class:"flex"},ze=["accept","onChange"],Ee=["disabled"],Le={key:0},Ue={key:1},De={key:0,class:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg"},Ie={class:"flex items-start"},_e={class:"text-sm"},Ae={class:"mt-1 text-red-700 space-y-1"},Ke={key:1,class:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg"},Ve={class:"flex items-start"},$e={class:"text-sm"},Oe={class:"mt-1 text-yellow-700 space-y-1"},Re=["onClick"],Ge={class:"mt-4 pt-4 border-t border-gray-200"},He={class:"flex justify-between text-xs text-gray-500"},Ne={key:1,class:"bg-gray-50 rounded-lg p-6"},qe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},We={class:"font-mono text-sm uppercase font-medium"},Je={class:"flex space-x-1"},Xe=["title"],Ze={key:2,class:"bg-white rounded-lg shadow-md p-6 mt-8"},Qe={class:"space-y-4"},Ye={class:"text-sm text-gray-600"},es={key:0,class:"bg-gray-50 p-4 rounded-lg"},ss={class:"grid grid-cols-2 gap-4 text-sm"},ls={class:"ml-1 text-gray-900"},ts={class:"ml-1 text-gray-900"},as={class:"ml-1 text-gray-900"},rs={class:"ml-1 text-gray-900 capitalize"},is={key:1},ns={class:"list-disc list-inside space-y-1 text-sm text-red-800"},os={class:"flex justify-end space-x-3"},us=B(e({__name:"Upload",setup(e){const k=b(),B=F(),C=M(),P=s([{key:"generic-receipt",name:"Generic Receipt",description:"Process receipts from any store using Claude AI image analysis. Supports images and PDF files.",version:"1.0.0",supportedFileTypes:["jpg","jpeg","png","gif","webp","pdf"],maxFileSizeKB:2048,icon:"ðŸ§¾",color:"#10b981",supportsManualEntry:!1,supportsBatchProcessing:!1,requiresImageConversion:!0,type:"receipt"},{key:"amazon",name:"Amazon Orders",description:"Import Amazon order data from CSV exports or PDF invoices. Supports bulk imports and manual entry.",version:"1.0.0",supportedFileTypes:["csv","pdf"],maxFileSizeKB:10240,icon:"ðŸ“¦",color:"#ff9900",supportsManualEntry:!0,supportsBatchProcessing:!0,requiresImageConversion:!1,type:"receipt"}]),S=s({}),T=s({}),j=s({}),E=s({}),L=s(null),U=x(()=>{const e={};return P.value.forEach(s=>{s.supportedFileTypes.forEach(l=>{e[l]||(e[l]=[]),e[l].push(s)})}),e}),D=e=>{if(0===e)return"0 B";const s=w.KB,l=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,l)).toFixed(1))+" "+["B","KB","MB","GB"][l]},I=()=>{L.value=null};return l(async()=>{try{await B.fetchAllPlugins(),B.availableReceiptPlugins.length>0&&(P.value=B.availableReceiptPlugins)}catch(e){}}),(e,s)=>(a(),t("div",me,[s[13]||(s[13]=r("div",{class:"mb-8"},[r("h1",{class:"text-3xl font-bold text-gray-900 mb-2"}," Upload Receipt or Order "),r("p",{class:"text-gray-600"}," Choose the best method to import your purchase data. Our system will automatically process your files and extract item details for analytics. ")],-1)),h(ge),P.value.length>0?(a(),t("div",ye,[(a(!0),t(p,null,d(P.value,e=>(a(),t("div",{key:e.key,class:"bg-white rounded-lg shadow-md overflow-hidden"},[r("div",{class:"p-6 border-b border-gray-200 plugin-header",style:g({"--plugin-color":e.color})},[r("div",ve,[r("div",fe,[r("div",{class:"w-12 h-12 rounded-full flex items-center justify-center mr-4 plugin-icon",style:g({"--plugin-color":e.color})},[r("span",xe,c(e.icon),1)],4),r("div",null,[r("h3",he,c(e.name),1),r("p",be,"v"+c(e.version),1)])]),r("div",we,c(e.supportedFileTypes.join(", ").toUpperCase()),1)])],4),r("div",ke,[r("p",Fe,c(e.description),1),r("div",Me,[e.supportsManualEntry?(a(),t("span",Be," Manual Entry ")):i("",!0),e.supportsBatchProcessing?(a(),t("span",Ce," Batch Processing ")):i("",!0),e.requiresImageConversion?(a(),t("span",Pe," Image Processing ")):i("",!0)]),r("div",Se,[r("form",{class:"plugin-form",onSubmit:o(s=>(async e=>{if(!e.file)return;const s=P.value.find(s=>s.key===e.pluginKey),l=await z(e.file,{maxSizeBytes:1024*(s?.maxFileSizeKB||10240),allowedExtensions:s?.supportedFileTypes.map(e=>`.${e}`)||[],checkFileSignature:!0,strictMode:!0});if(!l.isValid)return j.value[e.pluginKey]=l,void(E.value[e.pluginKey]=!0);T.value[e.pluginKey]=!0,L.value=null;try{const s=await C.uploadReceipt(e.file,e.pluginKey);L.value=s,E.value[e.pluginKey]=!1,j.value[e.pluginKey]=null}catch(t){L.value={receipt:{},items:[],success:!1,message:"Upload failed due to an unexpected error",isDuplicate:!1,errors:[t instanceof Error?t.message:"Unknown error"]}}finally{T.value[e.pluginKey]=!1}})({file:S.value[e.key],pluginKey:e.key}),["prevent"])},[r("div",je,[r("input",{type:"file",accept:e.supportedFileTypes.map(e=>`.${e}`).join(","),class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:text-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-opacity-50",required:"",onChange:s=>(async(e,s)=>{const l=e.target;if(l.files&&l.files.length>0){const e=l.files[0],t=P.value.find(e=>e.key===s),a=await z(e,{maxSizeBytes:(t?.maxFileSizeKB||w.PLUGIN_DEFAULT_MAX_SIZE_KB)*w.KB,allowedExtensions:t?.supportedFileTypes.map(e=>`.${e}`)||[],checkFileSignature:!0,strictMode:!0});if(j.value[s]=a,!a.isValid)return E.value[s]=!0,S.value[s]=null,void(l.value="");E.value[s]=!1,S.value[s]=e}})(s,e.key)},null,40,ze),r("button",{type:"submit",class:"ml-3 px-4 py-2 text-white rounded-lg hover:opacity-90 transition-opacity disabled:bg-gray-400 disabled:cursor-not-allowed plugin-button",style:g({"--plugin-color":e.color}),disabled:!S.value[e.key]||T.value[e.key]},[T.value[e.key]?(a(),t("span",Le,"Uploading...")):(a(),t("span",Ue,"Upload"))],12,Ee)]),E.value[e.key]&&j.value[e.key]&&!j.value[e.key].isValid?(a(),t("div",De,[r("div",Ie,[s[1]||(s[1]=r("svg",{class:"w-4 h-4 text-red-600 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),r("div",_e,[s[0]||(s[0]=r("p",{class:"font-medium text-red-900"}," File validation failed: ",-1)),r("ul",Ae,[(a(!0),t(p,null,d(j.value[e.key].errors,e=>(a(),t("li",{key:e}," â€¢ "+c(e),1))),128))])])])])):i("",!0),j.value[e.key]&&j.value[e.key].warnings.length>0&&j.value[e.key].isValid?(a(),t("div",Ke,[r("div",Ve,[s[3]||(s[3]=r("svg",{class:"w-4 h-4 text-yellow-600 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[r("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),r("div",$e,[s[2]||(s[2]=r("p",{class:"font-medium text-yellow-900"}," Security warnings: ",-1)),r("ul",Oe,[(a(!0),t(p,null,d(j.value[e.key].warnings,e=>(a(),t("li",{key:e}," â€¢ "+c(e),1))),128))])])])])):i("",!0)],40,Te),e.supportsManualEntry?(a(),t("button",{key:0,class:"block w-full text-center px-4 py-2 border-2 rounded-lg hover:bg-gray-50 transition-colors plugin-manual-button",style:g({"--plugin-color":e.color}),onClick:s=>{return l=e.key,void k.push(`/upload/${l}/manual`);var l}}," Manual Entry ",12,Re)):i("",!0)]),r("div",Ge,[r("div",He,[r("span",null,"Max size: "+c(D(e.maxFileSizeKB*v(w).KB)),1),r("span",null,c(e.supportedFileTypes.length)+" file types",1)])])])]))),128))])):i("",!0),P.value.length>0?(a(),t("div",Ne,[s[4]||(s[4]=r("h3",{class:"text-lg font-semibold text-gray-800 mb-4"}," Supported File Types ",-1)),r("div",qe,[(a(!0),t(p,null,d(U.value,(e,s)=>(a(),t("div",{key:s,class:"flex items-center justify-between p-3 bg-white rounded border"},[r("span",We,c(s),1),r("div",Je,[(a(!0),t(p,null,d(e,e=>(a(),t("div",{key:e.key,class:"w-3 h-3 rounded-full plugin-dot",style:g({"--plugin-color":e.color}),title:e.name},null,12,Xe))),128))])]))),128))]),s[5]||(s[5]=r("p",{class:"text-xs text-gray-500 mt-3"}," Each colored dot represents a plugin that can process that file type. ",-1))])):i("",!0),L.value?(a(),t("div",Ze,[r("h3",{class:u(["text-lg font-medium mb-4",L.value.success?"text-green-900":"text-red-900"])},c(L.value.success?"Upload Successful!":"Upload Failed"),3),r("div",Qe,[r("p",Ye,c(L.value.message),1),L.value.success&&L.value.receipt?(a(),t("div",es,[s[10]||(s[10]=r("h4",{class:"text-sm font-medium text-gray-900 mb-2"}," Receipt Details ",-1)),r("div",ss,[r("div",null,[s[6]||(s[6]=r("span",{class:"text-gray-500"},"Filename:",-1)),r("span",ls,c(L.value.receipt.filename),1)]),r("div",null,[s[7]||(s[7]=r("span",{class:"text-gray-500"},"Items Found:",-1)),r("span",ts,c(L.value.receipt.totalItemsDetected),1)]),r("div",null,[s[8]||(s[8]=r("span",{class:"text-gray-500"},"Successfully Parsed:",-1)),r("span",as,c(L.value.receipt.successfullyParsed),1)]),r("div",null,[s[9]||(s[9]=r("span",{class:"text-gray-500"},"Status:",-1)),r("span",rs,c(L.value.receipt.processingStatus),1)])])])):i("",!0),L.value.errors.length>0?(a(),t("div",is,[s[11]||(s[11]=r("h4",{class:"text-sm font-medium text-red-900 mb-2"},"Errors:",-1)),r("ul",ns,[(a(!0),t(p,null,d(L.value.errors,e=>(a(),t("li",{key:e},c(e),1))),128))])])):i("",!0),r("div",os,[r("button",{class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",onClick:I}," Upload Another "),L.value.success?(a(),m(v(f),{key:0,to:"/receipts",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},{default:y(()=>[...s[12]||(s[12]=[n(" View Receipts ",-1)])]),_:1})):i("",!0)])])])):i("",!0)]))}}),[["__scopeId","data-v-2c61c873"]]);export{us as default};
