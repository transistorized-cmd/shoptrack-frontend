const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/Receipts-jikdkowl.js","js/chunk-D50-beEz.js","js/chunk-C1DHrtJO.js","js/Upload-Da3fs7xd.js","css/Upload-CoHk_AOg.css","js/ReceiptDetail-4mmg2nBf.js","js/Reports-CG5LAHJD.js","js/chunk-CVCGJNZ4.js","css/LazyLineChart-DXVjSYZX.css","js/CategoryAnalytics-B9-cCZ3s.js","js/PriceTrends-CNpdGIGu.js"])))=>i.map(i=>d[i]);
import{r as e,d as t,c as i,o as s,a as n,w as r,F as o,b as a,n as l,e as c,f as u,t as d,u as p,T as g,g as h,h as m,i as f,j as v,k as y,l as w,m as E,R as x,p as b,q as S,s as P,v as k,x as T,y as _,z as I,A as R,B as L}from"./chunk-D50-beEz.js";import{a as C}from"./chunk-C1DHrtJO.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const A={KB:1024,MB:1048576,GB:1073741824,DEFAULT_MAX_SIZE_MB:10,DEFAULT_MAX_SIZE_BYTES:10485760,PLUGIN_DEFAULT_MAX_SIZE_KB:10240,GENERIC_RECEIPT_MAX_SIZE_MB:2,AMAZON_ORDERS_MAX_SIZE_MB:10},O={CSRF_BUFFER:5e3,NOTIFICATION_DEFAULT:5e3,DEBOUNCE_SEARCH:500,DEBOUNCE_AUTOCOMPLETE:150},N=e([]);let F=0;const D=()=>{const e=(e,i,s,n)=>{const r="notification-"+ ++F,o={id:r,type:e,title:i,message:s,duration:n?.duration??O.NOTIFICATION_DEFAULT,persistent:n?.persistent??!0};return N.value.push(o),!o.persistent&&o.duration&&o.duration>0&&setTimeout(()=>{t(r)},o.duration),r},t=e=>{const t=N.value.findIndex(t=>t.id===e);t>-1&&N.value.splice(t,1)};return{notifications:N,addNotification:e,removeNotification:t,clearAllNotifications:()=>{N.value=[]},success:(t,i,s)=>e("success",t,i,s),error:(t,i,s)=>e("error",t,i,s),warning:(t,i,s)=>e("warning",t,i,s),info:(t,i,s)=>e("info",t,i,s)}},M={class:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 space-y-2"},U={class:"p-4"},$={class:"flex items-start"},j={class:"flex-shrink-0"},z={key:0,class:"h-6 w-6 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},B={key:1,class:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},V={key:2,class:"h-6 w-6 text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},G={key:3,class:"h-6 w-6 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},q={class:"ml-3 w-0 flex-1"},H={class:"text-sm font-medium text-gray-900"},X={key:0,class:"mt-1 text-sm text-gray-500"},W={class:"ml-4 flex-shrink-0 flex"},J=["onClick"],Q=(e,t)=>{const i=e.__vccOpts||e;for(const[s,n]of t)i[s]=n;return i},K=Q(t({__name:"NotificationContainer",setup(e){const{notifications:t,removeNotification:h}=D(),m=e=>{const t={success:"border-l-4 border-green-500",error:"border-l-4 border-red-500",warning:"border-l-4 border-yellow-500",info:"border-l-4 border-blue-500"};return t[e]||t.info};return(e,f)=>(s(),i("div",M,[n(g,{name:"notification",tag:"div",class:"space-y-2"},{default:r(()=>[(s(!0),i(o,null,a(p(t),e=>(s(),i("div",{key:e.id,class:l(["bg-white shadow-lg rounded-lg pointer-events-auto transition-all duration-300",m(e.type)]),style:{width:"600px"}},[c("div",U,[c("div",$,[c("div",j,["success"===e.type?(s(),i("svg",z,[...f[0]||(f[0]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):"error"===e.type?(s(),i("svg",B,[...f[1]||(f[1]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):"warning"===e.type?(s(),i("svg",V,[...f[2]||(f[2]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"},null,-1)])])):(s(),i("svg",G,[...f[3]||(f[3]=[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]))]),c("div",q,[c("p",H,d(e.title),1),e.message?(s(),i("p",X,d(e.message),1)):u("",!0)]),c("div",W,[c("button",{class:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:t=>p(h)(e.id)},[...f[4]||(f[4]=[c("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[c("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])],8,J)])])])],2))),128))]),_:1})]))}}),[["__scopeId","data-v-26f39666"]]),Z={key:0,class:"min-h-screen flex items-center justify-center bg-gray-50"},Y={class:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center"},ee={class:"text-sm text-gray-500 mb-6"},te={key:0,class:"mb-6 text-left"},ie={class:"text-xs"},se={class:"bg-gray-100 p-3 rounded text-red-600 overflow-auto max-h-32"},ne={class:"flex flex-col sm:flex-row gap-3 justify-center"},re=t({__name:"ErrorBoundary",props:{fallback:{default:"An unexpected error occurred. Please try again."},showErrorDetails:{type:Boolean,default:!1}},setup(t){const n=t,r=y(),o=e(!1),a=e(null),l=e(n.showErrorDetails),p=e(n.fallback);h((e,t,i)=>(o.value=!0,a.value=`${e.name}: ${e.message}\n\nStack:\n${e.stack}\n\nComponent Info:\n${i}`,"ChunkLoadError"===e.name||e.message.includes("Loading chunk")?p.value="Failed to load application resources. Please refresh the page.":"TypeError"===e.name&&e.message.includes("fetch")?p.value="Network error occurred. Please check your connection and try again.":e.message.includes("404")||e.message.includes("Not Found")?p.value="The requested resource was not found.":p.value=n.fallback,E(e,i),!1));const g=()=>{o.value=!1,a.value=null,l.value=n.showErrorDetails,p.value=n.fallback,v(()=>{})},w=()=>{o.value=!1,r.push("/").catch(e=>{window.location.href="/"})},E=(e,t)=>{try{(new Date).toISOString(),window.location.href,navigator.userAgent,e.name,e.message,e.stack}catch(i){}};return(e,t)=>o.value?(s(),i("div",Z,[c("div",Y,[t[2]||(t[2]=f('<div class="mb-6"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100"><svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div></div><h3 class="text-lg font-medium text-gray-900 mb-2"> Something went wrong </h3>',2)),c("p",ee,d(p.value),1),l.value&&a.value?(s(),i("div",te,[c("details",ie,[t[1]||(t[1]=c("summary",{class:"cursor-pointer text-gray-600 hover:text-gray-800 mb-2"}," Technical Details ",-1)),c("pre",se,d(a.value),1)])])):u("",!0),c("div",ne,[c("button",{class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:g}," Try Again "),c("button",{class:"px-4 py-2 bg-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",onClick:w}," Go Home "),l.value?u("",!0):(s(),i("button",{key:0,class:"px-4 py-2 bg-gray-100 text-gray-600 text-sm font-medium rounded-md hover:bg-gray-200",onClick:t[0]||(t[0]=e=>l.value=!0)}," Show Details "))])])])):m(e.$slots,"default",{key:1})}}),oe={class:"bg-gray-100 min-h-screen"},ae={class:"bg-white shadow-md"},le={class:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8"},ce={class:"flex justify-between items-center py-4"},ue={class:"flex items-center"},de={class:"text-2xl font-bold text-gray-900"},pe={class:"hidden md:flex space-x-8 ml-8"},ge={class:"max-w-6xl mx-auto py-8 px-4 sm:px-6 lg:px-8"},he=t({__name:"App",setup:e=>(e,t)=>{const i=E("router-view");return s(),w(re,{fallback:"ShopTrack encountered an unexpected error. Please refresh the page to continue."},{default:r(()=>[c("div",oe,[c("nav",ae,[c("div",le,[c("div",ce,[c("div",ue,[c("h1",de,[n(p(x),{to:"/"},{default:r(()=>[...t[0]||(t[0]=[b("ShopTrack",-1)])]),_:1})]),c("nav",pe,[n(p(x),{to:"/upload",class:"text-gray-600 hover:text-gray-900 px-3 py-2 text-sm font-medium text-blue-600 border-b-2 border-blue-600"},{default:r(()=>[...t[1]||(t[1]=[b(" 📤 Upload ",-1)])]),_:1}),n(p(x),{to:"/receipts",class:"text-gray-600 hover:text-gray-900 px-3 py-2 text-sm font-medium"},{default:r(()=>[...t[2]||(t[2]=[b(" 🧾 Receipts ",-1)])]),_:1}),n(p(x),{to:"/reports",class:"text-gray-600 hover:text-gray-900 px-3 py-2 text-sm font-medium"},{default:r(()=>[...t[3]||(t[3]=[b(" 📊 Reports ",-1)])]),_:1})])]),t[4]||(t[4]=c("div",{class:"text-sm text-gray-600"}," Receipt Processing with Claude AI ",-1))])])]),c("main",ge,[n(re,{fallback:"This section encountered an error. Please try refreshing the page."},{default:r(()=>[n(i)]),_:1})]),t[5]||(t[5]=c("footer",{class:"bg-white border-t mt-12 py-8"},[c("div",{class:"max-w-6xl mx-auto px-4 text-center text-gray-600"},[c("p",null," © 2024 ShopTrack. Powered by Claude AI for receipt processing. ")])],-1)),n(K)])]),_:1})}}),me={},fe=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),n=i?.nonce||i?.getAttribute("nonce");s=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in me)return;me[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${i}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,n&&s.setAttribute("nonce",n),document.head.appendChild(s),t?new Promise((t,i)=>{s.addEventListener("load",t),s.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};class ve{static instance;tokenState=e(null);refreshPromise=null;constructor(){}static getInstance(){return ve.instance||(ve.instance=new ve),ve.instance}async fetchTokenFromBackend(){const e=await fetch("/api/security/csrf-token",{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to fetch CSRF token: ${e.status} ${e.statusText}`);return await e.json()}isTokenValid(){return!!this.tokenState.value&&!this.tokenState.value.isCompromised&&Date.now()<this.tokenState.value.expires-O.CSRF_BUFFER}isClientSideToken(e){return 64===e.length}async refreshToken(){return this.refreshPromise||(this.refreshPromise=(async()=>{try{const e=await this.fetchTokenFromBackend(),t=new Date(e.expiresAt).getTime();return this.tokenState.value={token:e.token,expires:t},sessionStorage.setItem("csrf_token",JSON.stringify(this.tokenState.value)),e.token}catch(e){const t=this.loadFromStorage();if(t&&t.expires>Date.now()&&!this.isClientSideToken(t.token))return this.tokenState.value=t,t.token;throw this.tokenState.value={token:"",expires:0,isCompromised:!0},new Error("CSRF protection unavailable: Cannot establish secure connection to server. Please check your connection and try again.")}finally{this.refreshPromise=null}})()),this.refreshPromise}loadFromStorage(){try{const e=sessionStorage.getItem("csrf_token");if(e)return JSON.parse(e)}catch(e){}return null}async initializeToken(){try{const e=this.loadFromStorage();if(e&&e.expires>Date.now()+6e4)return void(this.tokenState.value=e)}catch(e){}await this.refreshToken()}async getToken(){if(!this.isTokenValid())try{await this.refreshToken()}catch(e){throw e}if(this.tokenState.value?.isCompromised)throw new Error("CSRF protection is compromised - cannot proceed with request");return this.tokenState.value?.token||""}getTokenState(){return S(this.tokenState)}invalidateToken(){this.tokenState.value=null,sessionStorage.removeItem("csrf_token")}isCsrfProtectionAvailable(){return null!==this.tokenState.value&&!this.tokenState.value.isCompromised&&this.isTokenValid()}async validateToken(e){try{const t=e||this.tokenState.value?.token;if(!t)return!1;const i=await fetch("/api/security/validate-csrf-token",{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({token:t})});if(i.ok){const e=await i.json();if(e.refreshedToken){const t=new Date(e.expiresAt).getTime();this.tokenState.value={token:e.refreshedToken,expires:t},sessionStorage.setItem("csrf_token",JSON.stringify(this.tokenState.value))}return e.isValid}return!1}catch(t){return!1}}async initialize(){await this.initializeToken()}}const ye=ve.getInstance(),we=15e3,Ee=5e3,xe=C.create({baseURL:"http://localhost:5298/api",timeout:we});xe.interceptors.request.use(async e=>{try{const t=await ye.getToken();t&&(e.headers["X-CSRF-TOKEN"]=t,"post"===e.method?.toLowerCase()&&e.data instanceof FormData&&e.data.append("_token",t)),e.headers["X-Requested-With"]="XMLHttpRequest"}catch(t){}return e},e=>Promise.reject(e)),xe.interceptors.response.use(e=>e,async e=>{if(401===e.response?.status);else if(403===e.response?.status){if(ye.invalidateToken(),!e.config._retried){e.config._retried=!0;try{await ye.initialize();const t=await ye.getToken();return e.config.headers["X-CSRF-TOKEN"]=t,e.config.data instanceof FormData&&(e.config.data.delete("_token"),e.config.data.append("_token",t)),xe.request(e.config)}catch(t){}}}else if(419===e.response?.status){if(ye.invalidateToken(),!e.config._retried){e.config._retried=!0;try{await ye.initialize();const t=await ye.getToken();return e.config.headers["X-CSRF-TOKEN"]=t,e.config.data instanceof FormData&&(e.config.data.delete("_token"),e.config.data.append("_token",t)),xe.request(e.config)}catch(t){}}}else e.response;return Promise.reject(e)});const be={fast:{get:(e,t={})=>xe.get(e,{...t,timeout:Ee}),post:(e,t,i={})=>xe.post(e,t,{...i,timeout:Ee}),put:(e,t,i={})=>xe.put(e,t,{...i,timeout:Ee}),delete:(e,t={})=>xe.delete(e,{...t,timeout:Ee})},claudeUpload:{post:(e,t,i={})=>xe.post(e,t,{...i,timeout:18e4,headers:{"Content-Type":"multipart/form-data",...i.headers},onUploadProgress:i.onUploadProgress})},standardUpload:{post:(e,t,i={})=>xe.post(e,t,{...i,timeout:3e4,headers:{"Content-Type":"multipart/form-data",...i.headers},onUploadProgress:i.onUploadProgress})},default:{get:(e,t={})=>xe.get(e,{...t,timeout:we}),post:(e,t,i={})=>xe.post(e,t,{...i,timeout:we}),put:(e,t,i={})=>xe.put(e,t,{...i,timeout:we}),delete:(e,t={})=>xe.delete(e,{...t,timeout:we}),patch:(e,t,i={})=>xe.patch(e,t,{...i,timeout:we})}},Se={getReceipts:async e=>(await xe.get("/receipts",{params:e})).data,getReceipt:async e=>(await xe.get(`/receipts/${e}`)).data,createReceipt:async e=>(await xe.post("/receipts",e)).data,updateReceipt:async(e,t)=>(await xe.put(`/receipts/${e}`,t)).data,async deleteReceipt(e){await xe.delete(`/receipts/${e}`)},getReceiptItems:async e=>(await xe.get(`/receipts/${e}/items`)).data,reprocessReceipt:async(e,t)=>(await xe.post(`/receipts/${e}/reprocess`,null,{params:{pluginKey:t}})).data,async uploadReceipt(e,t){const i=new FormData;return i.append("file",e),(await xe.post("/upload",i,{headers:{"Content-Type":"multipart/form-data"},params:{pluginKey:t}})).data},async validateFile(e,t){const i=new FormData;return i.append("file",e),(await xe.post("/upload/validate",i,{headers:{"Content-Type":"multipart/form-data"},params:{pluginKey:t}})).data},getStoreNames:async e=>(await xe.get("/receipts/store-names",{params:{search:e}})).data,getItemNames:async e=>(await xe.get("/receipts/item-names",{params:{search:e}})).data,getCategories:async e=>(await xe.get("/receipts/categories",{params:{search:e}})).data,getUnits:async e=>(await xe.get("/receipts/units",{params:{search:e}})).data,updateReceiptItem:async(e,t)=>(await xe.put(`/receipts/items/${e}`,t)).data},Pe=P("receipts",()=>{const t=e([]),i=e(null),s=e(!1),n=e(null),r=e({page:1,pageSize:20,totalCount:0,totalPages:0}),o=k(()=>t.value.length>0),a=k(()=>t.value.filter(e=>"pending"===e.processingStatus)),l=k(()=>t.value.filter(e=>"completed"===e.processingStatus));return{receipts:t,currentReceipt:i,loading:s,error:n,pagination:r,hasReceipts:o,pendingReceipts:a,completedReceipts:l,fetchReceipts:async e=>{s.value=!0,n.value=null;try{const i=await Se.getReceipts(e);t.value=i.data,r.value={page:i.page,pageSize:i.pageSize,totalCount:i.totalCount,totalPages:i.totalPages}}catch(i){n.value=i instanceof Error?i.message:"Failed to fetch receipts"}finally{s.value=!1}},fetchReceipt:async e=>{s.value=!0,n.value=null;try{const t=await Se.getReceipt(e);return i.value=t,t}catch(t){throw n.value=t instanceof Error?t.message:"Failed to fetch receipt",t}finally{s.value=!1}},uploadReceipt:async(e,i)=>{s.value=!0,n.value=null;try{const s=await Se.uploadReceipt(e,i);return s.success&&!s.isDuplicate&&t.value.unshift(s.receipt),s}catch(r){throw n.value=r instanceof Error?r.message:"Failed to upload receipt",r}finally{s.value=!1}},updateReceipt:async(e,r)=>{s.value=!0,n.value=null;try{const s=await Se.updateReceipt(e,r),n=t.value.findIndex(t=>t.id===e);return-1!==n&&(t.value[n]=s),i.value?.id===e&&(i.value=s),s}catch(o){throw n.value=o instanceof Error?o.message:"Failed to update receipt",o}finally{s.value=!1}},deleteReceipt:async e=>{s.value=!0,n.value=null;try{await Se.deleteReceipt(e),t.value=t.value.filter(t=>t.id!==e),i.value?.id===e&&(i.value=null)}catch(r){throw n.value=r instanceof Error?r.message:"Failed to delete receipt",r}finally{s.value=!1}},reprocessReceipt:async(e,r)=>{s.value=!0,n.value=null;try{const s=await Se.reprocessReceipt(e,r);if(s.success){const n=t.value.findIndex(t=>t.id===e);-1!==n&&(t.value[n]=s.receipt),i.value?.id===e&&(i.value=s.receipt)}return s}catch(o){throw n.value=o instanceof Error?o.message:"Failed to reprocess receipt",o}finally{s.value=!1}},getReceiptDetails:async e=>{try{return await Se.getReceipt(e)}catch(t){throw n.value=t instanceof Error?t.message:"Failed to fetch receipt details",t}},clearError:()=>{n.value=null},clearCurrentReceipt:()=>{i.value=null}}}),ke=new class{config;sessionId;errorQueue=[];isProcessingQueue=!1;constructor(e={}){this.config={enableConsoleLogging:!0,enableRemoteLogging:!1,maxRetries:3,retryDelay:1e3,...e},this.sessionId=this.generateSessionId(),document.addEventListener("visibilitychange",()=>{document.hidden||this.processErrorQueue()}),window.addEventListener("beforeunload",()=>{this.flushErrors()})}async logError(e,t="Unknown",i){const s={timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,context:t,error:{name:e.name,message:e.message,stack:e.stack},sessionId:this.sessionId,additionalInfo:i};this.config.enableConsoleLogging&&this.logToConsole(s),this.config.enableRemoteLogging&&(this.errorQueue.push(s),this.processErrorQueue())}logToConsole(e){e.additionalInfo,e.error.stack}async processErrorQueue(){if(!this.isProcessingQueue&&0!==this.errorQueue.length){for(this.isProcessingQueue=!0;this.errorQueue.length>0;){const t=this.errorQueue.shift();try{await this.sendErrorToRemote(t)}catch(e){this.errorQueue.unshift(t);break}}this.isProcessingQueue=!1}}async sendErrorToRemote(e,t=0){if(!this.config.endpoint)throw new Error("No remote logging endpoint configured");try{const t=await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:`Bearer ${this.config.apiKey}`}},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`)}catch(i){if(t<this.config.maxRetries)return await this.delay(this.config.retryDelay*Math.pow(2,t)),this.sendErrorToRemote(e,t+1);throw i}}flushErrors(){if(0!==this.errorQueue.length&&"sendBeacon"in navigator&&this.config.endpoint)try{const e=JSON.stringify({sessionId:this.sessionId,errors:this.errorQueue.splice(0)});navigator.sendBeacon(this.config.endpoint,e)}catch(e){}}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}delay(e){return new Promise(t=>setTimeout(t,e))}updateConfig(e){this.config={...this.config,...e}}enableRemoteLogging(e,t){this.updateConfig({endpoint:e,apiKey:t,enableRemoteLogging:!0})}disableRemoteLogging(){this.updateConfig({enableRemoteLogging:!1})}logNetworkError(e,t,i="GET"){this.logError(e,"Network Error",{url:t,method:i})}logValidationError(e,t){this.logError(e,"Validation Error",{formData:this.sanitizeFormData(t)})}logApiError(e,t,i){this.logError(e,"API Error",{endpoint:t,statusCode:i})}sanitizeFormData(e){const t=["password","token","apiKey","secret"],i={...e};return Object.keys(i).forEach(e=>{t.some(t=>e.toLowerCase().includes(t.toLowerCase()))&&(i[e]="[REDACTED]")}),i}}({enableConsoleLogging:!1,enableRemoteLogging:!0}),Te={async getAllPlugins(){try{return(await be.fast.get("/plugins")).data}catch(e){throw ke.logApiError(e instanceof Error?e:new Error(String(e)),"/plugins"),e}},async getPluginStatistics(){try{return(await be.fast.get("/plugins/statistics")).data}catch(e){throw ke.logApiError(e instanceof Error?e:new Error(String(e)),"/plugins/statistics"),e}},async detectPlugin(e,t){try{const i="."+e.name.split(".").pop()?.toLowerCase(),s=t.filter(e=>e.supportedFileTypes.some(e=>e.toLowerCase()===i));if(0===s.length)return{success:!1,message:`No plugins support ${i} files`};const n=s.sort((e,t)=>e.key.includes("generic")?1:t.key.includes("generic")?-1:0)[0];return{success:!0,plugin:n,pluginKey:n.key,pluginName:n.name,pluginDescription:n.description,color:n.color,confidence:.8,message:`Detected ${n.name} for ${i} file`}}catch(i){return ke.logError(i instanceof Error?i:new Error(String(i)),"Plugin Detection",{fileName:e.name,fileSize:e.size,fileType:e.type,availablePluginsCount:t.length}),{success:!1,message:"Error occurred during plugin detection"}}},async uploadWithAutoDetection(e,t){try{const i=new FormData;return i.append("file",e),(await be.claudeUpload.post("/upload",i,{onUploadProgress:t})).data}catch(i){throw ke.logApiError(i instanceof Error?i:new Error(String(i)),"/upload",i?.response?.status),i}},async uploadWithSpecificPlugin(e,t,i){try{const s=new FormData;s.append("file",e);const n=t.includes("generic")||t.includes("receipt")?be.claudeUpload:be.standardUpload;return(await n.post(`/upload?pluginKey=${t}`,s,{onUploadProgress:i})).data}catch(s){throw ke.logApiError(s instanceof Error?s:new Error(String(s)),`/upload?pluginKey=${t}`,s?.response?.status),s}}},_e=P("plugins",()=>{const t=e([]),i=e([]),s=e(!1),n=e(null),r=e({}),o=e(null),a=k(()=>t.value.filter(e=>"receipt"===e.type)),l=k(()=>i.value.filter(e=>e.isEnabled)),c=k(()=>{const e={};return i.value.forEach(t=>{e[t.category]||(e[t.category]=[]),e[t.category].push(t)}),e});return{receiptPlugins:t,reportPlugins:i,loading:s,error:n,supportedFileTypes:r,statistics:o,availableReceiptPlugins:a,enabledReportPlugins:l,pluginsByCategory:c,fetchAllPlugins:async()=>{s.value=!0,n.value=null;try{const e=await Te.getAllPlugins();t.value=e.receiptPlugins,i.value=e.reportPlugins}catch(e){n.value=e instanceof Error?e.message:"Failed to fetch plugins"}finally{s.value=!1}},fetchSupportedFileTypes:async()=>{},fetchPluginStatistics:async()=>{try{o.value=await Te.getPluginStatistics()}catch(e){}},getReceiptPlugin:e=>t.value.find(t=>t.key===e),getReportPlugin:e=>i.value.find(t=>t.key===e),getPluginsForFileType:e=>t.value.filter(t=>t.supportedFileTypes.includes(e.toLowerCase())),clearError:()=>{n.value=null}}}),Ie={class:"space-y-6"},Re={key:0,class:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4"},Le={class:"card p-6"},Ce={class:"flex items-center"},Ae={class:"ml-5 w-0 flex-1"},Oe={class:"text-lg font-medium text-gray-900"},Ne={class:"card p-6"},Fe={class:"flex items-center"},De={class:"ml-5 w-0 flex-1"},Me={class:"text-lg font-medium text-gray-900"},Ue={class:"card p-6"},$e={class:"flex items-center"},je={class:"ml-5 w-0 flex-1"},ze={class:"text-lg font-medium text-gray-900"},Be={class:"card p-6"},Ve={class:"flex items-center"},Ge={class:"ml-5 w-0 flex-1"},qe={class:"text-lg font-medium text-gray-900"},He={class:"card p-6"},Xe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"},We={key:1,class:"card p-6"},Je={class:"flex items-center justify-between mb-4"},Qe={class:"space-y-3"},Ke={class:"flex items-center"},Ze={class:"flex-shrink-0"},Ye={class:"ml-3"},et={class:"text-sm font-medium text-gray-900"},tt={class:"text-xs text-gray-500"},it={class:"text-right"},st={class:"text-sm font-medium text-gray-900"},nt={class:"text-xs text-gray-500 capitalize"},rt={key:2,class:"text-center py-12"},ot=t({__name:"Home",setup(e){const t=Pe(),g=_e(),h=k(()=>t.receipts.slice(0,5)),m=e=>{switch(e){case"completed":return"bg-green-100 text-green-600";case"pending":return"bg-yellow-100 text-yellow-600";case"processing":return"bg-blue-100 text-blue-600";case"failed":return"bg-red-100 text-red-600";default:return"bg-gray-100 text-gray-600"}},v=e=>{switch(e){case"completed":return"✓";case"pending":return"⏳";case"processing":return"⚡";case"failed":return"❌";default:return"❓"}};return T(async()=>{await Promise.all([t.fetchReceipts({pageSize:10}),g.fetchAllPlugins()])}),(e,y)=>(s(),i("div",Ie,[y[15]||(y[15]=c("div",{class:"text-center"},[c("h1",{class:"text-4xl font-bold text-gray-900 sm:text-5xl"}," Welcome to ShopTrack "),c("p",{class:"mt-4 text-xl text-gray-600"}," Your intelligent receipt and expense tracking solution ")],-1)),p(t).loading?u("",!0):(s(),i("div",Re,[c("div",Le,[c("div",Ce,[y[1]||(y[1]=c("div",{class:"flex-shrink-0"},[c("div",{class:"w-8 h-8 bg-shoptrack-500 rounded-md flex items-center justify-center"},[c("span",{class:"text-white font-semibold"},"📄")])],-1)),c("div",Ae,[c("dl",null,[y[0]||(y[0]=c("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Total Receipts ",-1)),c("dd",Oe,d(p(t).pagination.totalCount),1)])])])]),c("div",Ne,[c("div",Fe,[y[3]||(y[3]=c("div",{class:"flex-shrink-0"},[c("div",{class:"w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center"},[c("span",{class:"text-white font-semibold"},"⏳")])],-1)),c("div",De,[c("dl",null,[y[2]||(y[2]=c("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Pending ",-1)),c("dd",Me,d(p(t).pendingReceipts.length),1)])])])]),c("div",Ue,[c("div",$e,[y[5]||(y[5]=c("div",{class:"flex-shrink-0"},[c("div",{class:"w-8 h-8 bg-green-500 rounded-md flex items-center justify-center"},[c("span",{class:"text-white font-semibold"},"✅")])],-1)),c("div",je,[c("dl",null,[y[4]||(y[4]=c("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Completed ",-1)),c("dd",ze,d(p(t).completedReceipts.length),1)])])])]),c("div",Be,[c("div",Ve,[y[7]||(y[7]=c("div",{class:"flex-shrink-0"},[c("div",{class:"w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center"},[c("span",{class:"text-white font-semibold"},"🔌")])],-1)),c("div",Ge,[c("dl",null,[y[6]||(y[6]=c("dt",{class:"text-sm font-medium text-gray-500 truncate"}," Available Plugins ",-1)),c("dd",qe,d(p(g).receiptPlugins.length),1)])])])])])),c("div",He,[y[11]||(y[11]=c("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Quick Actions",-1)),c("div",Xe,[n(p(x),{to:"/upload",class:"flex items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-shoptrack-400 hover:bg-shoptrack-50 transition-colors group"},{default:r(()=>[...y[8]||(y[8]=[c("div",{class:"flex-shrink-0"},[c("div",{class:"w-10 h-10 bg-shoptrack-500 rounded-lg flex items-center justify-center group-hover:bg-shoptrack-600"},[c("span",{class:"text-white text-lg"},"📤")])],-1),c("div",{class:"ml-4"},[c("p",{class:"text-sm font-medium text-gray-900"},"Upload Receipt"),c("p",{class:"text-xs text-gray-500"},"Process new receipts")],-1)])]),_:1}),n(p(x),{to:"/receipts",class:"flex items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-shoptrack-400 hover:bg-shoptrack-50 transition-colors group"},{default:r(()=>[...y[9]||(y[9]=[c("div",{class:"flex-shrink-0"},[c("div",{class:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center group-hover:bg-blue-600"},[c("span",{class:"text-white text-lg"},"📋")])],-1),c("div",{class:"ml-4"},[c("p",{class:"text-sm font-medium text-gray-900"},"View Receipts"),c("p",{class:"text-xs text-gray-500"},"Manage your receipts")],-1)])]),_:1}),n(p(x),{to:"/reports",class:"flex items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-shoptrack-400 hover:bg-shoptrack-50 transition-colors group"},{default:r(()=>[...y[10]||(y[10]=[c("div",{class:"flex-shrink-0"},[c("div",{class:"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center group-hover:bg-green-600"},[c("span",{class:"text-white text-lg"},"📊")])],-1),c("div",{class:"ml-4"},[c("p",{class:"text-sm font-medium text-gray-900"},"View Reports"),c("p",{class:"text-xs text-gray-500"},"Analyze your spending")],-1)])]),_:1})])]),p(t).hasReceipts?(s(),i("div",We,[c("div",Je,[y[13]||(y[13]=c("h2",{class:"text-lg font-medium text-gray-900"},"Recent Receipts",-1)),n(p(x),{to:"/receipts",class:"text-sm text-shoptrack-600 hover:text-shoptrack-500"},{default:r(()=>[...y[12]||(y[12]=[b(" View all ",-1)])]),_:1})]),c("div",Qe,[(s(!0),i(o,null,a(h.value,e=>(s(),i("div",{key:e.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[c("div",Ke,[c("div",Ze,[c("div",{class:l(["w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium",m(e.processingStatus)])},d(v(e.processingStatus)),3)]),c("div",Ye,[c("p",et,d(e.filename),1),c("p",tt,d(e.receiptDate?new Date(e.receiptDate).toLocaleDateString():"No date"),1)])]),c("div",it,[c("p",st,d(e.successfullyParsed)+" items ",1),c("p",nt,d(e.processingStatus),1)])]))),128))])])):u("",!0),p(t).loading||p(g).loading?(s(),i("div",rt,[...y[14]||(y[14]=[f('<div class="inline-flex items-center space-x-2"><svg class="animate-spin h-5 w-5 text-shoptrack-600" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-gray-500">Loading...</span></div>',1)])])):u("",!0)]))}}),at=_({history:I("/"),routes:[{path:"/",name:"home",component:ot},{path:"/receipts",name:"receipts",component:()=>fe(()=>import("./Receipts-jikdkowl.js"),__vite__mapDeps([0,1,2]))},{path:"/upload",name:"upload",component:()=>fe(()=>import("./Upload-Da3fs7xd.js"),__vite__mapDeps([3,1,2,4]))},{path:"/receipts/:id",name:"receipt-detail",component:()=>fe(()=>import("./ReceiptDetail-4mmg2nBf.js"),__vite__mapDeps([5,1,2]))},{path:"/reports",name:"reports",component:()=>fe(()=>import("./Reports-CG5LAHJD.js"),__vite__mapDeps([6,1,7,8,2]))},{path:"/analytics/categories",name:"category-analytics",component:()=>fe(()=>import("./CategoryAnalytics-B9-cCZ3s.js"),__vite__mapDeps([9,1,2]))},{path:"/analytics/price-trends",name:"price-trends",component:()=>fe(()=>import("./PriceTrends-CNpdGIGu.js"),__vite__mapDeps([10,1,7,8,2]))}]});class lt{bindings=new Map;resolving=new Set;registerSingleton(e,t){return this.bindings.set(e,{factory:t,singleton:!0}),this}registerTransient(e,t){return this.bindings.set(e,{factory:t,singleton:!1}),this}registerSingletonClass(e,t,...i){return this.registerSingleton(e,()=>new t(...i))}registerTransientClass(e,t,...i){return this.registerTransient(e,()=>new t(...i))}registerInstance(e,t){return this.bindings.set(e,{factory:()=>t,singleton:!0,instance:t}),this}resolve(e){if(this.resolving.has(e))throw new Error(`Circular dependency detected for token: ${String(e)}`);const t=this.bindings.get(e);if(!t)throw new Error(`No binding found for token: ${String(e)}`);if(t.singleton&&t.instance)return t.instance;this.resolving.add(e);try{const e=t.factory();return t.singleton&&(t.instance=e),e}catch(i){throw new Error(`Failed to resolve service for token: ${String(e)}. ${i instanceof Error?i.message:String(i)}`)}finally{this.resolving.delete(e)}}isRegistered(e){return this.bindings.has(e)}unregister(e){return this.bindings.delete(e)}clear(){this.bindings.clear()}getTokens(){return Array.from(this.bindings.keys())}createChild(){const e=new lt;return this.bindings.forEach((t,i)=>{e.bindings.set(i,{...t})}),e}}const ct={PLUGIN_REGISTRY:Symbol("PluginRegistry"),ERROR_LOGGER:Symbol("ErrorLogger")},ut=new lt;class dt{static ALLOWED_PROTOCOLS=["http:","https:"];static BLOCKED_DOMAINS=["localhost","127.0.0.1","0.0.0.0","::1"];static ALLOWED_FILE_TYPES=["jpg","jpeg","png","gif","webp","bmp","tiff","svg","pdf","csv","txt","json","xml","doc","docx","xls","xlsx"];static DANGEROUS_FILE_TYPES=["exe","bat","cmd","com","pif","scr","vbs","js","jar","app","dmg","pkg","deb","rpm","msi","ps1","sh","php","asp","aspx","jsp","pl","py","rb","go","rs"];static MAX_PLUGIN_FILE_SIZE=A.DEFAULT_MAX_SIZE_BYTES;static MAX_ENDPOINT_LENGTH=200;static PLUGIN_ID_PATTERN=/^[a-z0-9-]+$/;static VERSION_PATTERN=/^v?\d+\.\d+\.\d+(-[a-zA-Z0-9-]+)?$/;static validatePluginConfig(e){const t=[],i=[];try{this.validateBasicStructure(e,t),this.validatePluginId(e.plugin.id,t),this.validateVersion(e.plugin.version,i),this.validateEndpoints(e.endpoints,t,i),this.validateFileTypes(e.plugin.fileTypes,t,i),this.validateFileSize(e.plugin.maxFileSize,t,i),this.validateCapabilities(e.capabilities,i),this.validateContent(e,i)}catch(s){t.push(`Validation error: ${s instanceof Error?s.message:String(s)}`)}return{isValid:0===t.length,errors:t,warnings:i,securityLevel:this.calculateSecurityLevel(t,i)}}static validateBasicStructure(e,t){if(!e.plugin)return void t.push("Plugin configuration missing");const i=["id","name","version","uploadEndpoint","fileTypes"];for(const s of i)e.plugin[s]||t.push(`Required field missing: ${s}`);e.capabilities||t.push("Plugin capabilities definition missing"),e.endpoints||t.push("Plugin endpoints definition missing")}static validatePluginId(e,t){e&&"string"==typeof e?((e.length<3||e.length>50)&&t.push("Plugin ID must be between 3 and 50 characters"),this.PLUGIN_ID_PATTERN.test(e)||t.push("Plugin ID can only contain lowercase letters, numbers, and hyphens"),["admin","system","root","config","__"].some(t=>e.includes(t))&&t.push("Plugin ID contains restricted patterns")):t.push("Plugin ID must be a non-empty string")}static validateVersion(e,t){this.VERSION_PATTERN.test(e)||t.push("Version format should follow semantic versioning (e.g., v1.0.0)")}static validateEndpoints(e,t,i){Object.entries(e).forEach(([e,s])=>{s&&this.validateEndpointUrl(s,e,t,i)})}static validateEndpointUrl(e,t,i,s){e.length>this.MAX_ENDPOINT_LENGTH&&i.push(`${t} endpoint URL too long (max ${this.MAX_ENDPOINT_LENGTH} chars)`);try{const n=new URL(e);this.ALLOWED_PROTOCOLS.includes(n.protocol)||i.push(`${t} endpoint uses disallowed protocol: ${n.protocol}`);const r=n.hostname.toLowerCase();this.BLOCKED_DOMAINS.includes(r)&&i.push(`${t} endpoint uses blocked domain: ${r}`),this.isPrivateIp(r)&&i.push(`${t} endpoint uses private IP address: ${r}`),"http:"===n.protocol&&s.push(`${t} endpoint should use HTTPS in production`),(n.pathname.includes("..")||n.pathname.includes("//"))&&i.push(`${t} endpoint contains potentially dangerous path patterns`)}catch(n){i.push(`${t} endpoint URL is malformed: ${e}`)}}static validateFileTypes(e,t,i){if(!Array.isArray(e)||0===e.length)return void t.push("Plugin must support at least one file type");const s=e.map(e=>e.toLowerCase().replace(/^\./,"")),n=s.filter(e=>this.DANGEROUS_FILE_TYPES.includes(e));n.length>0&&t.push(`Plugin supports dangerous file types: ${n.join(", ")}`);const r=s.filter(e=>!this.ALLOWED_FILE_TYPES.includes(e));r.length>0&&i.push(`Plugin supports unusual file types: ${r.join(", ")}`)}static validateFileSize(e,t,i){"number"!=typeof e||e<=0?t.push("Plugin maxFileSize must be a positive number"):(e>this.MAX_PLUGIN_FILE_SIZE&&t.push(`Plugin file size limit too large (max ${Math.round(this.MAX_PLUGIN_FILE_SIZE/A.MB)}MB)`),e>50*A.MB&&i.push("Plugin allows very large file uploads - consider security implications"))}static validateCapabilities(e,t){e&&"object"==typeof e&&(e.batchProcessing&&e.fileUpload&&t.push("Plugin supports both batch processing and file upload - monitor for abuse"),e.imageProcessing&&e.batchProcessing&&t.push("Image processing + batch processing could consume significant resources"))}static validateContent(e,t){const i=[e.plugin.name,e.plugin.description,JSON.stringify(e.endpoints)].join(" ");[/eval\s*\(/i,/function\s*\(/i,/javascript:/i,/data:.*script/i,/onclick|onload|onerror/i,/<script/i,/document\./i,/window\./i].some(e=>e.test(i))&&t.push("Plugin content contains potentially suspicious patterns")}static isPrivateIp(e){return[/^10\./,/^172\.(1[6-9]|2[0-9]|3[0-1])\./,/^192\.168\./,/^169\.254\./,/^fe80:/,/^::1$/,/^fc00:/,/^fd00:/].some(t=>t.test(e))}static calculateSecurityLevel(e,t){return e.length>0?"critical":t.length>3?"medium":t.length>0?"low":"secure"}}class pt{static MAX_EXECUTION_TIME=3e4;static MAX_MEMORY_USAGE=104857600;static RATE_LIMIT_REQUESTS=10;static RATE_LIMIT_WINDOW=6e4;rateLimitMap=new Map;activeOperations=new Map;async executePluginOperation(e,t,i={}){const s=Date.now(),n=`${e}-${s}-${Math.random().toString(36).substr(2,9)}`;try{this.enforceRateLimit(e);const r=new AbortController;this.activeOperations.set(n,{startTime:s,abortController:r});const o=setTimeout(()=>{throw r.abort(),this.cleanupOperation(n),new Error(`Plugin ${e} operation timed out after ${pt.MAX_EXECUTION_TIME}ms`)},i.timeout||pt.MAX_EXECUTION_TIME),a=await Promise.race([this.monitoredExecution(t,n),this.createTimeoutPromise(r.signal)]);return clearTimeout(o),this.cleanupOperation(n),this.logPluginExecution(e,Date.now()-s,!0),a}catch(r){throw this.cleanupOperation(n),this.logPluginExecution(e,Date.now()-s,!1,r),r}}validatePluginRequest(e,t){const i=[];try{(new TextEncoder).encode(JSON.stringify(t)).length>1048576&&i.push("Request payload too large");const e=JSON.stringify(t).toLowerCase();["eval(","function(","javascript:","<script","document.","window.","process.","__proto__","constructor","prototype"].some(t=>e.includes(t))&&i.push("Request contains potentially malicious content"),["union select","drop table","insert into","delete from","update set","--","/*","*/"].some(t=>e.includes(t))&&i.push("Request contains SQL injection patterns")}catch(s){i.push("Failed to validate request structure")}return{isSecure:0===i.length,issues:i,riskLevel:this.calculateRiskLevel(i)}}createIsolatedEnvironment(){return{console:{log:e=>this.sandboxedLog("log",e),warn:e=>this.sandboxedLog("warn",e),error:e=>this.sandboxedLog("error",e),info:e=>this.sandboxedLog("info",e)},fetch:this.createSandboxedFetch(),JSON:{parse:e=>this.safeParse(e),stringify:e=>this.safeStringify(e)},setTimeout:(e,t)=>{if(t>3e4)throw new Error("Timeout delay too long (max 30s)");return setTimeout(e,t)}}}async monitoredExecution(e,t){const i=performance.memory?.usedJSHeapSize||0;try{const s=await e(),n=(performance.memory?.usedJSHeapSize||0)-i;return n>pt.MAX_MEMORY_USAGE&&ke.logError(new Error(`Plugin operation exceeded memory limit: ${n} bytes`),"Plugin Memory Violation",{operationId:t,memoryUsage:n}),s}catch(s){throw ke.logError(s instanceof Error?s:new Error(String(s)),"Plugin Execution Error",{operationId:t}),s}}enforceRateLimit(e){const t=Date.now(),i=this.rateLimitMap.get(e);if(!i||t>i.resetTime)this.rateLimitMap.set(e,{count:1,resetTime:t+pt.RATE_LIMIT_WINDOW});else{if(i.count>=pt.RATE_LIMIT_REQUESTS)throw new Error(`Plugin ${e} rate limit exceeded (${pt.RATE_LIMIT_REQUESTS} requests per ${pt.RATE_LIMIT_WINDOW/1e3}s)`);i.count++}}createTimeoutPromise(e){return new Promise((t,i)=>{e.addEventListener("abort",()=>{i(new Error("Plugin operation aborted due to timeout"))})})}cleanupOperation(e){const t=this.activeOperations.get(e);t&&(t.abortController.abort(),this.activeOperations.delete(e))}sandboxedLog(e,t){t.replace(/<script[^>]*>.*?<\/script>/gi,"[SCRIPT_REMOVED]").replace(/javascript:/gi,"[JS_PROTOCOL_REMOVED]").substring(0,1e3)}createSandboxedFetch(){return async(e,t)=>{const i=e.toString();if(!i.startsWith("http://")&&!i.startsWith("https://"))throw new Error("Only HTTP/HTTPS requests allowed in plugin context");const s=new AbortController,n=setTimeout(()=>s.abort(),1e4);try{const i=await fetch(e,{...t,signal:s.signal});return clearTimeout(n),i}catch(r){throw clearTimeout(n),r}}}safeParse(e){if(e.length>1048576)throw new Error("JSON payload too large");try{return JSON.parse(e)}catch(t){throw new Error("Invalid JSON format")}}safeStringify(e){try{const t=JSON.stringify(e);if(t.length>1048576)throw new Error("JSON output too large");return t}catch(t){throw new Error("Failed to stringify JSON")}}calculateRiskLevel(e){const t=["malicious","injection","script"];return e.some(e=>t.some(t=>e.toLowerCase().includes(t)))?"critical":e.length>2?"high":e.length>0?"medium":"low"}logPluginExecution(e,t,i,s){const n={pluginId:e,executionTime:t,success:i,timestamp:(new Date).toISOString()};!i&&s?ke.logError(s instanceof Error?s:new Error(String(s)),"Plugin Execution Failed",n):t>1e4&&ke.logError(new Error(`Plugin operation took ${t}ms`),"Plugin Performance Warning",n)}}const gt=new pt;class ht{static DEFAULT_PERMISSIONS={fileUpload:!0,networkAccess:!1,localStorage:!1,cookies:!1,notifications:!1,clipboard:!1,camera:!1,microphone:!1,location:!1,deviceInfo:!1};pluginPermissions=new Map;grantPermissions(e,t){const i={...this.pluginPermissions.get(e)||{...ht.DEFAULT_PERMISSIONS},...t};this.pluginPermissions.set(e,i)}hasPermission(e,t){return(this.pluginPermissions.get(e)||ht.DEFAULT_PERMISSIONS)[t]||!1}getPermissions(e){return this.pluginPermissions.get(e)||{...ht.DEFAULT_PERMISSIONS}}revokeAllPermissions(e){this.pluginPermissions.delete(e)}checkPermission(e,t){const i=this.getRequiredPermissions(t),s=this.getPermissions(e),n=[];for(const r of i)s[r]||n.push(r);return{allowed:0===n.length,missingPermissions:n,operation:t,pluginId:e}}createConstrainedContext(e){const t=this.getPermissions(e);return{uploadFile:t.fileUpload?this.allowedUploadFile.bind(this):this.deniedOperation("fileUpload"),fetch:t.networkAccess?fetch:this.deniedOperation("networkAccess"),getLocalStorage:t.localStorage?this.allowedLocalStorage.bind(this):this.deniedOperation("localStorage"),setLocalStorage:t.localStorage?this.allowedSetLocalStorage.bind(this):this.deniedOperation("localStorage"),getCookies:t.cookies?this.allowedGetCookies.bind(this):this.deniedOperation("cookies"),showNotification:t.notifications?this.allowedShowNotification.bind(this):this.deniedOperation("notifications"),readClipboard:t.clipboard?this.allowedReadClipboard.bind(this):this.deniedOperation("clipboard"),writeClipboard:t.clipboard?this.allowedWriteClipboard.bind(this):this.deniedOperation("clipboard"),getDeviceInfo:t.deviceInfo?this.allowedGetDeviceInfo.bind(this):this.deniedOperation("deviceInfo")}}autoGrantPermissions(e,t){const i={fileUpload:!0};(t.fileUpload||t.manualEntry)&&(i.networkAccess=!0),(t.fileUpload||t.batchProcessing)&&(i.notifications=!0),this.grantPermissions(e,i)}getRequiredPermissions(e){switch(e){case"fileUpload":return["fileUpload"];case"networkRequest":return["networkAccess"];case"localStorage":return["localStorage"];case"showNotification":return["notifications"];case"clipboardAccess":return["clipboard"];case"deviceInfo":return["deviceInfo"];default:return[]}}allowedUploadFile(e){return Promise.resolve()}allowedLocalStorage(e){return localStorage.getItem(`plugin_${e}`)}allowedSetLocalStorage(e,t){localStorage.setItem(`plugin_${e}`,t)}allowedGetCookies(){return document.cookie.split(";").filter(e=>!e.trim().startsWith("session")&&!e.trim().startsWith("auth")).join(";")}allowedShowNotification(e){"granted"===Notification.permission&&new Notification("Plugin Notification",{body:e.substring(0,100),icon:"/favicon.ico"})}allowedReadClipboard(){return navigator.clipboard.readText()}allowedWriteClipboard(e){return navigator.clipboard.writeText(e.substring(0,1e3))}allowedGetDeviceInfo(){return{userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screen:{width:screen.width,height:screen.height}}}deniedOperation(e){return()=>{throw new Error(`Plugin does not have permission: ${e}`)}}}const mt=new ht;class ft{static HASH_ALGORITHM="SHA-256";static SIGNATURE_VERSION="v1";static TRUSTED_SOURCES=["shoptrack.official","verified.plugins","trusted.developers"];static async verifyPlugin(e){const t=[];try{const i=await this.verifySignature(e);t.push(i);const s=await this.verifyContentHash(e);t.push(s);const n=this.verifySource(e);t.push(n);const r=this.checkForTampering(e);t.push(r);const o=t.filter(e=>e.passed).length/t.length*100;return{isValid:o>=75,checks:t,trustScore:o,riskLevel:this.calculateRiskLevel(o),recommendations:this.generateRecommendations(t)}}catch(i){return ke.logError(i instanceof Error?i:new Error(String(i)),"Plugin Integrity Validation Failed",{pluginId:e.plugin.id}),{isValid:!1,checks:[{name:"integrity_validation",passed:!1,message:"Integrity validation failed due to system error",severity:"critical"}],trustScore:0,riskLevel:"critical",recommendations:["Plugin verification failed - do not install"]}}}static async verifySignature(e){const t=e.signature;if(!t)return{name:"signature_verification",passed:!1,message:"Plugin lacks digital signature",severity:"high"};if(!t.version||t.version!==this.SIGNATURE_VERSION)return{name:"signature_verification",passed:!1,message:"Unsupported signature version",severity:"medium"};const i=this.isValidSignatureFormat(t);return{name:"signature_verification",passed:i,message:i?"Signature format valid":"Invalid signature format",severity:i?"info":"high"}}static async verifyContentHash(e){try{const t=JSON.stringify({id:e.plugin.id,name:e.plugin.name,version:e.plugin.version,endpoints:e.endpoints,capabilities:e.capabilities}),i=await this.calculateHash(t),s=e.contentHash;if(!s)return{name:"content_hash_verification",passed:!1,message:"No content hash provided",severity:"medium"};const n=i===s;return{name:"content_hash_verification",passed:n,message:n?"Content hash verified":"Content hash mismatch - possible tampering",severity:n?"info":"critical"}}catch(t){return{name:"content_hash_verification",passed:!1,message:"Failed to verify content hash",severity:"high"}}}static verifySource(e){const t=e.source;if(!t)return{name:"source_verification",passed:!1,message:"Unknown plugin source",severity:"medium"};const i=this.TRUSTED_SOURCES.includes(t);return{name:"source_verification",passed:i,message:i?`Trusted source: ${t}`:`Untrusted source: ${t}`,severity:i?"info":"low"}}static checkForTampering(e){const t=[];"string"!=typeof e.plugin.id&&t.push("Plugin ID has been modified"),Object.values(e.endpoints).some(e=>e.includes("localhost")||e.includes("127.0.0.1"))&&t.push("Suspicious local endpoints in production");const i=Object.keys(e.capabilities),s=["systemAccess","fileSystemAccess","networkAccess"];return i.some(e=>s.includes(e))&&t.push("Plugin requests dangerous system capabilities"),e.plugin.version&&!e.plugin.version.match(/^v?\d+\.\d+\.\d+/)&&t.push("Invalid version format"),{name:"tampering_detection",passed:0===t.length,message:0===t.length?"No tampering detected":`Potential tampering: ${t.join(", ")}`,severity:0===t.length?"info":"high"}}static async calculateHash(e){const t=(new TextEncoder).encode(e),i=await crypto.subtle.digest(this.HASH_ALGORITHM,t);return Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,"0")).join("")}static isValidSignatureFormat(e){return e&&"string"==typeof e.value&&"string"==typeof e.algorithm&&e.value.length>=64}static calculateRiskLevel(e){return e>=90?"low":e>=75?"medium":e>=50?"high":"critical"}static generateRecommendations(e){const t=[],i=e.filter(e=>!e.passed);return i.some(e=>"signature_verification"===e.name)&&t.push("Verify plugin comes from a trusted source"),i.some(e=>"content_hash_verification"===e.name)&&t.push("Do not install - plugin may be corrupted or tampered with"),i.some(e=>"tampering_detection"===e.name)&&t.push("Review plugin capabilities and endpoints before installation"),i.some(e=>"source_verification"===e.name)&&t.push("Exercise caution with plugins from unknown sources"),0===t.length&&t.push("Plugin passed all integrity checks"),t}static generateIntegrityReport(e,t){return{pluginId:t,timestamp:(new Date).toISOString(),trustScore:e.trustScore,riskLevel:e.riskLevel,overallStatus:e.isValid?"PASS":"FAIL",checks:e.checks.map(e=>({name:e.name,status:e.passed?"PASS":"FAIL",message:e.message,severity:e.severity})),recommendations:e.recommendations,summary:`Plugin ${t} scored ${e.trustScore.toFixed(1)}% trust score with ${e.riskLevel} risk level`}}}class vt{plugins=new Map;options;constructor(e={}){this.options={debug:!1,maxPlugins:100,events:{},scoringFunction:this.defaultScoringFunction,...e},this.options.debug}async registerPlugin(e){try{const t=dt.validatePluginConfig(e);if(!t.isValid){const i=`Plugin ${e.plugin.id} failed security validation: ${t.errors.join(", ")}`;throw ke.logError(new Error(i),"Plugin Security Validation Failed",{pluginId:e.plugin.id,securityErrors:t.errors,securityWarnings:t.warnings,securityLevel:t.securityLevel}),new Error(i)}const i=await ft.verifyPlugin(e);if(!i.isValid){const t=`Plugin ${e.plugin.id} failed integrity verification (trust score: ${i.trustScore}%)`;throw ke.logError(new Error(t),"Plugin Integrity Validation Failed",{pluginId:e.plugin.id,trustScore:i.trustScore,riskLevel:i.riskLevel,failedChecks:i.checks.filter(e=>!e.passed),recommendations:i.recommendations}),new Error(t)}if("medium"===i.riskLevel||i.riskLevel,t.warnings.length,"critical"===t.securityLevel)throw new Error(`Plugin ${e.plugin.id} has critical security issues and cannot be registered`);if(this.validatePluginConfig(e),this.plugins.size>=this.options.maxPlugins)throw new Error(`Plugin limit reached (${this.options.maxPlugins}). Cannot register plugin: ${e.plugin.id}`);this.plugins.has(e.plugin.id)&&this.options.debug,mt.autoGrantPermissions(e.plugin.id,e.capabilities),this.plugins.set(e.plugin.id,e),this.options.debug,this.options.events.onPluginRegistered?.(e)}catch(t){const i=t instanceof Error?t:new Error(String(t));throw ke.logError(i,"Plugin Registration",{pluginId:e.plugin.id,pluginName:e.plugin.name}),i}}getPlugin(e){return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}getPluginsByFileType(e){const t=e.toLowerCase().replace(/^\./,"");return this.getAllPlugins().filter(e=>e.plugin.fileTypes.some(e=>e.toLowerCase()===t))}detectBestPlugin(e){try{const t=e.split(".").pop()?.toLowerCase()||"",i=this.getPluginsByFileType(t);if(0===i.length)return this.options.debug,this.options.events.onPluginDetected?.(e,null),null;const s=i.map(t=>({plugin:t,score:this.options.scoringFunction(t,e)})).sort((e,t)=>t.score-e.score)[0].plugin;return this.options.debug,this.options.events.onPluginDetected?.(e,s),s}catch(t){return ke.logError(t instanceof Error?t:new Error(String(t)),"Plugin Detection",{filename:e,fileExtension:e.split(".").pop()}),null}}getFileTypePluginMap(){const e={};return this.getAllPlugins().forEach(t=>{t.plugin.fileTypes.forEach(i=>{const s=i.toLowerCase();e[s]||(e[s]=[]),e[s].push(t)})}),e}isPluginRegistered(e){return this.plugins.has(e)}unregisterPlugin(e){const t=this.plugins.delete(e);return t&&(this.options.debug,this.options.events.onPluginUnregistered?.(e)),t}clearAllPlugins(){this.plugins.size,this.plugins.clear(),this.options.debug}getPluginCount(){return this.plugins.size}async executePluginOperation(e,t,i={}){if(!this.getPlugin(e))throw new Error(`Plugin not found: ${e}`);return gt.executePluginOperation(e,t,i)}getPluginSecurityInfo(e){const t=this.getPlugin(e);if(!t)throw new Error(`Plugin not found: ${e}`);const i=dt.validatePluginConfig(t),s=mt.getPermissions(e);return{pluginId:e,securityLevel:i.securityLevel,permissions:s,warnings:i.warnings,hasIssues:i.errors.length>0||i.warnings.length>0}}async getPluginIntegrityInfo(e){const t=this.getPlugin(e);if(!t)throw new Error(`Plugin not found: ${e}`);const i=dt.validatePluginConfig(t),s=await ft.verifyPlugin(t),n=mt.getPermissions(e),r=ft.generateIntegrityReport(s,e);return{pluginId:e,security:{level:i.securityLevel,warnings:i.warnings,errors:i.errors},integrity:{trustScore:s.trustScore,riskLevel:s.riskLevel,checks:s.checks,recommendations:s.recommendations},permissions:n,report:r,overallStatus:i.isValid&&s.isValid?"SECURE":"RISKY"}}defaultScoringFunction(e,t){let i=50;(e.plugin.id.includes("generic")||e.plugin.name.toLowerCase().includes("generic"))&&(i-=20),1===e.plugin.fileTypes.length&&(i+=10);const s=e.plugin.version.match(/v?(\d+)\.(\d+)\.(\d+)/);if(s){const[,e,t,n]=s;i+=5*parseInt(e)+2*parseInt(t)+parseInt(n)}const n=t.toLowerCase();return"amazon-orders"===e.plugin.id&&n.includes("amazon")&&(i+=30),Math.max(0,i)}validatePluginConfig(e){if(!e.plugin)throw new Error("Plugin configuration is missing plugin definition");if(!e.plugin.id||"string"!=typeof e.plugin.id)throw new Error("Plugin ID is required and must be a string");if(!e.plugin.name||"string"!=typeof e.plugin.name)throw new Error("Plugin name is required and must be a string");if(!e.plugin.version||"string"!=typeof e.plugin.version)throw new Error("Plugin version is required and must be a string");if(!Array.isArray(e.plugin.fileTypes)||0===e.plugin.fileTypes.length)throw new Error("Plugin must support at least one file type");if(e.plugin.fileTypes.forEach((e,t)=>{if("string"!=typeof e||""===e.trim())throw new Error(`Invalid file type at index ${t}: must be a non-empty string`)}),!e.capabilities)throw new Error("Plugin capabilities definition is required")}}const yt={plugin:{id:"generic-receipt",name:"Generic Receipt",version:"v1.0.0",description:"Process receipts from any store using Claude AI image analysis. Supports images and PDF files.",icon:"🧾",color:"#10b981",gradientFrom:"#10b98115",gradientTo:"#10b98105",fileTypes:["jpg","jpeg","png","gif","webp","pdf"],maxFileSize:A.GENERIC_RECEIPT_MAX_SIZE_MB*A.MB,features:["Image Processing"],uploadEndpoint:"http://shoptrack.test/upload/generic-receipt",hasManualEntry:!1},capabilities:{fileUpload:!0,manualEntry:!1,batchProcessing:!1,imageProcessing:!0},endpoints:{upload:"http://shoptrack.test/upload/generic-receipt"}},wt={plugin:{id:"amazon-orders",name:"Amazon Orders",version:"v1.0.0",description:"Import Amazon order data from CSV exports or PDF invoices. Supports bulk imports and manual entry.",icon:"📦",color:"#ff9900",gradientFrom:"#ff990015",gradientTo:"#ff990005",fileTypes:["csv","pdf"],maxFileSize:A.AMAZON_ORDERS_MAX_SIZE_MB*A.MB,features:["Manual Entry","Batch Processing"],uploadEndpoint:"http://shoptrack.test/upload/amazon",hasManualEntry:!0,manualEntryRoute:"http://shoptrack.test/upload/amazon/manual"},capabilities:{fileUpload:!0,manualEntry:!0,batchProcessing:!0,imageProcessing:!1},endpoints:{upload:"http://shoptrack.test/upload/amazon",manual:"http://shoptrack.test/upload/amazon/manual"}};const Et=(e,t)=>{ke.logError(e,t).catch(e=>{})};(async()=>{ut.registerInstance(ct.ERROR_LOGGER,ke),ut.registerSingleton(ct.PLUGIN_REGISTRY,()=>new vt({debug:!1,maxPlugins:50,events:{onPluginRegistered:e=>{},onPluginUnregistered:e=>{},onPluginDetected:(e,t)=>{}},scoringFunction:(e,t)=>{let i=50;e.plugin.id.includes("generic")&&(i-=20),1===e.plugin.fileTypes.length?i+=15:e.plugin.fileTypes.length<=3&&(i+=5);const s=e.plugin.version.match(/v?(\d+)\.(\d+)\.(\d+)/);if(s){const[,e,t,n]=s;i+=10*parseInt(e)+3*parseInt(t)+parseInt(n)}const n=t.toLowerCase();return"amazon-orders"===e.plugin.id&&(n.includes("amazon")||n.includes("order"))&&(i+=30),"generic-receipt"===e.plugin.id&&(i-=10),Math.max(0,i)}})),function(){const e=ut.resolve(ct.PLUGIN_REGISTRY);try{e.registerPlugin(yt),e.registerPlugin(wt)}catch(t){throw t}}();try{await ye.initialize()}catch(i){}const e=R(he),t=L();e.config.errorHandler=(e,t,i)=>{Et(e,i),(e=>!["ChunkLoadError","ResizeObserver loop limit exceeded","Non-Error promise rejection captured"].some(t=>e.name.includes(t)||e.message.includes(t)))(e)&&(()=>{try{const e=document.createElement("div");e.className="fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50 max-w-sm";const t=document.createElement("div");t.className="flex items-start";const i=document.createElement("div");i.className="flex-shrink-0";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("class","h-5 w-5"),s.setAttribute("fill","currentColor"),s.setAttribute("viewBox","0 0 20 20");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("fill-rule","evenodd"),n.setAttribute("d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"),n.setAttribute("clip-rule","evenodd"),s.appendChild(n),i.appendChild(s);const r=document.createElement("div");r.className="ml-3";const o=document.createElement("p");o.className="text-sm font-medium",o.textContent="Something went wrong";const a=document.createElement("p");a.className="text-xs mt-1 opacity-90",a.textContent="Please refresh the page if the problem persists.",r.appendChild(o),r.appendChild(a);const l=document.createElement("button");l.className="ml-auto text-white hover:text-gray-200",l.addEventListener("click",()=>{e.remove()});const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("class","h-4 w-4"),c.setAttribute("fill","currentColor"),c.setAttribute("viewBox","0 0 20 20");const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("fill-rule","evenodd"),u.setAttribute("d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"),u.setAttribute("clip-rule","evenodd"),c.appendChild(u),l.appendChild(c),t.appendChild(i),t.appendChild(r),t.appendChild(l),e.appendChild(t),document.body.appendChild(e),setTimeout(()=>{e.parentElement&&e.remove()},1e4)}catch(e){}})()},window.addEventListener("unhandledrejection",e=>{var t;Et(new Error(e.reason),"Unhandled Promise Rejection"),"string"==typeof(t=e.reason)&&(t.includes("ChunkLoadError")||t.includes("Loading chunk")||t.includes("AbortError"))&&e.preventDefault()}),window.addEventListener("error",e=>{Et(e.error||new Error(e.message),"Global JavaScript Error")}),e.use(t),e.use(at),e.component("ErrorBoundary",re),"undefined"!=typeof window&&(window.shopTrackErrorLogger=ke),e.mount("#app")})().catch(e=>{});export{A as F,O as T,Q as _,_e as a,D as b,fe as c,xe as d,Te as p,Se as r,Pe as u};
