import e from"fs";import t,{win32 as r,posix as n,isAbsolute as o,resolve as i}from"path";import s from"child_process";import"node:fs/promises";import a from"zlib";import{Readable as l}from"stream";import u from"util";import p from"os";import{EventEmitter as c}from"events";import f from"http";import h from"net";import d from"node:url";import m from"node:path";import g from"node:module";let y=d.fileURLToPath(import.meta.url);function b(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}m.dirname(y),g.createRequire(import.meta.url);var x,R,S,A,E,w,v,$,_,C,k,O,z={exports:{}},M=b(function(){if(x)return z.exports;x=1;let e,t,r,{defineProperty:n,setPrototypeOf:o,create:i,keys:s}=Object,{round:a,max:l}=Math,u=e=>{let t=/([a-f\d]{3,6})/i.exec(e)?.[1],r=t?.length,n=parseInt(6^r?3^r?"0":t[0]+t[0]+t[1]+t[1]+t[2]+t[2]:t,16);return[n>>16&255,n>>8&255,255&n]},p=(e,t,r)=>e^t||t^r?16+36*a(e/51)+6*a(t/51)+a(r/51):8>e?16:e>248?231:a(24*(e-8)/247)+232,c=e=>{let t,r,n,o,i;return 8>e?30+e:16>e?e-8+90:(232>e?(i=(e-=16)%36,t=(e/36|0)/5,r=(i/6|0)/5,n=i%6/5):t=r=n=(10*(e-232)+8)/255,(o=2*l(t,r,n))?30+(a(n)<<2|a(r)<<1|a(t))+(2^o?0:60):30)},f=(()=>{let r,n,o,i=e=>u.some(t=>e.test(t)),a=globalThis,l=a.process??{},u=l.argv??[],p=l.env??{},c=-1;try{e=","+s(p).join(",")}catch(e){p={},c=0}let f="FORCE_COLOR",h={false:0,0:0,1:1,2:2,3:3}[p[f]]??-1,d=f in p&&h||i(/^--color=?(true|always)?$/);return d&&(c=h),~c||(r=p,n=!!p.PM2_HOME||p.NEXT_RUNTIME?.includes("edge")||!!l.stdout?.isTTY,o="win32"===l.platform,t=r.TERM,c=({"24bit":3,truecolor:3,ansi256:2,ansi:1})[r.COLORTERM]||(r.CI?/,GITHUB/.test(e)?3:1:n&&"dumb"!==t?o?3:/-256/.test(t)?2:1:0)),!h||p.NO_COLOR||i(/^--(no-color|color=(false|never))$/)?0:a.window?.chrome||d&&!c?3:c})(),h={open:"",close:""},d={},m=({p:e},{open:t,close:n})=>{let i=(e,...r)=>{if(!e){if(t&&t===n)return t;if((e??"")==="")return""}let o,s=e.raw?String.raw({raw:e},...r):""+e,a=i.p,l=a.o,u=a.c;if(s.includes("\x1b"))for(;a;a=a.p){let{open:e,close:t}=a,r=t.length,n="",i=0;if(r)for(;~(o=s.indexOf(t,i));i=o+r)n+=s.slice(i,o)+e;s=n+s.slice(i)}return l+(s.includes("\n")?s.replace(/(\r?\n)/g,u+"$1"+l):s)+u},s=t,a=n;return e&&(s=e.o+t,a=n+e.c),o(i,r),i.p={open:t,close:n,o:s,c:a,p:e},i.open=s,i.close=a,i},g=function(e=f){let t={Ansis:g,level:e,isSupported:()=>s,strip:e=>e.replace(/[Â›][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,""),extend(e){for(let t in e){let r=e[t],o=(typeof r)[0],i="s"===o?R(...u(r)):r;d[t]="f"===o?{get(){return(...e)=>m(this,r(...e))}}:{get(){let e=m(this,i);return n(this,t,{value:e}),e}}}return o(t,r=i({},d)),t}},s=e>0,a=(e,t)=>s?{open:`[${e}m`,close:`[${t}m`}:h,l=e=>t=>e(...u(t)),y=(e,t)=>(r,n,o)=>a(`${e}8;2;${r};${n};${o}`,t),b=(e,t)=>(r,n,o)=>a(c(p(r,n,o))+e,t),x=e=>(t,r,n)=>e(p(t,r,n)),R=y(3,39),S=y(4,49),A=e=>a("38;5;"+e,39),E=e=>a("48;5;"+e,49);2===e?(R=x(A),S=x(E)):1===e&&(R=b(0,39),S=b(10,49),A=e=>a(c(e),39),E=e=>a(c(e)+10,49));let w,v={fg:A,bg:E,rgb:R,bgRgb:S,hex:l(R),bgHex:l(S),visible:h,reset:a(0,0),bold:a(1,22),dim:a(2,22),italic:a(3,23),underline:a(4,24),inverse:a(7,27),hidden:a(8,28),strikethrough:a(9,29)},$="Bright";return"black,red,green,yellow,blue,magenta,cyan,white,gray".split(",").map((e,t)=>{w="bg"+e[0].toUpperCase()+e.slice(1),8>t?(v[e+$]=a(90+t,39),v[w+$]=a(100+t,49)):t=60,v[e]=a(30+t,39),v[w]=a(40+t,49)}),t.extend(v)},y=new g;return z.exports=y,y.default=y,z.exports}());let{Ansis:L,fg:I,bg:T,rgb:H,bgRgb:N,hex:B,bgHex:P,reset:F,inverse:j,hidden:D,visible:U,bold:G,dim:W,italic:K,underline:q,strikethrough:Q,black:X,red:J,green:Z,yellow:Y,blue:V,magenta:ee,cyan:et,white:er,gray:en,redBright:eo,greenBright:ei,yellowBright:es,blueBright:ea,magentaBright:el,cyanBright:eu,whiteBright:ep,bgBlack:ec,bgRed:ef,bgGreen:eh,bgYellow:ed,bgBlue:em,bgMagenta:eg,bgCyan:ey,bgWhite:eb,bgGray:ex,bgRedBright:eR,bgGreenBright:eS,bgYellowBright:eA,bgBlueBright:eE,bgMagentaBright:ew,bgCyanBright:ev,bgWhiteBright:e$}=M;var e_={};function eC(){if(S)return R;S=1;let e="[^\\\\/]",t="[^/]",r="(?:\\/|$)",n="(?:^|\\/)",o=`\\.{1,2}${r}`,i=`(?!${n}${o})`,s=`(?!\\.{0,1}${r})`,a=`(?!${o})`,l=`${t}*?`,u={DOT_LITERAL:"\\.",PLUS_LITERAL:"\\+",QMARK_LITERAL:"\\?",SLASH_LITERAL:"\\/",ONE_CHAR:"(?=.)",QMARK:t,END_ANCHOR:r,DOTS_SLASH:o,NO_DOT:"(?!\\.)",NO_DOTS:i,NO_DOT_SLASH:s,NO_DOTS_SLASH:a,QMARK_NO_DOT:"[^.\\/]",STAR:l,START_ANCHOR:n,SEP:"/"},p={...u,SLASH_LITERAL:"[\\\\/]",QMARK:e,STAR:`${e}*?`,DOTS_SLASH:"\\.{1,2}(?:[\\\\/]|$)",NO_DOT:"(?!\\.)",NO_DOTS:"(?!(?:^|[\\\\/])\\.{1,2}(?:[\\\\/]|$))",NO_DOT_SLASH:"(?!\\.{0,1}(?:[\\\\/]|$))",NO_DOTS_SLASH:"(?!\\.{1,2}(?:[\\\\/]|$))",QMARK_NO_DOT:"[^.\\\\/]",START_ANCHOR:"(?:^|[\\\\/])",END_ANCHOR:"(?:[\\\\/]|$)",SEP:"\\"};return R={MAX_LENGTH:65536,POSIX_REGEX_SOURCE:{alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"},REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,extglobChars:e=>({"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}),globChars:e=>!0===e?p:u}}function ek(){if(A)return e_;A=1;let{REGEX_BACKSLASH:e,REGEX_REMOVE_BACKSLASH:t,REGEX_SPECIAL_CHARS:r,REGEX_SPECIAL_CHARS_GLOBAL:n}=eC();return e_.isObject=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),e_.hasRegexChars=e=>r.test(e),e_.isRegexChar=e=>1===e.length&&e_.hasRegexChars(e),e_.escapeRegex=e=>e.replace(n,"\\$1"),e_.toPosixSlashes=t=>t.replace(e,"/"),e_.isWindows=()=>{if("undefined"!=typeof navigator&&navigator.platform){let e=navigator.platform.toLowerCase();return"win32"===e||"windows"===e}return"undefined"!=typeof process&&!!process.platform&&"win32"===process.platform},e_.removeBackslashes=e=>e.replace(t,e=>"\\"===e?"":e),e_.escapeLast=(e,t,r)=>{let n=e.lastIndexOf(t,r);return -1===n?e:"\\"===e[n-1]?e_.escapeLast(e,t,n-1):`${e.slice(0,n)}\\${e.slice(n)}`},e_.removePrefix=(e,t={})=>{let r=e;return r.startsWith("./")&&(r=r.slice(2),t.prefix="./"),r},e_.wrapOutput=(e,t={},r={})=>{let n=r.contains?"":"^",o=r.contains?"":"$",i=`${n}(?:${e})${o}`;return!0===t.negated&&(i=`(?:^(?!${i}).*$)`),i},e_.basename=(e,{windows:t}={})=>{let r=e.split(t?/[\\/]/:"/"),n=r[r.length-1];return""===n?r[r.length-2]:n},e_}var eO=b(function(){if(O)return k;O=1;let e=function(){if(C)return _;C=1;let e=function(){if(w)return E;w=1;let e=ek(),{CHAR_ASTERISK:t,CHAR_AT:r,CHAR_BACKWARD_SLASH:n,CHAR_COMMA:o,CHAR_DOT:i,CHAR_EXCLAMATION_MARK:s,CHAR_FORWARD_SLASH:a,CHAR_LEFT_CURLY_BRACE:l,CHAR_LEFT_PARENTHESES:u,CHAR_LEFT_SQUARE_BRACKET:p,CHAR_PLUS:c,CHAR_QUESTION_MARK:f,CHAR_RIGHT_CURLY_BRACE:h,CHAR_RIGHT_PARENTHESES:d,CHAR_RIGHT_SQUARE_BRACKET:m}=eC(),g=e=>e===a||e===n,y=e=>{!0!==e.isPrefix&&(e.depth=e.isGlobstar?1/0:1)};return E=(b,x)=>{let R,S,A=x||{},E=b.length-1,w=!0===A.parts||!0===A.scanToEnd,v=[],$=[],_=[],C=b,k=-1,O=0,z=0,M=!1,L=!1,I=!1,T=!1,H=!1,N=!1,B=!1,P=!1,F=!1,j=!1,D=0,U={value:"",depth:0,isGlob:!1},G=()=>k>=E,W=()=>C.charCodeAt(k+1),K=()=>(R=S,C.charCodeAt(++k));for(;k<E;){let e;if((S=K())===n){B=U.backslashes=!0,(S=K())===l&&(N=!0);continue}if(!0===N||S===l){for(D++;!0!==G()&&(S=K());){if(S===n){B=U.backslashes=!0,K();continue}if(S===l){D++;continue}if(!0!==N&&S===i&&(S=K())===i||!0!==N&&S===o){if(M=U.isBrace=!0,I=U.isGlob=!0,j=!0,!0===w)continue;break}if(S===h&&0==--D){N=!1,M=U.isBrace=!0,j=!0;break}}if(!0===w)continue;break}if(S===a){if(v.push(k),$.push(U),U={value:"",depth:0,isGlob:!1},!0===j)continue;if(R===i&&k===O+1){O+=2;continue}z=k+1;continue}if(!0!==A.noext&&!0==(S===c||S===r||S===t||S===f||S===s)&&W()===u){if(I=U.isGlob=!0,T=U.isExtglob=!0,j=!0,S===s&&k===O&&(F=!0),!0===w){for(;!0!==G()&&(S=K());){if(S===n){B=U.backslashes=!0,S=K();continue}if(S===d){I=U.isGlob=!0,j=!0;break}}continue}break}if(S===t){if(R===t&&(H=U.isGlobstar=!0),I=U.isGlob=!0,j=!0,!0===w)continue;break}if(S===f){if(I=U.isGlob=!0,j=!0,!0===w)continue;break}if(S===p){for(;!0!==G()&&(e=K());){if(e===n){B=U.backslashes=!0,K();continue}if(e===m){L=U.isBracket=!0,I=U.isGlob=!0,j=!0;break}}if(!0===w)continue;break}if(!0!==A.nonegate&&S===s&&k===O){P=U.negated=!0,O++;continue}if(!0!==A.noparen&&S===u){if(I=U.isGlob=!0,!0===w){for(;!0!==G()&&(S=K());){if(S===u){B=U.backslashes=!0,S=K();continue}if(S===d){j=!0;break}}continue}break}if(!0===I){if(j=!0,!0===w)continue;break}}!0===A.noext&&(T=!1,I=!1);let q=C,Q="",X="";O>0&&(Q=C.slice(0,O),C=C.slice(O),z-=O),q&&!0===I&&z>0?(q=C.slice(0,z),X=C.slice(z)):!0===I?(q="",X=C):q=C,q&&""!==q&&"/"!==q&&q!==C&&g(q.charCodeAt(q.length-1))&&(q=q.slice(0,-1)),!0===A.unescape&&(X&&(X=e.removeBackslashes(X)),q&&!0===B&&(q=e.removeBackslashes(q)));let J={prefix:Q,input:b,start:O,base:q,glob:X,isBrace:M,isBracket:L,isGlob:I,isExtglob:T,isGlobstar:H,negated:P,negatedExtglob:F};if(!0===A.tokens&&(J.maxDepth=0,g(S)||$.push(U),J.tokens=$),!0===A.parts||!0===A.tokens){let e;for(let t=0;t<v.length;t++){let r=e?e+1:O,n=v[t],o=b.slice(r,n);A.tokens&&(0===t&&0!==O?($[t].isPrefix=!0,$[t].value=Q):$[t].value=o,y($[t]),J.maxDepth+=$[t].depth),(0!==t||""!==o)&&_.push(o),e=n}if(e&&e+1<b.length){let t=b.slice(e+1);_.push(t),A.tokens&&($[$.length-1].value=t,y($[$.length-1]),J.maxDepth+=$[$.length-1].depth)}J.slashes=v,J.parts=_}return J}}(),t=function(){if($)return v;$=1;let e=eC(),t=ek(),{MAX_LENGTH:r,POSIX_REGEX_SOURCE:n,REGEX_NON_SPECIAL_CHARS:o,REGEX_SPECIAL_CHARS_BACKREF:i,REPLACEMENTS:s}=e,a=(e,r)=>{if("function"==typeof r.expandRange)return r.expandRange(...e,r);e.sort();let n=`[${e.join("-")}]`;try{new RegExp(n)}catch(r){return e.map(e=>t.escapeRegex(e)).join("..")}return n},l=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,u=(p,c)=>{let f;if("string"!=typeof p)throw TypeError("Expected a string");p=s[p]||p;let h={...c},d="number"==typeof h.maxLength?Math.min(r,h.maxLength):r,m=p.length;if(m>d)throw SyntaxError(`Input length: ${m}, exceeds maximum allowed length: ${d}`);let g={type:"bos",value:"",output:h.prepend||""},y=[g],b=h.capture?"":"?:",x=e.globChars(h.windows),R=e.extglobChars(x),{DOT_LITERAL:S,PLUS_LITERAL:A,SLASH_LITERAL:E,ONE_CHAR:w,DOTS_SLASH:v,NO_DOT:$,NO_DOT_SLASH:_,NO_DOTS_SLASH:C,QMARK:k,QMARK_NO_DOT:O,STAR:z,START_ANCHOR:M}=x,L=e=>`(${b}(?:(?!${M}${e.dot?v:S}).)*?)`,I=h.dot?"":$,T=h.dot?k:O,H=!0===h.bash?L(h):z;h.capture&&(H=`(${H})`),"boolean"==typeof h.noext&&(h.noextglob=h.noext);let N={input:p,index:-1,start:0,dot:!0===h.dot,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:y};m=(p=t.removePrefix(p,N)).length;let B=[],P=[],F=[],j=g,D=()=>N.index===m-1,U=N.peek=(e=1)=>p[N.index+e],G=N.advance=()=>p[++N.index]||"",W=()=>p.slice(N.index+1),K=(e="",t=0)=>{N.consumed+=e,N.index+=t},q=e=>{N.output+=null!=e.output?e.output:e.value,K(e.value)},Q=()=>{let e=1;for(;"!"===U()&&("("!==U(2)||"?"===U(3));)G(),N.start++,e++;return e%2!=0&&(N.negated=!0,N.start++,!0)},X=e=>{N[e]++,F.push(e)},J=e=>{N[e]--,F.pop()},Z=e=>{if("globstar"===j.type){let t=N.braces>0&&("comma"===e.type||"brace"===e.type),r=!0===e.extglob||B.length&&("pipe"===e.type||"paren"===e.type);"slash"===e.type||"paren"===e.type||t||r||(N.output=N.output.slice(0,-j.output.length),j.type="star",j.value="*",j.output=H,N.output+=j.output)}if(B.length&&"paren"!==e.type&&(B[B.length-1].inner+=e.value),(e.value||e.output)&&q(e),j&&"text"===j.type&&"text"===e.type){j.output=(j.output||j.value)+e.value,j.value+=e.value;return}e.prev=j,y.push(e),j=e},Y=(e,t)=>{let r={...R[t],conditions:1,inner:""};r.prev=j,r.parens=N.parens,r.output=N.output;let n=(h.capture?"(":"")+r.open;X("parens"),Z({type:e,value:t,output:N.output?"":w}),Z({type:"paren",extglob:!0,value:G(),output:n}),B.push(r)},V=e=>{let t,r=e.close+(h.capture?")":"");if("negate"===e.type){let n=H;if(e.inner&&e.inner.length>1&&e.inner.includes("/")&&(n=L(h)),(n!==H||D()||/^\)+$/.test(W()))&&(r=e.close=`)$))${n}`),e.inner.includes("*")&&(t=W())&&/^\.[^\\/.]+$/.test(t)){let o=u(t,{...c,fastpaths:!1}).output;r=e.close=`)${o})${n})`}"bos"===e.prev.type&&(N.negatedExtglob=!0)}Z({type:"paren",extglob:!0,value:f,output:r}),J("parens")};if(!1!==h.fastpaths&&!/(^[*!]|[/()[\]{}"])/.test(p)){let e=!1,r=p.replace(i,(t,r,n,o,i,s)=>"\\"===o?(e=!0,t):"?"===o?r?r+o+(i?k.repeat(i.length):""):0===s?T+(i?k.repeat(i.length):""):k.repeat(n.length):"."===o?S.repeat(n.length):"*"===o?r?r+o+(i?H:""):H:r?t:`\\${t}`);return(!0===e&&(r=!0===h.unescape?r.replace(/\\/g,""):r.replace(/\\+/g,e=>e.length%2==0?"\\\\":e?"\\":"")),r===p&&!0===h.contains)?N.output=p:N.output=t.wrapOutput(r,N,c),N}for(;!D();){if("\0"===(f=G()))continue;if("\\"===f){let e=U();if("/"===e&&!0!==h.bash||"."===e||";"===e)continue;if(!e){Z({type:"text",value:f+="\\"});continue}let t=/^\\+/.exec(W()),r=0;if(t&&t[0].length>2&&(r=t[0].length,N.index+=r,r%2!=0&&(f+="\\")),!0===h.unescape?f=G():f+=G(),0===N.brackets){Z({type:"text",value:f});continue}}if(N.brackets>0&&("]"!==f||"["===j.value||"[^"===j.value)){if(!1!==h.posix&&":"===f){let e=j.value.slice(1);if(e.includes("[")&&(j.posix=!0,e.includes(":"))){let e=j.value.lastIndexOf("["),t=j.value.slice(0,e),r=n[j.value.slice(e+2)];if(r){j.value=t+r,N.backtrack=!0,G(),g.output||1!==y.indexOf(j)||(g.output=w);continue}}}("["===f&&":"!==U()||"-"===f&&"]"===U())&&(f=`\\${f}`),"]"===f&&("["===j.value||"[^"===j.value)&&(f=`\\${f}`),!0===h.posix&&"!"===f&&"["===j.value&&(f="^"),j.value+=f,q({value:f});continue}if(1===N.quotes&&'"'!==f){f=t.escapeRegex(f),j.value+=f,q({value:f});continue}if('"'===f){N.quotes=+(1!==N.quotes),!0===h.keepQuotes&&Z({type:"text",value:f});continue}if("("===f){X("parens"),Z({type:"paren",value:f});continue}if(")"===f){if(0===N.parens&&!0===h.strictBrackets)throw SyntaxError(l("opening","("));let e=B[B.length-1];if(e&&N.parens===e.parens+1){V(B.pop());continue}Z({type:"paren",value:f,output:N.parens?")":"\\)"}),J("parens");continue}if("["===f){if(!0!==h.nobracket&&W().includes("]"))X("brackets");else{if(!0!==h.nobracket&&!0===h.strictBrackets)throw SyntaxError(l("closing","]"));f=`\\${f}`}Z({type:"bracket",value:f});continue}if("]"===f){if(!0===h.nobracket||j&&"bracket"===j.type&&1===j.value.length){Z({type:"text",value:f,output:`\\${f}`});continue}if(0===N.brackets){if(!0===h.strictBrackets)throw SyntaxError(l("opening","["));Z({type:"text",value:f,output:`\\${f}`});continue}J("brackets");let e=j.value.slice(1);if(!0===j.posix||"^"!==e[0]||e.includes("/")||(f=`/${f}`),j.value+=f,q({value:f}),!1===h.literalBrackets||t.hasRegexChars(e))continue;let r=t.escapeRegex(j.value);if(N.output=N.output.slice(0,-j.value.length),!0===h.literalBrackets){N.output+=r,j.value=r;continue}j.value=`(${b}${r}|${j.value})`,N.output+=j.value;continue}if("{"===f&&!0!==h.nobrace){X("braces");let e={type:"brace",value:f,output:"(",outputIndex:N.output.length,tokensIndex:N.tokens.length};P.push(e),Z(e);continue}if("}"===f){let e=P[P.length-1];if(!0===h.nobrace||!e){Z({type:"text",value:f,output:f});continue}let t=")";if(!0===e.dots){let e=y.slice(),r=[];for(let t=e.length-1;t>=0&&(y.pop(),"brace"!==e[t].type);t--)"dots"!==e[t].type&&r.unshift(e[t].value);t=a(r,h),N.backtrack=!0}if(!0!==e.comma&&!0!==e.dots){let r=N.output.slice(0,e.outputIndex),n=N.tokens.slice(e.tokensIndex);for(let o of(e.value=e.output="\\{",f=t="\\}",N.output=r,n))N.output+=o.output||o.value}Z({type:"brace",value:f,output:t}),J("braces"),P.pop();continue}if("|"===f){B.length>0&&B[B.length-1].conditions++,Z({type:"text",value:f});continue}if(","===f){let e=f,t=P[P.length-1];t&&"braces"===F[F.length-1]&&(t.comma=!0,e="|"),Z({type:"comma",value:f,output:e});continue}if("/"===f){if("dot"===j.type&&N.index===N.start+1){N.start=N.index+1,N.consumed="",N.output="",y.pop(),j=g;continue}Z({type:"slash",value:f,output:E});continue}if("."===f){if(N.braces>0&&"dot"===j.type){"."===j.value&&(j.output=S);let e=P[P.length-1];j.type="dots",j.output+=f,j.value+=f,e.dots=!0;continue}if(N.braces+N.parens===0&&"bos"!==j.type&&"slash"!==j.type){Z({type:"text",value:f,output:S});continue}Z({type:"dot",value:f,output:S});continue}if("?"===f){if(!(j&&"("===j.value)&&!0!==h.noextglob&&"("===U()&&"?"!==U(2)){Y("qmark",f);continue}if(j&&"paren"===j.type){let e=U(),t=f;("("!==j.value||/[!=<:]/.test(e))&&("<"!==e||/<([!=]|\w+>)/.test(W()))||(t=`\\${f}`),Z({type:"text",value:f,output:t});continue}if(!0!==h.dot&&("slash"===j.type||"bos"===j.type)){Z({type:"qmark",value:f,output:O});continue}Z({type:"qmark",value:f,output:k});continue}if("!"===f){if(!0!==h.noextglob&&"("===U()&&("?"!==U(2)||!/[!=<:]/.test(U(3)))){Y("negate",f);continue}if(!0!==h.nonegate&&0===N.index){Q();continue}}if("+"===f){if(!0!==h.noextglob&&"("===U()&&"?"!==U(2)){Y("plus",f);continue}if(j&&"("===j.value||!1===h.regex){Z({type:"plus",value:f,output:A});continue}if(j&&("bracket"===j.type||"paren"===j.type||"brace"===j.type)||N.parens>0){Z({type:"plus",value:f});continue}Z({type:"plus",value:A});continue}if("@"===f){if(!0!==h.noextglob&&"("===U()&&"?"!==U(2)){Z({type:"at",extglob:!0,value:f,output:""});continue}Z({type:"text",value:f});continue}if("*"!==f){("$"===f||"^"===f)&&(f=`\\${f}`);let e=o.exec(W());e&&(f+=e[0],N.index+=e[0].length),Z({type:"text",value:f});continue}if(j&&("globstar"===j.type||!0===j.star)){j.type="star",j.star=!0,j.value+=f,j.output=H,N.backtrack=!0,N.globstar=!0,K(f);continue}let e=W();if(!0!==h.noextglob&&/^\([^?]/.test(e)){Y("star",f);continue}if("star"===j.type){if(!0===h.noglobstar){K(f);continue}let t=j.prev,r=t.prev,n="slash"===t.type||"bos"===t.type,o=r&&("star"===r.type||"globstar"===r.type);if(!0===h.bash&&(!n||e[0]&&"/"!==e[0])){Z({type:"star",value:f,output:""});continue}let i=N.braces>0&&("comma"===t.type||"brace"===t.type),s=B.length&&("pipe"===t.type||"paren"===t.type);if(!n&&"paren"!==t.type&&!i&&!s){Z({type:"star",value:f,output:""});continue}for(;"/**"===e.slice(0,3);){let t=p[N.index+4];if(t&&"/"!==t)break;e=e.slice(3),K("/**",3)}if("bos"===t.type&&D()){j.type="globstar",j.value+=f,j.output=L(h),N.output=j.output,N.globstar=!0,K(f);continue}if("slash"===t.type&&"bos"!==t.prev.type&&!o&&D()){N.output=N.output.slice(0,-(t.output+j.output).length),t.output=`(?:${t.output}`,j.type="globstar",j.output=L(h)+(h.strictSlashes?")":"|$)"),j.value+=f,N.globstar=!0,N.output+=t.output+j.output,K(f);continue}if("slash"===t.type&&"bos"!==t.prev.type&&"/"===e[0]){let r=void 0!==e[1]?"|$":"";N.output=N.output.slice(0,-(t.output+j.output).length),t.output=`(?:${t.output}`,j.type="globstar",j.output=`${L(h)}${E}|${E}${r})`,j.value+=f,N.output+=t.output+j.output,N.globstar=!0,K(f+G()),Z({type:"slash",value:"/",output:""});continue}if("bos"===t.type&&"/"===e[0]){j.type="globstar",j.value+=f,j.output=`(?:^|${E}|${L(h)}${E})`,N.output=j.output,N.globstar=!0,K(f+G()),Z({type:"slash",value:"/",output:""});continue}N.output=N.output.slice(0,-j.output.length),j.type="globstar",j.output=L(h),j.value+=f,N.output+=j.output,N.globstar=!0,K(f);continue}let r={type:"star",value:f,output:H};if(!0===h.bash){r.output=".*?",("bos"===j.type||"slash"===j.type)&&(r.output=I+r.output),Z(r);continue}if(j&&("bracket"===j.type||"paren"===j.type)&&!0===h.regex){r.output=f,Z(r);continue}(N.index===N.start||"slash"===j.type||"dot"===j.type)&&("dot"===j.type?(N.output+=_,j.output+=_):!0===h.dot?(N.output+=C,j.output+=C):(N.output+=I,j.output+=I),"*"!==U()&&(N.output+=w,j.output+=w)),Z(r)}for(;N.brackets>0;){if(!0===h.strictBrackets)throw SyntaxError(l("closing","]"));N.output=t.escapeLast(N.output,"["),J("brackets")}for(;N.parens>0;){if(!0===h.strictBrackets)throw SyntaxError(l("closing",")"));N.output=t.escapeLast(N.output,"("),J("parens")}for(;N.braces>0;){if(!0===h.strictBrackets)throw SyntaxError(l("closing","}"));N.output=t.escapeLast(N.output,"{"),J("braces")}if(!0!==h.strictSlashes&&("star"===j.type||"bracket"===j.type)&&Z({type:"maybe_slash",value:"",output:`${E}?`}),!0===N.backtrack)for(let e of(N.output="",N.tokens))N.output+=null!=e.output?e.output:e.value,e.suffix&&(N.output+=e.suffix);return N};return u.fastpaths=(n,o)=>{let i={...o},a="number"==typeof i.maxLength?Math.min(r,i.maxLength):r,l=n.length;if(l>a)throw SyntaxError(`Input length: ${l}, exceeds maximum allowed length: ${a}`);n=s[n]||n;let{DOT_LITERAL:u,SLASH_LITERAL:p,ONE_CHAR:c,DOTS_SLASH:f,NO_DOT:h,NO_DOTS:d,NO_DOTS_SLASH:m,STAR:g,START_ANCHOR:y}=e.globChars(i.windows),b=i.dot?d:h,x=i.dot?m:h,R=i.capture?"":"?:",S=!0===i.bash?".*?":g;i.capture&&(S=`(${S})`);let A=e=>!0===e.noglobstar?S:`(${R}(?:(?!${y}${e.dot?f:u}).)*?)`,E=e=>{switch(e){case"*":return`${b}${c}${S}`;case".*":return`${u}${c}${S}`;case"*.*":return`${b}${S}${u}${c}${S}`;case"*/*":return`${b}${S}${p}${c}${x}${S}`;case"**":return b+A(i);case"**/*":return`(?:${b}${A(i)}${p})?${x}${c}${S}`;case"**/*.*":return`(?:${b}${A(i)}${p})?${x}${S}${u}${c}${S}`;case"**/.*":return`(?:${b}${A(i)}${p})?${u}${c}${S}`;default:{let t=/^(.*?)\.(\w+)$/.exec(e);if(!t)return;let r=E(t[1]);if(!r)return;return r+u+t[2]}}},w=E(t.removePrefix(n,{negated:!1,prefix:""}));return w&&!0!==i.strictSlashes&&(w+=`${p}?`),w},v=u}(),r=ek(),n=eC(),o=e=>e&&"object"==typeof e&&!Array.isArray(e),i=(e,t,r=!1)=>{if(Array.isArray(e)){let n=e.map(e=>i(e,t,r));return e=>{for(let t of n){let r=t(e);if(r)return r}return!1}}let n=o(e)&&e.tokens&&e.input;if(""===e||"string"!=typeof e&&!n)throw TypeError("Expected pattern to be a non-empty string");let s=t||{},a=s.windows,l=n?i.compileRe(e,t):i.makeRe(e,t,!1,!0),u=l.state;delete l.state;let p=()=>!1;if(s.ignore){let e={...t,ignore:null,onMatch:null,onResult:null};p=i(s.ignore,e,r)}let c=(r,n=!1)=>{let{isMatch:o,match:c,output:f}=i.test(r,l,t,{glob:e,posix:a}),h={glob:e,state:u,regex:l,posix:a,input:r,output:f,match:c,isMatch:o};return("function"==typeof s.onResult&&s.onResult(h),!1===o)?(h.isMatch=!1,!!n&&h):p(r)?("function"==typeof s.onIgnore&&s.onIgnore(h),h.isMatch=!1,!!n&&h):("function"==typeof s.onMatch&&s.onMatch(h),!n||h)};return r&&(c.state=u),c};return i.test=(e,t,n,{glob:o,posix:s}={})=>{if("string"!=typeof e)throw TypeError("Expected input to be a string");if(""===e)return{isMatch:!1,output:""};let a=n||{},l=a.format||(s?r.toPosixSlashes:null),u=e===o,p=u&&l?l(e):e;return!1===u&&(u=(p=l?l(e):e)===o),(!1===u||!0===a.capture)&&(u=!0===a.matchBase||!0===a.basename?i.matchBase(e,t,n,s):t.exec(p)),{isMatch:!!u,match:u,output:p}},i.matchBase=(e,t,n)=>(t instanceof RegExp?t:i.makeRe(t,n)).test(r.basename(e)),i.isMatch=(e,t,r)=>i(t,r)(e),i.parse=(e,r)=>Array.isArray(e)?e.map(e=>i.parse(e,r)):t(e,{...r,fastpaths:!1}),i.scan=(t,r)=>e(t,r),i.compileRe=(e,t,r=!1,n=!1)=>{if(!0===r)return e.output;let o=t||{},s=o.contains?"":"^",a=o.contains?"":"$",l=`${s}(?:${e.output})${a}`;e&&!0===e.negated&&(l=`^(?!${l}).*$`);let u=i.toRegex(l,t);return!0===n&&(u.state=e),u},i.makeRe=(e,r={},n=!1,o=!1)=>{if(!e||"string"!=typeof e)throw TypeError("Expected a non-empty string");let s={negated:!1,fastpaths:!0};return!1!==r.fastpaths&&("."===e[0]||"*"===e[0])&&(s.output=t.fastpaths(e,r)),s.output||(s=t(e,r)),i.compileRe(s,r,n,o)},i.toRegex=(e,t)=>{try{let r=t||{};return new RegExp(e,r.flags||(r.nocase?"i":""))}catch(e){if(t&&!0===t.debug)throw e;return/$^/}},i.constants=n,_=i}(),t=ek();function r(n,o,i=!1){return o&&(null===o.windows||void 0===o.windows)&&(o={...o,windows:t.isWindows()}),e(n,o,i)}return Object.assign(r,e),k=r}());new TextEncoder,new TextDecoder;let{platform:ez,arch:eM}=process,eL=["pnpm-workspace.yaml","lerna.json"];function eI(r,n=r){if(function(r){let n=t.join(r,"package.json");return e.existsSync(n)}(r))return r;let o=t.dirname(r);return o&&o!==r?eI(o,n):n}function eT(r,n=eI(r)){if(eL.some(n=>e.existsSync(t.join(r,n)))||function(r){let n=t.join(r,"package.json");if(!function(t){if(!function(t){try{return e.statSync(t,{throwIfNoEntry:!1})}catch{}}(t))return!1;try{return e.accessSync(t,e.constants.R_OK),!0}catch{return!1}}(n))return!1;try{return!!(JSON.parse(e.readFileSync(n,"utf-8"))||{}).workspaces}catch{return!1}}(r))return r;let o=t.dirname(r);return o&&o!==r?eT(o,n):n}function eH(e){return Array.isArray(e)?e:null==e?[]:[e]}let eN=RegExp(`\\${r.sep}`,"g"),eB=function(e){return e.replace(eN,n.sep)},eP=function(e,t,r){let s=r&&r.resolve,a=e=>e instanceof RegExp?e:{test:t=>eO(function(e,t){if(!1===t||o(e)||e.startsWith("**"))return eB(e);let r=eB(i(t||"")).replace(/[-^$*+?.()|[\]{}]/g,"\\$&");return n.join(r,eB(e))}(e,s),{dot:!0})(t)},l=eH(e).map(a),u=eH(t).map(a);return l.length||u.length?function(e){if("string"!=typeof e||e.includes("\0"))return!1;let t=eB(e);for(let e=0;e<u.length;++e){let r=u[e];if(r instanceof RegExp&&(r.lastIndex=0),r.test(t))return!1}for(let e=0;e<l.length;++e){let r=l[e];if(r instanceof RegExp&&(r.lastIndex=0),r.test(t))return!0}return!l.length}:e=>"string"==typeof e&&!e.includes("\0")};new Set("break case class catch const continue debugger default delete do else export extends finally for function if import in instanceof let new return super switch this throw try typeof var void while with yield enum await implements package protected static interface private public arguments Infinity NaN undefined null true false eval uneval isFinite isNaN parseFloat parseInt decodeURI decodeURIComponent encodeURI encodeURIComponent escape unescape Object Function Boolean Symbol Error EvalError InternalError RangeError ReferenceError SyntaxError TypeError URIError Number Math Date String RegExp Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array Map Set WeakMap WeakSet SIMD ArrayBuffer DataView JSON Promise Generator GeneratorFunction Reflect Proxy Intl".split(" ")).add("");function eF(e,t){return t.reduce((t,r)=>(t[r]=e[r],t),{})}let ej=e.promises,eD=new TextEncoder,eU=new TextDecoder,eG=u.promisify(a.gzip),eW=u.promisify(a.brotliCompress),eK={level:a.constants.Z_DEFAULT_LEVEL},eq={params:{[a.constants.BROTLI_PARAM_QUALITY]:a.constants.BROTLI_MAX_QUALITY}};function eQ(e){return/^\\\\\?\\/.test(e)?e:e.replace(/\\/g,"/")}function eX(e){return"string"==typeof e?eD.encode(e):e}function eJ(e){return"string"==typeof e?e:eU.decode(e)}let eZ=process.env.DEBUG||process.env.ANALYZE_DEBUG?(...e)=>{console.log(M.hex("#5B45DE")("[vite:bundle-analyzer]"),...e)}:()=>{};function eY(){let e,t=!1;return{rs:new l,into(r){t||(this.rs.push(r),this.rs.push(null),e||(e=eX(r)),t=!0)},refresh(r){r&&(e=eX(r)),t=!1,this.rs=new l,this.into(e)}}}let eV="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e0=new Uint8Array(64),e1=new Uint8Array(128);for(let e=0;e<eV.length;e++){let t=eV.charCodeAt(e);e0[e]=t,e1[t]=e}function e2(e,t){let r=0,n=0,o=0;do r|=(31&(o=e1[e.next()]))<<n,n+=5;while(32&o);let i=1&r;return r>>>=1,i&&(r=-0x80000000|-r),t+r}function e3(e,t){return!(e.pos>=t)&&44!==e.peek()}class e4{constructor(e){this.pos=0,this.buffer=e}next(){return this.buffer.charCodeAt(this.pos++)}peek(){return this.buffer.charCodeAt(this.pos)}indexOf(e){let{buffer:t,pos:r}=this,n=t.indexOf(e,r);return -1===n?t.length:n}}function e5(e,t){return e[0]-t[0]}let e6=/^[\w+.-]+:\/\//,e9=/^([\w+.-]+:)\/\/([^@/#?]*@)?([^:/#?]*)(:\d+)?(\/[^#?]*)?(\?[^#]*)?(#.*)?/,e8=/^file:(?:\/\/((?![a-z]:)[^/#?]*)?)?(\/?[^#?]*)(\?[^#]*)?(#.*)?/i;function e7(e){return e.startsWith("/")}function te(e){return/^[.?#]/.test(e)}function tt(e){let t=e9.exec(e);return tr(t[1],t[2]||"",t[3],t[4]||"",t[5]||"/",t[6]||"",t[7]||"")}function tr(e,t,r,n,o,i,s){return{scheme:e,user:t,host:r,port:n,path:o,query:i,hash:s,type:7}}function tn(e){if(e.startsWith("//")){let t=tt("http:"+e);return t.scheme="",t.type=6,t}if(e7(e)){let t=tt("http://foo.com"+e);return t.scheme="",t.host="",t.type=5,t}if(e.startsWith("file:")){let t=e8.exec(e),r=t[2];return tr("file:","",t[1]||"","",e7(r)?r:"/"+r,t[3]||"",t[4]||"")}if(e6.test(e))return tt(e);let t=tt("http://foo.com/"+e);return t.scheme="",t.host="",t.type=e?e.startsWith("?")?3:e.startsWith("#")?2:4:1,t}function to(e,t){let r=t<=4,n=e.path.split("/"),o=1,i=0,s=!1;for(let e=1;e<n.length;e++){let t=n[e];if(!t){s=!0;continue}if(s=!1,"."!==t){if(".."===t){i?(s=!0,i--,o--):r&&(n[o++]=t);continue}n[o++]=t,i++}}let a="";for(let e=1;e<o;e++)a+="/"+n[e];a&&(!s||a.endsWith("/.."))||(a+="/"),e.path=a}function ti(e,t){return t&&!t.endsWith("/")&&(t+="/"),function(e,t){if(!e&&!t)return"";let r=tn(e),n=r.type;if(t&&7!==n){let e=tn(t),o=e.type;switch(n){case 1:r.hash=e.hash;case 2:r.query=e.query;case 3:case 4:to(e,e.type),"/"===r.path?r.path=e.path:r.path=function(e){if(e.endsWith("/.."))return e;let t=e.lastIndexOf("/");return e.slice(0,t+1)}(e.path)+r.path;case 5:r.user=e.user,r.host=e.host,r.port=e.port;case 6:r.scheme=e.scheme}o>n&&(n=o)}to(r,n);let o=r.query+r.hash;switch(n){case 2:case 3:return o;case 4:{let n=r.path.slice(1);if(!n)return o||".";if(te(t||e)&&!te(n))return"./"+n+o;return n+o}case 5:return r.path+o;default:return r.scheme+"//"+r.user+r.host+r.port+r.path+o}}(e,t)}function ts(e,t){for(let r=t;r<e.length;r++)if(!function(e){for(let t=1;t<e.length;t++)if(e[t][0]<e[t-1][0])return!1;return!0}(e[r]))return r;return e.length}function ta(e,t){return e[0]-t[0]}let tl=!1,tu=function(e,t){let r=tp(e);if(!("sections"in r))return new tf(r,t);let n=[],o=[],i=[],s=[],a=[];return function e(t,r,n,o,i,s,a,l,u,p,c){let{sections:f}=t;for(let t=0;t<f.length;t++){let{map:h,offset:d}=f[t],m=p,g=c;if(t+1<f.length){let e=f[t+1].offset;(m=Math.min(p,l+e.line))===p?g=Math.min(c,u+e.column):m<p&&(g=u+e.column)}!function(t,r,n,o,i,s,a,l,u,p,c){let f=tp(t);if("sections"in f)return e(...arguments);let h=new tf(f,r),d=o.length,m=s.length,g=th(h),{resolvedSources:y,sourcesContent:b,ignoreList:x}=h;if(tc(o,y),tc(s,h.names),b)tc(i,b);else for(let e=0;e<y.length;e++)i.push(null);if(x)for(let e=0;e<x.length;e++)a.push(x[e]+d);for(let e=0;e<g.length;e++){let t=l+e;if(t>p)return;let r=function(e,t){for(let r=e.length;r<=t;r++)e[r]=[];return e[t]}(n,t),o=0===e?u:0,i=g[e];for(let e=0;e<i.length;e++){let n=i[e],s=o+n[0];if(t===p&&s>=c)return;if(1===n.length){r.push([s]);continue}let a=d+n[1],l=n[2],u=n[3];r.push(4===n.length?[s,a,l,u]:[s,a,l,u,m+n[4]])}}}(h,r,n,o,i,s,a,l+d.line,u+d.column,m,g)}}(r,t,n,o,i,s,a,0,0,1/0,1/0),function(e,t){var r,n;let o=new tf((n=[],{version:(r=e).version,file:r.file,names:r.names,sourceRoot:r.sourceRoot,sources:r.sources,sourcesContent:r.sourcesContent,mappings:n,ignoreList:r.ignoreList||r.x_google_ignoreList}),void 0);return o._decoded=e.mappings,o}({version:3,file:r.file,names:s,sources:o,sourcesContent:i,mappings:n,ignoreList:a})};function tp(e){return"string"==typeof e?JSON.parse(e):e}function tc(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}class tf{constructor(e,t){let r="string"==typeof e;if(!r&&e._decodedMemo)return e;let n=r?JSON.parse(e):e,{version:o,file:i,names:s,sourceRoot:a,sources:l,sourcesContent:u}=n;this.version=o,this.file=i,this.names=s||[],this.sourceRoot=a,this.sources=l,this.sourcesContent=u,this.ignoreList=n.ignoreList||n.x_google_ignoreList||void 0;let p=ti(a||"",function(e){if(!e)return"";let t=e.lastIndexOf("/");return e.slice(0,t+1)}(t));this.resolvedSources=l.map(e=>ti(e||"",p));let{mappings:c}=n;"string"==typeof c?(this._encoded=c,this._decoded=void 0):(this._encoded=void 0,this._decoded=function(e,t){let r=ts(e,0);if(r===e.length)return e;t||(e=e.slice());for(let o=r;o<e.length;o=ts(e,o+1)){var n;e[o]=(n=e[o],t||(n=n.slice()),n.sort(ta))}return e}(c,r)),this._decodedMemo={lastKey:-1,lastNeedle:-1,lastIndex:-1},this._bySources=void 0,this._bySourceMemos=void 0}}function th(e){return e._decoded||(e._decoded=function(e){let{length:t}=e,r=new e4(e),n=[],o=0,i=0,s=0,a=0,l=0;do{let e=r.indexOf(";"),t=[],u=!0,p=0;for(o=0;r.pos<e;){let n;(o=e2(r,o))<p&&(u=!1),p=o,e3(r,e)?(i=e2(r,i),s=e2(r,s),a=e2(r,a),n=e3(r,e)?[o,i,s,a,l=e2(r,l)]:[o,i,s,a]):n=[o],t.push(n),r.pos++}u||t.sort(e5),n.push(t),r.pos=e+1}while(r.pos<=t);return n}(e._encoded))}function td(e,t,r,n){return{source:e,line:t,column:r,name:n}}class tm{constructor(e,t){let r=this._map=new tu(e,t);this.file=r.file,this.names=r.names,this.sourceRoot=r.sourceRoot,this.sources=r.resolvedSources,this.sourcesContent=r.sourcesContent,this.version=r.version}originalPositionFor(e){return function(e,t){var r,n,o,i,s;let a,{line:l,column:u,bias:p}=t;if(--l<0)throw Error("`line` must be greater than 0 (lines start at line 1)");if(u<0)throw Error("`column` must be greater than or equal to 0 (columns start at column 0)");let c=th(e);if(l>=c.length)return td(null,null,null,null);let f=c[l],h=(r=f,n=e._decodedMemo,o=l,i=u,s=p||1,a=function(e,t,r,n){let{lastKey:o,lastNeedle:i,lastIndex:s}=r,a=0,l=e.length-1;if(n===o){if(t===i)return tl=-1!==s&&e[s][0]===t,s;t>=i?a=-1===s?0:s:l=s}return r.lastKey=n,r.lastNeedle=t,r.lastIndex=function(e,t,r,n){for(;r<=n;){let o=r+(n-r>>1),i=e[o][0]-t;if(0===i)return tl=!0,o;i<0?r=o+1:n=o-1}return tl=!1,r-1}(e,t,a,l)}(r,i,n,o),(tl?a=(-1===s?function(e,t,r){for(let n=r+1;n<e.length&&e[n][0]===t;r=n++);return r}:function(e,t,r){for(let n=r-1;n>=0&&e[n][0]===t;r=n--);return r})(r,i,a):-1===s&&a++,-1===a||a===r.length)?-1:a);if(-1===h)return td(null,null,null,null);let d=f[h];if(1===d.length)return td(null,null,null,null);let{names:m,resolvedSources:g}=e;return td(g[d[1]],d[2]+1,d[3],5===d.length?m[d[4]]:null)}(this._map,e)}sourceContentFor(e,t){let r=function(e,t){let{sourcesContent:r}=e;if(null==r)return null;let n=function(e,t){let{sources:r,resolvedSources:n}=e,o=r.indexOf(t);return -1===o&&(o=n.indexOf(t)),o}(e,t);return -1===n?null:r[n]}(this._map,e);if(null!=r)return r;if(t)return null;throw Error(`"${e}" is not in the SourceMap.`)}}function tg(e){return e.replace(/^((\.\.\/)+|(\.\.\\)+)/,"")}function ty(e,r){if("."===r[0]){let n=tg(e),o=t.dirname(n);return eQ(t.join(o,r))}return r}function tb(e){let t,r=[],n=[],o=/import\s+(?:(?:[^{}*'"\s,]+)\s*,?\s*)?(?:{(?:[^{}]*)})?\s*from\s+['"]([^'"]+)['"]/g;for(;null!==(t=o.exec(e));)r.push(t[1]);let i=/import\s*\(\s*['"]([^'"]+)['"]\s*\)/g;for(;null!==(t=i.exec(e));)n.push(t[1]);return{staticImports:r,dynamicImports:n}}class tx{meta;filename;children;groups;isEndOfPath;constructor(e){this.meta=e?.meta||{},this.filename=e?.filename||"",this.children=new Map,this.groups=[],this.isEndOfPath=!1}}class tR{root;constructor(e){this.root=new tx(e)}insert(e,t){let r=this.root,n=e.split("/").filter(Boolean),o="";for(let e of n)o=o?`${o}/${e}`:e,r.children.has(e)||r.children.set(e,new tx({...t})),(r=r.children.get(e)).filename=o;r.isEndOfPath=!0}mergePrefixSingleDirectory(e=this.root){for(let[t,r]of e.children.entries()){if(r.isEndOfPath)break;if(r.children.size>1){this.mergePrefixSingleDirectory(r);continue}for(let[n,o]of(e.children.delete(t),r.children.entries()))e.children.set(`${t}/${n}`,o),o.isEndOfPath||this.mergePrefixSingleDirectory(o)}}walk(e,t){if(e.children.size){for(let[r,n]of e.children.entries()){let o={...n.meta,label:r,groups:n.groups,filename:n.filename};n.isEndOfPath&&delete o.groups,t.enter&&t.enter(o,e,n.isEndOfPath),this.walk(n,t),t.leave&&t.leave(o,e,n.isEndOfPath)}e.children.clear()}}}let tS=process.cwd();function tA(e,t,r){if(t in r)return r[t].source;throw Error(`[analyzer error]: Missing sourcemap for ${e}.`)}let tE=/\.(c|m)?js$/;async function tw(e,t){let[{byteLength:r},{byteLength:n}]=await Promise.all([t.gzip(e),t.brotli(e)]);return{gzipSize:r,brotliSize:n}}function tv(e){return Array.from(new Set(e))}function t$(e,t){return e=[...tv(e)],t=[...tv(t)],[...e.map(e=>({id:e,kind:"static"})),...t.map(e=>({id:e,kind:"dynamic"}))]}class t_{originalId;filename;label;parsedSize;mapSize;gzipSize;brotliSize;source;imports;isAsset;isEntry;constructor(e){this.originalId=e,this.filename=e,this.label=e,this.parsedSize=0,this.gzipSize=0,this.brotliSize=0,this.mapSize=0,this.source=[],this.imports=new Set,this.isAsset=!0,this.isEntry=!1}addImports(...e){e.forEach(e=>this.imports.add(e))}async setup(e,r,n,o,i){let s=new tR({meta:{gzipSize:0,brotliSize:0,parsedSize:0,importedBy:[]}});if("asset"===e.kind){this.parsedSize=e.code.byteLength;let{brotliSize:t,gzipSize:n}=await tw(e.code,r);this.brotliSize=t,this.gzipSize=n}else{let{code:a,imports:l,dynamicImports:u,map:p}=e;if(this.addImports(...l,...u),this.mapSize=p.length,this.isEntry=e.isEntry,p){let{grouped:e,files:l}=function(e,t){let r=new tm(t),n={},o=new Set,i=1,s=0,a=eJ(e);for(let e=0;e<a.length;e++,s++){let{source:t}=r.originalPositionFor({line:i,column:s});if(null!=t){let r=tg(t),i=a[e];r in n||(n[r]={code:"",importedBy:[]},n[r].code=""),n[r].code+=i,o.add(r)}"\n"===a[e]&&(i+=1,s=-1)}for(let e of r.sources.reduce((e,t)=>{if(t){let n=r.sourceContentFor(t,!0);if(n){let{staticImports:r,dynamicImports:o}=tb(n);e.push({id:tg(t),code:n,importedBy:t$(r.map(e=>ty(t,e)),o.map(e=>ty(t,e)))})}}return e},[]))e.id in n&&(n[e.id].importedBy=e.importedBy);return{grouped:n,files:o}}(a,p);if(!l.size){let t=eJ(a),{staticImports:r,dynamicImports:n}=tb(eJ(a));e[this.originalId]={code:t,importedBy:t$(r.map(e=>ty(this.originalId,e)),n.map(e=>ty(this.originalId,e)))},l.add(this.originalId)}let u=Object.entries(e).filter(([e])=>o(e));await Promise.all(u.map(async([e,{code:o,importedBy:a}])=>{let l=eX(o),u=l.byteLength,p=await tw(l,r);s.insert(i(function(e,r=tS){let n=function(e,t=tS){return(e=eQ(e)).replace(t,"").replace(/\0/,"")}(e,r);return t.isAbsolute(n)?n.replace("/",""):n}(e,n),n),{meta:{parsedSize:u,...p,importedBy:a}})}))}}for(let e of(s.mergePrefixSingleDirectory(),s.walk(s.root,{enter:(e,t)=>{t&&t.groups.push(e)},leave:(e,t,r)=>{e.groups&&e.groups.length&&Object.assign(e,e.groups.reduce((e,t)=>(e.gzipSize+=t.gzipSize,e.brotliSize+=t.brotliSize,e.parsedSize+=t.parsedSize,e),{gzipSize:0,brotliSize:0,parsedSize:0})),r||delete e.importedBy}}),this.source=s.root.groups,this.source))this.gzipSize+=e.gzipSize,this.brotliSize+=e.brotliSize,this.parsedSize+=e.parsedSize}}class tC{compressAlorithm;modules;workspaceRoot;pluginContext;chunks;matcher;pathFormatter;constructor(e={}){this.compressAlorithm=function(e){let{gzip:t,brotli:r}=e;return{gzip:function(e={}){return e={...eK,...e},t=>eG(t,e)}(t),brotli:function(e={}){return e={...eq,...e},t=>eW(t,e)}(r)}}(e),this.modules=[],this.pluginContext=null,this.chunks={},this.workspaceRoot=process.cwd(),this.matcher=eP(e.include,e.exclude),this.pathFormatter=e.pathFormatter||(e=>e)}installPluginContext(e){this.pluginContext=e}setupRollupChunks(e){Object.assign(this.chunks,e)}async addModule(e){if("map"===e.fileName.slice(-3)||!this.matcher(e.fileName))return;let t=function(e,t){if("asset"===e.type&&!tE.test(e.fileName))return{code:eX(e.source),filename:e.fileName,kind:"asset"};let r="";if(tE.test(e.fileName)&&("sourcemapFileName"in e&&e.sourcemapFileName&&e.sourcemapFileName in t&&(r=tA(e.fileName,e.sourcemapFileName,t)),!r)){let n=e.fileName+".map";n in t&&(r=tA(e.fileName,n,t))}return{code:eX("asset"===e.type?e.source:e.code),filename:e.fileName,map:r,imports:"chunk"===e.type?e.imports:[],dynamicImports:"chunk"===e.type?e.dynamicImports:[],moduleIds:"chunk"===e.type?Object.keys(e.modules):[],isEntry:"chunk"===e.type&&e.isEntry,kind:"chunk"}}(e,this.chunks),r=new t_(t.filename);await r.setup(t,this.compressAlorithm,this.workspaceRoot,this.matcher,this.pathFormatter),this.modules.push(r)}processModule(){return this.modules.map(e=>{let{originalId:t,imports:r,...n}=e;return{...n,imports:[...r]}})}}async function tk(e,t){let{html:r}=await import("./html.mjs");return r(t.title,function(e,t){let{stringify:r}=JSON;return`var defaultSizes=${r(t)},analyzeModule=${r(e)};`}(e,t.mode))}async function tO(e){let t=()=>Math.floor(64512*Math.random())+1024,r=async e=>new Promise(t=>{let r=h.createServer();r.once("error",e=>{"EADDRINUSE"===e.code?t(!1):t(!0)}),r.once("listening",()=>{r.close(()=>{t(!0)})}),r.listen(e,"localhost")});if(0===e){let e=!1,n=0;for(;!e;)n=t(),e=await r(n);return n}let n=await r(e);if(n)return e;{let t=e+1;for(;;){if(n=await r(t))return t;t++}}}function tz(){let e=[],t={},r=(r,n)=>{let o=new URL(r.url||"",`http://${r.headers.host}`),i=o.pathname||"",s=Object.fromEntries(o.searchParams.entries()),a=[...e],l={req:r,res:n,query:s,params:{}},u=Object.keys(t).find(e=>RegExp(`^${e.replace(/:\w+/g,"\\w+")}$`).test(i));if(u){let e=RegExp(`^${u.replace(/:\w+/g,"(\\w+)")}$`),r=i.match(e);r&&(l.params=u.split("/").filter(e=>e.startsWith(":")).map(e=>e.substring(1)).reduce((e,t,n)=>(e[t]=r[n+1],e),{})),a.push(t[u])}let p=0,c=()=>{let e=a[p++];e&&e(l,c)};c()};return{use:t=>{e.push(t)},get:(e,r)=>{t[e]=r},listen:(e,t)=>{f.createServer(r).listen(e,t)}}}function tM(e){let t="head"===e.injectTo?/([ \t]*)<\/head>/i:/([ \t]*)<\/body>/i;e.descriptors=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors];let r=e.descriptors.map(e=>e.attrs&&e.attrs.length>0?`<${e.kind} ${e.attrs.join(" ")}>${e.text}</${e.kind}>`:`<${e.kind}>${e.text}</${e.kind}>`);return e.html.replace(t,e=>`${r.join("\n")}${e}`)}class tL{activeStreams=[];serverEventStream(e,t){t.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","access-control-allow-origin":"*"}),t.write("retry: 500\n"),t.write(":\n\n"),t.flushHeaders();let r=new c;this.activeStreams.push(r);let n=setInterval(()=>{t.write(":\n\n"),t.flushHeaders()},3e3);r.on("message",e=>{t.write(`event: ${e.event}
data: ${e.data}

`),t.flushHeaders()}),e.on("close",()=>{clearInterval(n),this.removeStream(r),t.end()})}sendEvent(e,t){let r={event:e,data:t};this.activeStreams.forEach(e=>{e.emit("message",r)})}removeStream(e){let t=this.activeStreams.indexOf(e);-1!==t&&this.activeStreams.splice(t,1)}}function tI(e){let r=eF(e,["name","generateBundle","closeBundle","api"]),{store:n}=r.api;return n.pluginOptions.enabled?{...r,outputOptions(e){let r=eT(process.cwd());if("."===r&&e.dir){let n=eT(t.resolve(e.dir,".."));"."!==n&&(r=n)}return n.analyzerModule.workspaceRoot=r,"sourcemap"in e&&!n.hasSetupSourcemapOption&&(n.lastSourcemapOption="boolean"==typeof e.sourcemap?e.sourcemap:"hidden"===e.sourcemap),"boolean"==typeof e.sourcemap&&e.sourcemap?e.sourcemap=!0:e.sourcemap="hidden",n.hasSetupSourcemapOption=!0,e}}:r}async function tT(...e){let t=await tk(...e);return tM({html:t,injectTo:"body",descriptors:{kind:"script",text:`
       new EventSource('/__vite__bundle__analyer').addEventListener('refresh', () => {
          window.location.reload();
       })
      `}})}function tH(e){let r,n=eF(e,["name","generateBundle","api"]),{store:o}=n.api;if(!o.pluginOptions.enabled)return n;let i=eY(),s=0,a=new tL;return{...n,outputOptions(e){let r=eT(process.cwd());if("."===r&&e.dir){let n=eT(t.resolve(e.dir,".."));"."!==n&&(r=n)}return o.analyzerModule.workspaceRoot=r,"sourcemap"in e&&!o.hasSetupSourcemapOption&&(o.lastSourcemapOption="boolean"==typeof e.sourcemap?e.sourcemap:"hidden"===e.sourcemap),"boolean"==typeof e.sourcemap&&e.sourcemap?e.sourcemap=!0:e.sourcemap="hidden",o.hasSetupSourcemapOption=!0,e},async closeBundle(){if(r){let e=o.analyzerModule.processModule(),t=await tT(e,{title:o.pluginOptions.reportTitle,mode:o.pluginOptions.defaultSizes||"stat"});i.refresh(t),a.sendEvent("refresh",JSON.stringify({timestamp:Date.now()}));return}let e=o.pluginOptions,t=o.analyzerModule.processModule(),n=o.analyzerModule.workspaceRoot;if("function"==typeof e.analyzerMode)return void e.analyzerMode(t);if("json"===e.analyzerMode||"static"===e.analyzerMode){await tG(t,e,n,i),"static"===e.analyzerMode&&e.openAnalyzer&&console.error("vite-bundle-analyzer: openAnalyzer is not supported in rolldown adapter");return}if(o.preferLivingServer){let{server:n}=await tW(t,e,i,s,{path:"/__vite__bundle__analyer",handler:(e,t)=>{"text/event-stream"===e.req.headers.accept&&a.serverEventStream(e.req,e.res),t()}},tT);r=n}s++}}}let tN=!!process.env.CI,tB={enabled:!0,analyzerMode:"server",defaultSizes:"stat",summary:!0,include:[],exclude:[]};function tP(e){var t=[e];let[r,n]=function(e){switch(e){case"linux":if(-1!==p.release().toLocaleLowerCase().indexOf("microsoft"))return["win32","cmd.exe"];return["linux","xdg-open"];case"win32":return["win32","cmd.exe"];case"darwin":return["darwin","open"];default:return[e,"xdg-open"]}}(p.platform());"win32"===r&&(t=["/c","start",'""'].concat(t=t.map(e=>e.replace(/[&^]/g,"^$&")))),s.spawn(n,t)}let tF=e=>M.dim(M.bold(e+"")),tj=e=>tF(function(e){let t=["Bytes","KB","MB","GB","TB"];if(!e)return"0 "+t[0];let r=parseInt(`${Math.floor(Math.log(e)/Math.log(1024))}`);return(e/(1<<10*r)).toFixed(2)+" "+t[r]}(e)),tD=e=>{let t=e.length,r=e.reduce((e,t)=>(e.gzip+=t.gzipSize,e.parsed+=t.parsedSize,e.map+=t.mapSize,e),{gzip:0,parsed:0,map:0}),n=[r.gzip&&`gzip: ${tj(r.gzip)}`,r.map&&`map: ${tj(r.map)}`].filter(Boolean).join(" | ");return`${tF(t)} chunks of ${tj(r.parsed)} ${n?`(${n})`:""}`},tU=0;async function tG(r,n,o,i){let{isJSON:s,absPath:a}=function(r,n="stats",o){let i=t.isAbsolute(n)?n:t.join(r,n),s=t.extname(i);return s||(i+="json"===o?".json":".html"),e.existsSync(i)&&tU>0&&(i=t.join(r,`${t.basename(i,s)}-${tU}${s}`)),{isJSON:".json"===t.extname(i),absPath:i}}(o,function(e,t){if("json"===e.analyzerMode||"static"===e.analyzerMode)return"function"==typeof e.fileName?e.fileName(t)||"stats":e.fileName||"stats";throw Error("[analyzer error]: unreachable")}(n,o),n.analyzerMode);if(await ej.mkdir(t.dirname(a),{recursive:!0}),s)return await ej.writeFile(a,JSON.stringify(r,null,2),"utf8"),{filePath:a,isJSON:!0};let l=await tk(r,{title:n.reportTitle||"vite-bundle-analyzer",mode:n.defaultSizes||"stat"});return await ej.writeFile(a,l,"utf8"),i.into(l),{filePath:a,isJSON:!1,html:l}}async function tW(e,t,r,n,o,i=tk){let s=await i(e,{title:t.reportTitle||"vite-bundle-analyzer",mode:t.defaultSizes||"stat"});r.into(s);let l=await tO("analyzerPort"in t?"auto"===t.analyzerPort?0:t.analyzerPort||0:8888+n),u=tz();return u.get("/",e=>{e.res.writeHead(200,{"Content-Type":"text/html; charset=utf8;","content-Encoding":"gzip"}),r.refresh(),r.rs.pipe(a.createGzip()).pipe(e.res)}),o&&u.get(o.path,o.handler),u.listen(l,()=>{console.log("server run on ",M.hex("#5B45DE")(`http://localhost:${l}`))}),"openAnalyzer"in t&&!t.openAnalyzer||tN||tP(`http://localhost:${l}`),{server:u,port:l}}function tK(e){let r,{reportTitle:n="vite-bundle-analyzer"}=e={...tB,...e},o=function(e={}){return new tC(e)}({gzip:e.gzipOptions,brotli:e.brotliOptions,include:e.include,exclude:e.exclude,pathFormatter:e.pathFormatter}),i=process.cwd(),s=!0,a=process.cwd(),l=("server"===e.analyzerMode||"static"===e.analyzerMode)&&!tN,u="json"===e.analyzerMode||"static"===e.analyzerMode,p={analyzerModule:o,lastSourcemapOption:!1,hasSetupSourcemapOption:!1,pluginOptions:{...e,reportTitle:n},preferLivingServer:l,preferSilent:u},c={name:"vite-bundle-analyzer",apply:"build",enforce:"post",api:{store:p,processModule:()=>o.processModule()}};if(!e.enabled)return c;let f=eY();return{...c,config:e=>(e.build||(e.build={}),"sourcemap"in e.build&&!p.hasSetupSourcemapOption&&(p.lastSourcemapOption="boolean"==typeof e.build.sourcemap?e.build.sourcemap:"hidden"===e.build.sourcemap,"inline"===e.build.sourcemap&&console.warn("vite-bundle-analyzer: sourcemap option is set to `inline`, it might cause the result inaccurate.")),e.build&&("boolean"==typeof e.build.sourcemap?e.build.sourcemap=!0:e.build.sourcemap="hidden",eZ(`plugin status is ${e.build.sourcemap?M.green("ok"):M.red("invalid")}`)),p.hasSetupSourcemapOption=!0,e),configResolved(n){if(i=t.resolve(n.root,n.build.outDir??""),r=n.logger,o.workspaceRoot=eT(n.root),e.summary){let e=n.plugins.find(e=>"vite:reporter"===e.name);if(s=!!e?.writeBundle,e?.writeBundle){let t="function"==typeof e.writeBundle?e.writeBundle:e.writeBundle?.handler,n=async function(...e){await t?.apply(this,e),r.info(tD(o.modules))};"function"!=typeof e.writeBundle?e.writeBundle.handler=n:e.writeBundle=n}}},async generateBundle(e,t){for(let e in o.installPluginContext(this),o.setupRollupChunks(t),t){let r=t[e];await o.addModule(r)}if(!p.lastSourcemapOption)for(let e in t){let r=t[e];if(tE.test(r.fileName)){let e=r.fileName+".map";e in t&&Reflect.deleteProperty(t,e),"chunk"===r.type&&Reflect.deleteProperty(r,"map")}}},async closeBundle(){if("function"==typeof e.analyzerMode)return void e.analyzerMode(o.processModule());e.summary&&!s&&r.info(tD(o.modules));let t=o.processModule(),n="";if(u){let{filePath:r}=await tG(t,e,i,f);if("static"===e.analyzerMode&&!e.openAnalyzer)return;n=r}if(l){if("static"===e.analyzerMode&&n)return void tP(`file://${n}`);await tW(t,e,f,tU)}tU++}}}export{tL as S,M as a,tK as b,eT as c,tW as d,tI as e,tO as f,tz as g,tG as h,tN as i,tM as j,tP as o,tk as r,eI as s,tH as u};
